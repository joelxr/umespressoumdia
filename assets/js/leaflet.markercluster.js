!function(a,b,c){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[];var b=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,b?this._withAnimation:this._noAnimation),this._markerCluster=b?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.addLayers(b)}if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this;if(!this._map)return this._needsClustering.push(a),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom),this._topClusterLevel._recalculateBounds();var d=a,e=this._map.getZoom();if(a.__parent)for(;d.__parent._zoom>=e;)d=d.__parent;return this._currentShownBounds.contains(d.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,d):this._animationAddLayerNonAnimated(a,d)),this},removeLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.removeLayers(b)}return a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this._topClusterLevel._recalculateBounds(),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push(a),this):(this._nonPointGroup.removeLayer(a),this)},addLayers:function(a){var b,c,d,e,f=this._featureGroup,g=this._nonPointGroup,h=this.options.chunkedLoading,i=this.options.chunkInterval,j=this.options.chunkProgress;if(this._map){var k=0,l=(new Date).getTime(),m=L.bind(function(){for(var b=(new Date).getTime();k<a.length;k++){if(h&&k%200===0){var c=(new Date).getTime()-b;if(c>i)break}if(e=a[k],e.getLatLng){if(!this.hasLayer(e)&&(this._addLayer(e,this._maxZoom),e.__parent&&2===e.__parent.getChildCount())){var d=e.__parent.getAllChildMarkers(),n=d[0]===e?d[1]:d[0];f.removeLayer(n)}}else g.addLayer(e)}j&&j(k,a.length,(new Date).getTime()-l),k===a.length?(this._topClusterLevel._recalculateBounds(),this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else{for(b=[],c=0,d=a.length;c<d;c++)e=a[c],e.getLatLng?this.hasLayer(e)||b.push(e):g.addLayer(e);this._needsClustering=this._needsClustering.concat(b)}return this},removeLayers:function(a){var b,c,d,e=this._featureGroup,f=this._nonPointGroup;if(!this._map){for(b=0,c=a.length;b<c;b++)d=a[b],this._arraySplice(this._needsClustering,d),f.removeLayer(d),this.hasLayer(d)&&this._needsRemoving.push(d);return this}if(this._unspiderfy)for(this._unspiderfy(),b=0,c=a.length;b<c;b++)d=a[b],this._unspiderfyLayer(d);for(b=0,c=a.length;b<c;b++)d=a[b],d.__parent?(this._removeLayer(d,!0,!0),e.hasLayer(d)&&(e.removeLayer(d),d.clusterShow&&d.clusterShow())):f.removeLayer(d);return this._topClusterLevel._recalculateBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),e.eachLayer(function(a){a instanceof L.MarkerCluster&&a._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){delete a.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(var b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(d),c=d.length-1;c>=0;c--)a.call(b,d[c]);this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return a=parseInt(a,10),this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!0;for(c=this._needsRemoving,b=c.length-1;b>=0;b--)if(c[b]===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){"function"!=typeof b&&(b=function(){});var c=function(){!a._icon&&!a.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};if(a._icon&&this._map.getBounds().contains(a.getLatLng()))b();else if(a.__parent._zoom<this._map.getZoom())this._map.on("moveend",c,this),this._map.panTo(a.getLatLng());else{var d=function(){this._map.off("movestart",d,this),d=null};this._map.on("movestart",d,this),this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds(),d&&c.call(this)}},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.onAdd(a),this._nonPointGroup.onAdd(a),this._gridClusters||this._generateInitialClusters(),this._maxLat=a.options.crs.projection.MAX_LATITUDE,b=0,c=this._needsRemoving.length;b<c;b++)d=this._needsRemoving[b],this._removeLayer(d,!0);this._needsRemoving=[],this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),c=this._needsClustering,this._needsClustering=[],this.addLayers(c)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.onRemove(a),this._nonPointGroup.onRemove(a),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){for(var b=a;b&&!b._icon;)b=b.__parent;return b||null},_arraySplice:function(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b)return a.splice(c,1),!0},_removeFromGridUnclustered:function(a,b){for(var c=this._map,d=this._gridUnclustered;b>=0&&d[b].removeObject(a,c.project(a.getLatLng(),b));b--);},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map;b&&this._removeFromGridUnclustered(a,this._maxZoom);var h,i=a.__parent,j=i._markers;for(this._arraySplice(j,a);i&&(i._childCount--,i._boundsNeedUpdate=!0,!(i._zoom<0));)b&&i._childCount<=1?(h=i._markers[0]===a?i._markers[1]:i._markers[0],d[i._zoom].removeObject(i,g.project(i._cLatLng,i._zoom)),e[i._zoom].addObject(h,g.project(h.getLatLng(),i._zoom)),this._arraySplice(i.__parent._childClusters,i),i.__parent._markers.push(h),h.__parent=i.__parent,i._icon&&(f.removeLayer(i),c||f.addLayer(h))):c&&i._icon||i._updateIcon(),i=i.__parent;delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},_propagateEvent:function(a){if(a.layer instanceof L.MarkerCluster){if(a.originalEvent&&this._isOrIsParent(a.layer._icon,a.originalEvent.relatedTarget))return;a.type="cluster"+a.type}this.fire(a.type,a)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=b<10?"small":b<100?"medium":"large",new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){for(var b=a.layer,c=b;1===c._childClusters.length;)c=c._childClusters[0];c._zoom===this._maxZoom&&c._childCount===b._childCount?this.options.spiderfyOnMaxZoom&&b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds(),a.originalEvent&&13===a.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,a),this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius,c=b;"function"!=typeof b&&(c=function(){return b}),this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var d=a;d>=0;d--)this._gridClusters[d]=new L.DistanceGrid(c(d)),this._gridUnclustered[d]=new L.DistanceGrid(c(d));this._topClusterLevel=new this._markerCluster(this,(-1))},_addLayer:function(a,b){var c,d,e=this._gridClusters,f=this._gridUnclustered;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(a);b>=0;b--){c=this._map.project(a.getLatLng(),b);var g=e[b].getNearObject(c);if(g)return g._addChild(a),void(a.__parent=g);if(g=f[b].getNearObject(c)){var h=g.__parent;h&&this._removeLayer(g,!1);var i=new this._markerCluster(this,b,g,a);e[b].addObject(i,this._map.project(i._cLatLng,b)),g.__parent=i,a.__parent=i;var j=i;for(d=b-1;d>h._zoom;d--)j=new this._markerCluster(this,d,j),e[d].addObject(j,this._map.project(g.getLatLng(),d));return h._addChild(j),void this._removeFromGridUnclustered(g,b)}f[b].addObject(a,c)}this._topClusterLevel._addChild(a),a.__parent=this._topClusterLevel},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;return b!==c&&(a.getNorth()>=b&&(a._northEast.lat=1/0),a.getSouth()<=-b&&(a._southWest.lat=-(1/0))),a},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()},_overrideMarkerIcon:function(a){var b=a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}});return b}}),L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng((-(1/0)),(-(1/0))),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(a,b){var c,d=this._getExpandedVisibleBounds(),e=this._featureGroup;this._topClusterLevel._recursively(d,a,0,function(f){var g,h=f._latlng,i=f._markers;for(d.contains(h)||(h=null),f._isSingleParent()&&a+1===b?(e.removeLayer(f),f._recursivelyAddChildrenToMap(null,b,d)):(f.clusterHide(),f._recursivelyAddChildrenToMap(h,b,d)),c=i.length-1;c>=0;c--)g=i[c],d.contains(g._latlng)||e.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(d,b),e.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.clusterShow()}),this._topClusterLevel._recursively(d,a,b,function(a){a._recursivelyRestoreChildPositions(b)}),this._enqueue(function(){this._topClusterLevel._recursively(d,a,0,function(a){e.removeLayer(a),a.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.clusterHide(),this._enqueue(function(){d.removeLayer(a),a.clusterShow(),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))}},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(d,b+1,c);var e=this;this._forceLayout(),a._recursivelyBecomeVisible(d,c),this._enqueue(function(){if(1===a._childCount){var f=a._markers[0];f.setLatLng(f.getLatLng()),f.clusterShow&&f.clusterShow()}else a._recursively(d,c,0,function(a){a._recursivelyRemoveChildrenFromMap(d,b+1)});e._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(b.body.offsetWidth)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;b>=0;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;c>=0;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var a,b=this._childClusters.slice(),c=this._group._map,d=c.getBoundsZoom(this._bounds),e=this._zoom+1,f=c.getZoom();b.length>0&&d>e;){e++;var g=[];for(a=0;a<b.length;a++)g=g.concat(b[a]._childClusters);b=g}d>e?this._group._map.setView(this._latlng,e):d<=f?this._group._map.setView(this._latlng,f+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=1/0,a._southWest.lng=1/0),a._northEast&&(a._northEast.lat=-(1/0),a._northEast.lng=-(1/0))},_recalculateBounds:function(){var a,b,c,d,e=this._markers,f=this._childClusters,g=0,h=0,i=this._childCount;if(0!==i){for(this._resetBounds(),a=0;a<e.length;a++)c=e[a]._latlng,this._bounds.extend(c),g+=c.lat,h+=c.lng;for(a=0;a<f.length;a++)b=f[a],b._boundsNeedUpdate&&b._recalculateBounds(),this._bounds.extend(b._bounds),c=b._wLatLng,d=b._childCount,g+=c.lat*d,h+=c.lng*d;this._latlng=this._wLatLng=new L.LatLng(g/i,h/i),this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var c,d,e=a._markers;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())},function(a){var c,d,e=a._childClusters;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(d){d._recursivelyAnimateChildrenIn(a,d._group._map.latLngToLayerPoint(d.getLatLng()).round(),b),d._isSingleParent()&&b-1===c?(d.clusterShow(),d._recursivelyRemoveChildrenFromMap(a,b)):d.clusterHide(),d._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;e>=0;e--){var f=d._markers[e];c.contains(f._latlng)&&(a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.clusterHide&&f.clusterHide()),d._group._featureGroup.addLayer(f))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;b>=0;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var d,e;this._recursively(a,-1,b-1,function(a){for(e=a._markers.length-1;e>=0;e--)d=a._markers[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.clusterShow&&d.clusterShow())},function(a){for(e=a._childClusters.length-1;e>=0;e--)d=a._childClusters[e],c&&c.contains(d._latlng)||(a._group._featureGroup.removeLayer(d),d.clusterShow&&d.clusterShow())})},_recursively:function(a,b,c,d,e){var f,g,h=this._childClusters,i=this._zoom;if(b>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e);else if(d&&d(this),e&&this._zoom===c&&e(this),c>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var a=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,a}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(a);this._objectPoint[h]=b,g.push(a)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(a,b){var c,d,e=this._getCoord(b.x),f=this._getCoord(b.y),g=this._grid,h=g[f]=g[f]||{},i=h[e]=h[e]||[];for(delete this._objectPoint[L.Util.stamp(a)],c=0,d=i.length;c<d;c++)if(i[c]===a)return i.splice(c,1),1===d&&delete h[e],!0},eachObject:function(a,b){var c,d,e,f,g,h,i,j=this._grid;for(c in j){g=j[c];for(d in g)for(h=g[d],e=0,f=h.length;e<f;e++)i=a.call(b,h[e]),i&&(e--,f--)}},getNearObject:function(a){var b,c,d,e,f,g,h,i,j=this._getCoord(a.x),k=this._getCoord(a.y),l=this._objectPoint,m=this._sqCellSize,n=null;for(b=k-1;b<=k+1;b++)if(e=this._grid[b])for(c=j-1;c<=j+1;c++)if(f=e[c])for(d=0,g=f.length;d<g;d++)h=f[d],i=this._sqDist(l[L.Util.stamp(h)],a),i<m&&(m=i,n=h);return n},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat,d=b[0].lng-b[1].lng;return d*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c,d,e,f=0,g=null,h=[];for(c=b.length-1;c>=0;c--)d=b[c],e=this.getDistant(d,a),e>0&&(h.push(d),e>f&&(f=e,g=d));return{maxPoint:g,newPoints:h}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);return d.maxPoint?(c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints))):[a[0]]},getConvexHull:function(a){var b,c=!1,d=!1,e=!1,f=!1,g=null,h=null,i=null,j=null,k=null,l=null;for(b=a.length-1;b>=0;b--){var m=a[b];(c===!1||m.lat>c)&&(g=m,c=m.lat),(d===!1||m.lat<d)&&(h=m,d=m.lat),(e===!1||m.lng>e)&&(i=m,e=m.lng),(f===!1||m.lng<f)&&(j=m,f=m.lng)}d!==c?(l=h,k=g):(l=j,k=i);var n=[].concat(this.buildConvexHull([l,k],a),this.buildConvexHull([k,l],a));return n}}}(),L.MarkerCluster.include({getConvexHull:function(){var a,b,c=this.getAllChildMarkers(),d=[];for(b=c.length-1;b>=0;b--)a=c[b].getLatLng(),d.push(a);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(),c=this._group,d=c._map,e=d.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,e):(e.y+=10,a=this._generatePointsCircle(b.length,e)),this._animationSpiderfy(b,a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c,d,e=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a),f=e/this._2PI,g=this._2PI/a,h=[];for(h.length=a,c=a-1;c>=0;c--)d=this._circleStartAngle+c*g,h[c]=new L.Point(b.x+f*Math.cos(d),b.y+f*Math.sin(d))._round();return h},_generatePointsSpiral:function(a,b){var c,d=this._group.options.spiderfyDistanceMultiplier,e=d*this._spiralLengthStart,f=d*this._spiralFootSeparation,g=d*this._spiralLengthFactor*this._2PI,h=0,i=[];for(i.length=a,c=a-1;c>=0;c--)h+=f/e+5e-4*c,i[c]=new L.Point(b.x+e*Math.cos(h),b.y+e*Math.sin(h))._round(),e+=g/h;return i},_noanimationUnspiderfy:function(){var a,b,c=this._group,d=c._map,e=c._featureGroup,f=this.getAllChildMarkers();for(this.setOpacity(1),b=f.length-1;b>=0;b--)a=f[b],e.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(d.removeLayer(a._spiderLeg),delete a._spiderLeg);c.fire("unspiderfied",{cluster:this,markers:f}),c._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(a,b){var c,d,e,f,g=this._group,h=g._map,i=g._featureGroup,j=this._group.options.spiderLegPolylineOptions;for(c=0;c<a.length;c++)f=h.layerPointToLatLng(b[c]),d=a[c],e=new L.Polyline([this._latlng,f],j),h.addLayer(e),d._spiderLeg=e,d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset&&d.setZIndexOffset(1e6),i.addLayer(d);this.setOpacity(.3),g.fire("spiderfied",{cluster:this,markers:a})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(a,b){var d,e,f,g,h,i,j=this,k=this._group,l=k._map,m=k._featureGroup,n=this._latlng,o=l.latLngToLayerPoint(n),p=L.Path.SVG,q=L.extend({},this._group.options.spiderLegPolylineOptions),r=q.opacity;for(r===c&&(r=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),p?(q.opacity=0,q.className=(q.className||"")+" leaflet-cluster-spider-leg"):q.opacity=r,d=0;d<a.length;d++)e=a[d],i=l.layerPointToLatLng(b[d]),f=new L.Polyline([n,i],q),l.addLayer(f),e._spiderLeg=f,p&&(g=f._path,h=g.getTotalLength()+.1,g.style.strokeDasharray=h,g.style.strokeDashoffset=h),e.setZIndexOffset&&e.setZIndexOffset(1e6),e.clusterHide&&e.clusterHide(),m.addLayer(e),e._setPos&&e._setPos(o);for(k._forceLayout(),k._animationStart(),d=a.length-1;d>=0;d--)i=l.layerPointToLatLng(b[d]),e=a[d],e._preSpiderfyLatlng=e._latlng,e.setLatLng(i),e.clusterShow&&e.clusterShow(),p&&(f=e._spiderLeg,g=f._path,g.style.strokeDashoffset=0,f.setStyle({opacity:r}));this.setOpacity(.3),setTimeout(function(){k._animationEnd(),k.fire("spiderfied",{cluster:j,markers:a})},200)},_animationUnspiderfy:function(a){var b,c,d,e,f,g,h=this,i=this._group,j=i._map,k=i._featureGroup,l=a?j._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):j.latLngToLayerPoint(this._latlng),m=this.getAllChildMarkers(),n=L.Path.SVG;for(i._animationStart(),this.setOpacity(1),c=m.length-1;c>=0;c--)b=m[c],b._preSpiderfyLatlng&&(b.setLatLng(b._preSpiderfyLatlng),delete b._preSpiderfyLatlng,g=!0,b._setPos&&(b._setPos(l),g=!1),b.clusterHide&&(b.clusterHide(),g=!1),g&&k.removeLayer(b),n&&(d=b._spiderLeg,e=d._path,f=e.getTotalLength()+.1,e.style.strokeDashoffset=f,d.setStyle({opacity:0})));setTimeout(function(){var a=0;for(c=m.length-1;c>=0;c--)b=m[c],b._spiderLeg&&a++;for(c=m.length-1;c>=0;c--)b=m[c],b._spiderLeg&&(b.clusterShow&&b.clusterShow(),b.setZIndexOffset&&b.setZIndexOffset(0),a>1&&k.removeLayer(b),j.removeLayer(b._spiderLeg),delete b._spiderLeg);i._animationEnd(),i.fire("unspiderfied",{cluster:h,markers:m})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(a){return a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(a),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a),this},_flagParentsIconsNeedUpdate:function(a){var b,c;for(b in a)for(c=a[b].__parent;c;)c._iconNeedsUpdate=!0,c=c.__parent},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_refreshSingleMarkerModeMarkers:function(a){var b,c;for(b in a)c=a[b],this.hasLayer(c)&&c.setIcon(this._overrideMarkerIcon(c))}}),L.Marker.include({refreshIconOptions:function(a,b){var c=this.options.icon;return L.setOptions(c,a),this.setIcon(c),b&&this.__parent&&this.__parent._group.refreshClusters(this),this}})}(window,document);