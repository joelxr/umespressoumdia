!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.mapboxgl=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){a?(this.array=a.array,this.pos=a.pos):(this.array=new ArrayBuffer(this.defaultLength),this.length=this.defaultLength,this.setupViews())}b.exports=d,d.prototype={pos:0,itemSize:4,defaultLength:8192,arrayType:"ARRAY_BUFFER",get index(){return this.pos/this.itemSize},setupViews:function(){this.ubytes=new Uint8Array(this.array),this.bytes=new Int8Array(this.array),this.ushorts=new Uint16Array(this.array),this.shorts=new Int16Array(this.array)},bind:function(a){var b=a[this.arrayType];this.buffer?a.bindBuffer(b,this.buffer):(this.buffer=a.createBuffer(),a.bindBuffer(b,this.buffer),a.bufferData(b,this.array.slice(0,this.pos),a.STATIC_DRAW),this.array=null)},destroy:function(a){this.buffer&&a.deleteBuffer(this.buffer)},resize:function(){if(this.length<this.pos+this.itemSize){for(;this.length<this.pos+this.itemSize;)this.length=2*Math.round(1.5*this.length/2);this.array=new ArrayBuffer(this.length);var a=new Uint8Array(this.array);a.set(this.ubytes),this.setupViews()}}}},{}],2:[function(a,b,c){"use strict";var d=a("./line_vertex_buffer"),e=a("./line_element_buffer"),f=a("./fill_vertex_buffer"),g=a("./triangle_element_buffer"),h=a("./outline_element_buffer"),i=a("./glyph_vertex_buffer"),j=a("./triangle_element_buffer"),k=a("./icon_vertex_buffer"),l=a("./triangle_element_buffer"),m=a("./collision_box_vertex_buffer"),n=a("./circle_vertex_buffer"),o=a("./triangle_element_buffer");b.exports=function(a){return a=a||{},{glyphVertex:new i(a.glyphVertex),glyphElement:new j(a.glyphElement),iconVertex:new k(a.iconVertex),iconElement:new l(a.iconElement),circleVertex:new n(a.circleVertex),circleElement:new o(a.circleElement),fillVertex:new f(a.fillVertex),fillElement:new g(a.fillElement),outlineElement:new h(a.outlineElement),lineVertex:new d(a.lineVertex),lineElement:new e(a.lineElement),collisionBoxVertex:new m(a.collisionBoxVertex)}}},{"./circle_vertex_buffer":3,"./collision_box_vertex_buffer":4,"./fill_vertex_buffer":5,"./glyph_vertex_buffer":6,"./icon_vertex_buffer":7,"./line_element_buffer":8,"./line_vertex_buffer":9,"./outline_element_buffer":10,"./triangle_element_buffer":11}],3:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{defaultLength:32768,itemSize:4,add:function(a,b,c,d){var e=this.pos,f=e/2;this.resize(),this.shorts[f+0]=2*a+(c+1)/2,this.shorts[f+1]=2*b+(d+1)/2,this.pos+=this.itemSize},bind:function(a,b,c){f.prototype.bind.call(this,a),a.vertexAttribPointer(b.a_pos,2,a.SHORT,!1,this.itemSize,c+0)}})},{"../../util/util":106,"./buffer":1}],4:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{itemSize:12,defaultLength:32768,add:function(a,b,c,d){var e=this.pos,f=e/2,g=this.index;return this.resize(),this.shorts[f+0]=a.x,this.shorts[f+1]=a.y,this.shorts[f+2]=Math.round(b.x),this.shorts[f+3]=Math.round(b.y),this.ubytes[e+8]=Math.floor(10*c),this.ubytes[e+9]=Math.floor(10*d),this.pos+=this.itemSize,g}})},{"../../util/util":106,"./buffer":1}],5:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{itemSize:4,add:function(a,b){var c=this.pos/2;this.resize(),this.shorts[c+0]=a,this.shorts[c+1]=b,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],6:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{defaultLength:32768,itemSize:16,add:function(a,b,c,d,e,f,g,h,i){var j=this.pos,k=j/2;this.resize(),this.shorts[k+0]=a,this.shorts[k+1]=b,this.shorts[k+2]=Math.round(64*c),this.shorts[k+3]=Math.round(64*d),this.ubytes[j+8]=Math.floor(e/4),this.ubytes[j+9]=Math.floor(f/4),this.ubytes[j+10]=Math.floor(10*i),this.ubytes[j+12]=Math.floor(10*g),this.ubytes[j+13]=Math.floor(10*Math.min(h,25)),this.pos+=this.itemSize},bind:function(a,b,c){f.prototype.bind.call(this,a);var d=this.itemSize;a.vertexAttribPointer(b.a_pos,2,a.SHORT,!1,d,c+0),a.vertexAttribPointer(b.a_offset,2,a.SHORT,!1,d,c+4),a.vertexAttribPointer(b.a_data1,4,a.UNSIGNED_BYTE,!1,d,c+8),a.vertexAttribPointer(b.a_data2,2,a.UNSIGNED_BYTE,!1,d,c+12)}})},{"../../util/util":106,"./buffer":1}],7:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{defaultLength:32768,itemSize:16,add:function(a,b,c,d,e,f,g,h,i){var j=this.pos,k=j/2;this.resize(),this.shorts[k+0]=a,this.shorts[k+1]=b,this.shorts[k+2]=Math.round(64*c),this.shorts[k+3]=Math.round(64*d),this.ubytes[j+8]=e/4,this.ubytes[j+9]=f/4,this.ubytes[j+10]=Math.floor(10*(i||0)),this.ubytes[j+12]=Math.floor(10*(g||0)),this.ubytes[j+13]=Math.floor(10*Math.min(h||25,25)),this.pos+=this.itemSize},bind:function(a,b,c){f.prototype.bind.call(this,a);var d=this.itemSize;a.vertexAttribPointer(b.a_pos,2,a.SHORT,!1,d,c+0),a.vertexAttribPointer(b.a_offset,2,a.SHORT,!1,d,c+4),a.vertexAttribPointer(b.a_data1,4,a.UNSIGNED_BYTE,!1,d,c+8),a.vertexAttribPointer(b.a_data2,2,a.UNSIGNED_BYTE,!1,d,c+12)}})},{"../../util/util":106,"./buffer":1}],8:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(a,b,c){var d=this.pos/2;this.resize(),this.ushorts[d+0]=a,this.ushorts[d+1]=b,this.ushorts[d+2]=c,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],9:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.extrudeScale=63,d.prototype=e.inherit(f,{itemSize:8,defaultLength:32768,add:function(a,b,c,e,f){var g=this.pos,h=g/2,i=this.index,j=d.extrudeScale;return this.resize(),this.shorts[h+0]=2*Math.floor(a.x)|c,this.shorts[h+1]=2*Math.floor(a.y)|e,this.bytes[g+4]=Math.round(j*b.x),this.bytes[g+5]=Math.round(j*b.y),this.bytes[g+6]=(f||0)/128,this.bytes[g+7]=(f||0)%128,this.pos+=this.itemSize,i}})},{"../../util/util":106,"./buffer":1}],10:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{itemSize:4,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(a,b){var c=this.pos/2;this.resize(),this.ushorts[c+0]=a,this.ushorts[c+1]=b,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],11:[function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("../../util/util"),f=a("./buffer");b.exports=d,d.prototype=e.inherit(f,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(a,b,c){var d=this.pos/2;this.resize(),this.ushorts[d+0]=a,this.ushorts[d+1]=b,this.ushorts[d+2]=c,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],12:[function(a,b,c){"use strict";function d(a){this.buffers=a,this.elementGroups=new e(a.circleVertex,a.circleElement)}var e=a("./element_groups");b.exports=d,d.prototype.addFeatures=function(){for(var a=4096,b=0;b<this.features.length;b++)for(var c=this.features[b].loadGeometry()[0],d=0;d<c.length;d++){this.elementGroups.makeRoomFor(6);var e=c[d].x,f=c[d].y;if(!(0>e||e>=a||0>f||f>=a)){var g=this.buffers.circleVertex.index-this.elementGroups.current.vertexStartIndex;this.buffers.circleVertex.add(e,f,-1,-1),this.buffers.circleVertex.add(e,f,1,-1),this.buffers.circleVertex.add(e,f,1,1),this.buffers.circleVertex.add(e,f,-1,1),this.elementGroups.elementBuffer.add(g,g+1,g+2),this.elementGroups.elementBuffer.add(g,g+3,g+2),this.elementGroups.current.vertexLength+=4,this.elementGroups.current.elementLength+=2}}}},{"./element_groups":14}],13:[function(a,b,c){"use strict";function d(a,b,c,d,l){var m=new k("layout",a.type,a.layout,{}).values(),n={lastIntegerZoom:1/0,lastIntegerZoomTime:0,lastZoom:0},o={};for(var p in m)o[p]=m[p].calculate(c,n);"symbol"===a.type&&(m["text-size"]&&(o["text-max-size"]=m["text-size"].calculate(18,n),o["text-size"]=m["text-size"].calculate(c+1,n)),m["icon-size"]&&(o["icon-max-size"]=m["icon-size"].calculate(18,n),o["icon-size"]=m["icon-size"].calculate(c+1,n)));var q="line"===a.type?e:"fill"===a.type?f:"symbol"===a.type?g:"circle"===a.type?h:null,r=new q(b,new i[a.type](o),d,c,l);return r.id=a.id,r.type=a.type,r["source-layer"]=a["source-layer"],r.interactive=a.interactive,r.minZoom=a.minzoom,r.maxZoom=a.maxzoom,r.filter=j(a.filter),r.features=[],r}b.exports=d;var e=a("./line_bucket"),f=a("./fill_bucket"),g=a("./symbol_bucket"),h=a("./circle_bucket"),i=a("../style/layout_properties"),j=a("feature-filter"),k=a("../style/style_declaration_set")},{"../style/layout_properties":53,"../style/style_declaration_set":59,"./circle_bucket":12,"./fill_bucket":16,"./line_bucket":17,"./symbol_bucket":18,"feature-filter":112}],14:[function(a,b,c){"use strict";function d(a,b,c){this.vertexBuffer=a,this.elementBuffer=b,this.secondElementBuffer=c,this.groups=[]}function e(a,b,c){this.vertexStartIndex=a,this.elementStartIndex=b,this.secondElementStartIndex=c,this.elementLength=0,this.vertexLength=0,this.secondElementLength=0}b.exports=d,d.prototype.makeRoomFor=function(a){(!this.current||this.current.vertexLength+a>65535)&&(this.current=new e(this.vertexBuffer.index,this.elementBuffer&&this.elementBuffer.index,this.secondElementBuffer&&this.secondElementBuffer.index),this.groups.push(this.current))}},{}],15:[function(a,b,c){"use strict";function d(a,b){this.x=a.x,this.y=a.y,this.z=a.z-Math.log(b)/Math.LN2,this.rtree=o(9),this.toBeInserted=[]}function e(a,b,c){return"Point"===b?i(a,c):"LineString"===b?g(a,c):"Polygon"===b&&(f(a,c)||g(a,c))}function f(a,b){return!!(m(a,new p(b[0],b[1]))||m(a,new p(b[0],b[3]))||m(a,new p(b[2],b[1]))||m(a,new p(b[2],b[3])))||g(a,b)}function g(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0,f=d.length-1;e<d.length;f=e++){var g=d[e],j=d[f],k=new p(g.y,g.x),l=new p(j.y,j.x);if(h(g,j,b[0],b[2],b[1])||h(g,j,b[0],b[2],b[3])||h(k,l,b[1],b[3],b[0])||h(k,l,b[1],b[3],b[2]))return!0}return i(a,b)}function h(a,b,c,d,e){if(b.y===a.y)return b.y===e&&Math.min(a.x,b.x)<=d&&Math.max(a.x,b.x)>=c;var f=(e-a.y)/(b.y-a.y),g=a.x+f*(b.x-a.x);return g>=c&&d>=g&&1>=f&&f>=0}function i(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)if(d[e].x>=b[0]&&d[e].y>=b[1]&&d[e].x<=b[2]&&d[e].y<=b[3])return!0;return!1}function j(a,b,c,d){return"Point"===b?n(a,c,d):"LineString"===b?l(a,c,d):"Polygon"===b&&(m(a,c)||l(a,c,d))}function k(a,b,c){var d=b.distSqr(c);if(0===d)return a.distSqr(b);var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?a.distSqr(b):e>1?a.distSqr(c):a.distSqr(c.sub(b)._mult(e)._add(b))}function l(a,b,c){for(var d=c*c,e=0;e<a.length;e++)for(var f=a[e],g=1;g<f.length;g++){var h=f[g-1],i=f[g];if(k(b,h,i)<d)return!0}return!1}function m(a,b){for(var c,d,e,f=!1,g=0;g<a.length;g++){c=a[g];for(var h=0,i=c.length-1;h<c.length;i=h++)d=c[h],e=c[i],d.y>b.y!=e.y>b.y&&b.x<(e.x-d.x)*(b.y-d.y)/(e.y-d.y)+d.x&&(f=!f)}return f}function n(a,b,c){for(var d=c*c,e=0;e<a.length;e++)for(var f=a[e],g=0;g<f.length;g++)if(f[g].distSqr(b)<=d)return!0;return!1}var o=a("rbush"),p=a("point-geometry"),q=a("vector-tile"),r=a("../util/util");b.exports=d,d.prototype.insert=function(a,b,c){a.layers=b,a.feature=c,this.toBeInserted.push(a)},d.prototype._load=function(){this.rtree.load(this.toBeInserted),this.toBeInserted=[]},d.prototype.query=function(a,b){this.toBeInserted.length&&this._load();var c,d,f=a.params||{},g=a.x,h=a.y,i=[];"undefined"!=typeof g&&"undefined"!=typeof h?(c=4096*(f.radius||0)/a.scale,d=[g-c,h-c,g+c,h+c]):d=[a.minX,a.minY,a.maxX,a.maxY];for(var k=this.rtree.search(d),l=0;l<k.length;l++){var m=k[l].feature,n=k[l].layers,o=q.VectorTileFeature.types[m.type];if(!(f.$type&&o!==f.$type||c&&!j(m.loadGeometry(),o,new p(g,h),c))&&e(m.loadGeometry(),o,d)){var s=m.toGeoJSON(this.x,this.y,this.z);f.includeGeometry||(s.geometry=null);for(var t=0;t<n.length;t++){var u=n[t];f.layerIds&&f.layerIds.indexOf(u)<0||i.push(r.extend({layer:u},s))}}}b(null,i)}},{"../util/util":106,"point-geometry":137,rbush:138,"vector-tile":141}],16:[function(a,b,c){"use strict";function d(a){this.buffers=a,this.elementGroups=new e(a.fillVertex,a.fillElement,a.outlineElement)}var e=a("./element_groups");b.exports=d,d.prototype.addFeatures=function(){for(var a=this.features,b=0;b<a.length;b++){var c=a[b];this.addFeature(c.loadGeometry())}},d.prototype.addFeature=function(a){for(var b=0;b<a.length;b++)this.addFill(a[b])},d.prototype.addFill=function(a){if(!(a.length<3)){var b=a.length;this.elementGroups.makeRoomFor(b+1);for(var c,d,e,f=this.elementGroups.current,g=this.buffers.fillVertex,h=this.buffers.fillElement,i=this.buffers.outlineElement,j=g.index-f.vertexStartIndex,k=0;k<a.length;k++)d=g.index-f.vertexStartIndex,e=a[k],g.add(e.x,e.y),f.vertexLength++,k>=2&&(e.x!==a[0].x||e.y!==a[0].y)&&(h.add(j,c,d),f.elementLength++),k>=1&&(i.add(c,d),f.secondElementLength++),c=d}}},{"./element_groups":14}],17:[function(a,b,c){"use strict";function d(a,b){this.buffers=a,this.elementGroups=new e(a.lineVertex,a.lineElement),this.layoutProperties=b}var e=a("./element_groups");b.exports=d,d.prototype.addFeatures=function(){for(var a=this.features,b=0;b<a.length;b++){var c=a[b];this.addFeature(c.loadGeometry())}},d.prototype.addFeature=function(a){for(var b=this.layoutProperties,c=0;c<a.length;c++)this.addLine(a[c],b["line-join"],b["line-cap"],b["line-miter-limit"],b["line-round-limit"])},d.prototype.addLine=function(a,b,c,d,e){for(var f=a.length;f>2&&a[f-1].equals(a[f-2]);)f--;if(!(a.length<2)){"bevel"===b&&(d=1.05);var g=a[0],h=a[f-1],i=g.equals(h);if(this.elementGroups.makeRoomFor(10*f),2!==f||!i){var j,k,l,m,n,o,p,q=c,r=i?"butt":c,s=1,t=0,u=!0;this.e1=this.e2=this.e3=-1,i&&(j=a[f-2],n=g.sub(j)._unit()._perp());for(var v=0;f>v;v++)if(l=i&&v===f-1?a[1]:a[v+1],!l||!a[v].equals(l)){n&&(m=n),j&&(k=j),j=a[v],k&&(t+=j.dist(k)),n=l?l.sub(j)._unit()._perp():m,m=m||n;var w=m.add(n)._unit(),x=w.x*n.x+w.y*n.y,y=1/x,z=k&&l,A=z?b:l?q:r;if(z&&"round"===A&&(e>y?A="miter":2>=y&&(A="fakeround")),"miter"===A&&y>d&&(A="bevel"),"bevel"===A&&(y>2&&(A="flipbevel"),d>y&&(A="miter")),"miter"===A)w._mult(y),this.addCurrentVertex(j,s,t,w,0,0,!1);else if("flipbevel"===A){if(y>100)w=n.clone();else{var B=m.x*n.y-m.y*n.x>0?-1:1,C=y*m.add(n).mag()/m.sub(n).mag();w._perp()._mult(C*B)}this.addCurrentVertex(j,s,t,w,0,0,!1),s=-s}else if("bevel"===A||"fakeround"===A){var D=s*(m.x*n.y-m.y*n.x)>0,E=-Math.sqrt(y*y-1);if(D?(p=0,o=E):(o=0,p=E),u||this.addCurrentVertex(j,s,t,m,o,p,!1),"fakeround"===A){for(var F,G=Math.floor(8*(.5-(x-.5))),H=0;G>H;H++)F=n.mult((H+1)/(G+1))._add(m)._unit(),this.addPieSliceVertex(j,s,t,F,D);this.addPieSliceVertex(j,s,t,w,D);for(var I=G-1;I>=0;I--)F=m.mult((I+1)/(G+1))._add(n)._unit(),this.addPieSliceVertex(j,s,t,F,D)}l&&this.addCurrentVertex(j,s,t,n,-o,-p,!1)}else"butt"===A?(u||this.addCurrentVertex(j,s,t,m,0,0,!1),l&&this.addCurrentVertex(j,s,t,n,0,0,!1)):"square"===A?(u||(this.addCurrentVertex(j,s,t,m,1,1,!1),this.e1=this.e2=-1,s=1),l&&this.addCurrentVertex(j,s,t,n,-1,-1,!1)):"round"===A&&(u||(this.addCurrentVertex(j,s,t,m,0,0,!1),this.addCurrentVertex(j,s,t,m,1,1,!0),this.e1=this.e2=-1,s=1),l&&(this.addCurrentVertex(j,s,t,n,-1,-1,!0),this.addCurrentVertex(j,s,t,n,0,0,!1)));u=!1}}}},d.prototype.addCurrentVertex=function(a,b,c,d,e,f,g){var h,i=g?1:0,j=this.buffers.lineVertex,k=this.buffers.lineElement,l=this.elementGroups.current,m=this.elementGroups.current.vertexStartIndex;h=d.mult(b),e&&h._sub(d.perp()._mult(e)),this.e3=j.add(a,h,i,0,c)-m,this.e1>=0&&this.e2>=0&&(k.add(this.e1,this.e2,this.e3),l.elementLength++),this.e1=this.e2,this.e2=this.e3,h=d.mult(-b),f&&h._sub(d.perp()._mult(f)),this.e3=j.add(a,h,i,1,c)-m,this.e1>=0&&this.e2>=0&&(k.add(this.e1,this.e2,this.e3),l.elementLength++),this.e1=this.e2,this.e2=this.e3,l.vertexLength+=2},d.prototype.addPieSliceVertex=function(a,b,c,d,e){var f=this.buffers.lineVertex,g=this.buffers.lineElement,h=this.elementGroups.current,i=this.elementGroups.current.vertexStartIndex,j=e;d=d.mult(b*(e?-1:1)),this.e3=f.add(a,d,0,j,c)-i,h.vertexLength+=1,this.e1>=0&&this.e2>=0&&(g.add(this.e1,this.e2,this.e3),h.elementLength++),e?this.e2=this.e3:this.e1=this.e3}},{"./element_groups":14}],18:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.buffers=a,this.layoutProperties=b,this.overscaling=c,this.zoom=d,this.collisionDebug=e;var f=512*c,g=4096;this.tilePixelRatio=g/f,this.compareText={},this.symbolInstances=[]}function e(a,b,c,d,e,f,g,h,i,j,k,l){this.x=a.x,this.y=a.y,this.hasText=!!c,this.hasIcon=!!d,this.hasText&&(this.glyphQuads=f?q(a,c,g,b,e,i):[],this.textCollisionFeature=new u(b,a,c,g,h,i)),this.hasIcon&&(this.iconQuads=f?r(a,d,j,b,e,l):[],this.iconCollisionFeature=new u(b,a,d,j,k,l))}var f=a("./element_groups"),g=a("../symbol/anchor"),h=a("../symbol/get_anchors"),i=a("../util/token"),j=a("../symbol/quads"),k=a("../symbol/shaping"),l=a("../symbol/resolve_text"),m=a("../symbol/resolve_icons"),n=a("../symbol/mergelines"),o=k.shapeText,p=k.shapeIcon,q=j.getGlyphQuads,r=j.getIconQuads,s=a("../symbol/clip_line"),t=a("point-geometry"),u=a("../symbol/collision_feature");b.exports=d,d.prototype.needsPlacement=!0,d.prototype.addFeatures=function(a){var b=this.layoutProperties,c=this.features,d=this.textFeatures,e=.5,f=.5;switch(b["text-anchor"]){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(b["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}for(var g="right"===b["text-justify"]?1:"left"===b["text-justify"]?0:.5,h=24,j=b["text-line-height"]*h,k="line"!==b["symbol-placement"]?b["text-max-width"]*h:0,l=b["text-letter-spacing"]*h,m=[b["text-offset"][0]*h,b["text-offset"][1]*h],q=b["text-font"].join(","),r=[],s=0;s<c.length;s++)r.push(c[s].loadGeometry());if("line"===b["symbol-placement"]){var t=n(c,d,r);r=t.geometries,c=t.features,d=t.textFeatures}for(var u,v,w=0;w<c.length;w++)if(r[w]){if(u=d[w]?o(d[w],this.stacks[q],k,j,e,f,g,l,m):null,b["icon-image"]){var x=i(c[w].properties,b["icon-image"]),y=this.icons[x];v=p(y,b),y&&(void 0===this.sdfIcons?this.sdfIcons=y.sdf:this.sdfIcons!==y.sdf&&console.warn("Style sheet warning: Cannot mix SDF and non-SDF icons in one bucket"))}else v=null;(u||v)&&this.addFeature(r[w],u,v)}this.placeFeatures(a,this.buffers,this.collisionDebug)},d.prototype.addFeature=function(a,b,c){var d=this.layoutProperties,f=24,i=d["text-size"]/f,j=this.tilePixelRatio*i,k=this.tilePixelRatio*d["text-max-size"]/f,l=this.tilePixelRatio*d["icon-size"],m=this.tilePixelRatio*d["symbol-spacing"],n=d["symbol-avoid-edges"],o=d["text-padding"]*this.tilePixelRatio,p=d["icon-padding"]*this.tilePixelRatio,q=d["text-max-angle"]/180*Math.PI,r="map"===d["text-rotation-alignment"]&&"line"===d["symbol-placement"],t="map"===d["icon-rotation-alignment"]&&"line"===d["symbol-placement"],u=d["text-allow-overlap"]||d["icon-allow-overlap"]||d["text-ignore-placement"]||d["icon-ignore-placement"],v="line"===d["symbol-placement"],w=m/2;v&&(a=s(a,0,0,4096,4096));for(var x=0;x<a.length;x++)for(var y=a[x],z=v?h(y,m,q,b,c,f,k,this.overscaling):[new g(y[0].x,y[0].y,0)],A=0,B=z.length;B>A;A++){var C=z[A];if(!(b&&v&&this.anchorIsTooClose(b.text,w,C))){var D=!(C.x<0||C.x>4096||C.y<0||C.y>4096);if(!n||D){var E=D||u;this.symbolInstances.push(new e(C,y,b,c,d,E,j,o,r,l,p,t))}}}},d.prototype.anchorIsTooClose=function(a,b,c){var d=this.compareText;if(a in d){for(var e=d[a],f=e.length-1;f>=0;f--)if(c.dist(e[f])<b)return!0}else d[a]=[];return d[a].push(c),!1},d.prototype.placeFeatures=function(a,b,c){this.buffers=b;var d=this.elementGroups={text:new f(b.glyphVertex,b.glyphElement),icon:new f(b.iconVertex,b.iconElement),sdfIcons:this.sdfIcons},e=this.layoutProperties,g=a.maxScale;d.text["text-size"]=e["text-size"],d.icon["icon-size"]=e["icon-size"];var h="map"===e["text-rotation-alignment"]&&"line"===e["symbol-placement"],i="map"===e["icon-rotation-alignment"]&&"line"===e["symbol-placement"],j=e["text-allow-overlap"]||e["icon-allow-overlap"]||e["text-ignore-placement"]||e["icon-ignore-placement"];if(j){var k=a.angle,l=Math.sin(k),m=Math.cos(k);this.symbolInstances.sort(function(a,b){var c=l*a.x+m*a.y,d=l*b.x+m*b.y;return d-c})}for(var n=0;n<this.symbolInstances.length;n++){var o=this.symbolInstances[n],p=o.hasText,q=o.hasIcon,r=e["text-optional"]||!p,s=e["icon-optional"]||!q,t=p&&!e["text-allow-overlap"]?a.placeCollisionFeature(o.textCollisionFeature):a.minScale,u=q&&!e["icon-allow-overlap"]?a.placeCollisionFeature(o.iconCollisionFeature):a.minScale;r||s?!s&&t?t=Math.max(u,t):!r&&u&&(u=Math.max(u,t)):u=t=Math.max(u,t),p&&(e["text-ignore-placement"]||a.insertCollisionFeature(o.textCollisionFeature,t),g>=t&&this.addSymbols(b.glyphVertex,b.glyphElement,d.text,o.glyphQuads,t,e["text-keep-upright"],h,a.angle)),q&&(e["icon-ignore-placement"]||a.insertCollisionFeature(o.iconCollisionFeature,u),g>=u&&this.addSymbols(b.iconVertex,b.iconElement,d.icon,o.iconQuads,u,e["icon-keep-upright"],i,a.angle))}c&&this.addToDebugBuffers(a)},d.prototype.addSymbols=function(a,b,c,d,e,f,g,h){c.makeRoomFor(4*d.length);for(var i=c.current,j=this.zoom,k=Math.max(Math.log(e)/Math.LN2+j,0),l=0;l<d.length;l++){var m=d[l],n=m.angle,o=(n+h+Math.PI)%(2*Math.PI);if(!(f&&g&&(o<=Math.PI/2||o>3*Math.PI/2))){var p=m.tl,q=m.tr,r=m.bl,s=m.br,t=m.tex,u=m.anchorPoint,v=Math.max(j+Math.log(m.minScale)/Math.LN2,k),w=Math.min(j+Math.log(m.maxScale)/Math.LN2,25);if(!(v>=w)){v===k&&(v=0);var x=a.index-i.vertexStartIndex;a.add(u.x,u.y,p.x,p.y,t.x,t.y,v,w,k),a.add(u.x,u.y,q.x,q.y,t.x+t.w,t.y,v,w,k),a.add(u.x,u.y,r.x,r.y,t.x,t.y+t.h,v,w,k),a.add(u.x,u.y,s.x,s.y,t.x+t.w,t.y+t.h,v,w,k),i.vertexLength+=4,b.add(x,x+1,x+2),b.add(x+1,x+2,x+3),i.elementLength+=2}}}},d.prototype.getDependencies=function(a,b,c){function d(a){return a||e?c(a):void(e=!0)}var e=!1;this.getTextDependencies(a,b,d),this.getIconDependencies(a,b,d)},d.prototype.getIconDependencies=function(a,b,c){function d(a,b){return a?c(a):(this.icons=b,void c())}if(this.layoutProperties["icon-image"]){var e=this.features,f=m(e,this.layoutProperties);f.length?b.send("get icons",{icons:f},d.bind(this)):c()}else c()},d.prototype.getTextDependencies=function(a,b,c){var d=this.features,e=this.layoutProperties["text-font"],f=this.stacks=a.stacks;void 0===f[e]&&(f[e]={});var g=f[e],h=l(d,this.layoutProperties,g);this.textFeatures=h.textFeatures,b.send("get glyphs",{uid:a.uid,fontstack:e,codepoints:h.codepoints},function(a,b){if(a)return c(a);for(var d in b)g[d]=b[d];c()})},d.prototype.addToDebugBuffers=function(a){this.elementGroups.collisionBox=new f(this.buffers.collisionBoxVertex),this.elementGroups.collisionBox.makeRoomFor(0);for(var b=this.buffers.collisionBoxVertex,c=-a.angle,d=a.yStretch,e=0;e<this.symbolInstances.length;e++)for(var g=0;2>g;g++){var h=this.symbolInstances[e][0===g?"textCollisionFeature":"iconCollisionFeature"];if(h)for(var i=h.boxes,j=0;j<i.length;j++){var k=i[j],l=k.anchorPoint,m=new t(k.x1,k.y1*d)._rotate(c),n=new t(k.x2,k.y1*d)._rotate(c),o=new t(k.x1,k.y2*d)._rotate(c),p=new t(k.x2,k.y2*d)._rotate(c),q=Math.max(0,Math.min(25,this.zoom+Math.log(k.maxScale)/Math.LN2)),r=Math.max(0,Math.min(25,this.zoom+Math.log(k.placementScale)/Math.LN2));b.add(l,m,q,r),b.add(l,n,q,r),b.add(l,n,q,r),b.add(l,p,q,r),b.add(l,p,q,r),b.add(l,o,q,r),b.add(l,o,q,r),b.add(l,m,q,r),this.elementGroups.collisionBox.current.vertexLength+=8}}}},{"../symbol/anchor":62,"../symbol/clip_line":65,"../symbol/collision_feature":67,"../symbol/get_anchors":69,"../symbol/mergelines":72,"../symbol/quads":73,"../symbol/resolve_icons":74,"../symbol/resolve_text":75,"../symbol/shaping":76,"../util/token":105,"./element_groups":14,"point-geometry":137}],19:[function(a,b,c){"use strict";function d(a,b,c){this.column=a,this.row=b,this.zoom=c}b.exports=d,d.prototype={clone:function(){return new d(this.column,this.row,this.zoom)},zoomTo:function(a){return this.clone()._zoomTo(a)},sub:function(a){return this.clone()._sub(a)},_zoomTo:function(a){var b=Math.pow(2,a-this.zoom);return this.column*=b,this.row*=b,this.zoom=a,this},_sub:function(a){return a=a.zoomTo(this.zoom),this.column-=a.column,this.row-=a.row,this}}},{}],20:[function(a,b,c){"use strict";function d(a,b){if(isNaN(a)||isNaN(b))throw new Error("Invalid LngLat object: ("+a+", "+b+")");if(this.lng=+a,this.lat=+b,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}b.exports=d;var e=a("../util/util").wrap;d.prototype.wrap=function(){return new d(e(this.lng,-180,180),this.lat)},d.convert=function(a){return a instanceof d?a:Array.isArray(a)?new d(a[0],a[1]):a}},{"../util/util":106}],21:[function(a,b,c){"use strict";function d(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])}b.exports=d;var e=a("./lng_lat");d.prototype={extend:function(a){var b,c,f=this._sw,g=this._ne;if(a instanceof e)b=a,c=a;else{if(!(a instanceof d))return a?this.extend(e.convert(a)||d.convert(a)):this;if(b=a._sw,c=a._ne,!b||!c)return this}return f||g?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),g.lng=Math.max(c.lng,g.lng),g.lat=Math.max(c.lat,g.lat)):(this._sw=new e(b.lng,b.lat),this._ne=new e(c.lng,c.lat)),this},getCenter:function(){return new e((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getNorthWest:function(){return new e(this.getWest(),this.getNorth())},getSouthEast:function(){return new e(this.getEast(),this.getSouth())},getWest:function(){return this._sw.lng},getSouth:function(){return this._sw.lat},getEast:function(){return this._ne.lng},getNorth:function(){return this._ne.lat}},d.convert=function(a){return!a||a instanceof d?a:new d(a)}},{"./lng_lat":20}],22:[function(a,b,c){"use strict";function d(a,b){this.tileSize=512,this._minZoom=a||0,this._maxZoom=b||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this.zoom=0,this.center=new e(0,0),this.angle=0,this._altitude=1.5,this._pitch=0}var e=a("./lng_lat"),f=a("point-geometry"),g=a("./coordinate"),h=a("../util/util").wrap,i=a("../util/interpolate"),j=a("gl-matrix").vec4,k=a("gl-matrix").mat4;b.exports=d,d.prototype={get minZoom(){return this._minZoom},set minZoom(a){this._minZoom=a,this.zoom=Math.max(this.zoom,a)},get maxZoom(){return this._maxZoom},set maxZoom(a){this._maxZoom=a,this.zoom=Math.min(this.zoom,a)},get worldSize(){return this.tileSize*this.scale},get centerPoint(){return this.size._div(2)},get size(){return new f(this.width,this.height)},get bearing(){return-this.angle/Math.PI*180},set bearing(a){this.angle=-h(a,-180,180)*Math.PI/180},get pitch(){return this._pitch/Math.PI*180},set pitch(a){this._pitch=Math.min(60,a)/180*Math.PI},get altitude(){return this._altitude},set altitude(a){this._altitude=Math.max(.75,a)},get zoom(){return this._zoom},set zoom(a){a=Math.min(Math.max(a,this.minZoom),this.maxZoom),this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom,this._constrain()},zoomScale:function(a){return Math.pow(2,a)},scaleZoom:function(a){return Math.log(a)/Math.LN2},project:function(a,b){return new f(this.lngX(a.lng,b),this.latY(a.lat,b))},unproject:function(a,b){return new e(this.xLng(a.x,b),this.yLat(a.y,b))},get x(){return this.lngX(this.center.lng)},get y(){return this.latY(this.center.lat)},get point(){return new f(this.x,this.y)},lngX:function(a,b){return(180+a)*(b||this.worldSize)/360},latY:function(a,b){var c=180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360));return(180-c)*(b||this.worldSize)/360},xLng:function(a,b){return 360*a/(b||this.worldSize)-180},yLat:function(a,b){var c=180-360*a/(b||this.worldSize);return 360/Math.PI*Math.atan(Math.exp(c*Math.PI/180))-90},panBy:function(a){var b=this.centerPoint._add(a);this.center=this.pointLocation(b),this._constrain()},setLocationAtPoint:function(a,b){var c=this.locationCoordinate(a),d=this.pointCoordinate(b),e=this.pointCoordinate(this.centerPoint),f=d._sub(c);this.center=this.coordinateLocation(e._sub(f)),this._constrain()},setZoomAround:function(a,b){var c;b&&(c=this.locationPoint(b)),this.zoom=a,b&&this.setLocationAtPoint(b,c)},setBearingAround:function(a,b){var c;b&&(c=this.locationPoint(b)),this.bearing=a,b&&this.setLocationAtPoint(b,c)},locationPoint:function(a){return this.coordinatePoint(this.locationCoordinate(a))},pointLocation:function(a){return this.coordinateLocation(this.pointCoordinate(a))},locationCoordinate:function(a){var b=this.zoomScale(this.tileZoom)/this.worldSize,c=e.convert(a);return new g(this.lngX(c.lng)*b,this.latY(c.lat)*b,this.tileZoom)},coordinateLocation:function(a){var b=this.zoomScale(a.zoom);return new e(this.xLng(a.column,b),this.yLat(a.row,b))},pointCoordinate:function(a,b){void 0===b&&(b=0);var c=this.coordinatePointMatrix(this.tileZoom),d=k.invert(new Float64Array(16),c);if(!d)throw"failed to invert matrix";var e=j.transformMat4([],[a.x,a.y,0,1],d),f=j.transformMat4([],[a.x,a.y,1,1],d),h=e[3],l=f[3],m=e[0]/h,n=f[0]/l,o=e[1]/h,p=f[1]/l,q=e[2]/h,r=f[2]/l,s=q===r?0:(b-q)/(r-q);return new g(i(m,n,s),i(o,p,s),this.tileZoom)},coordinatePoint:function(a){var b=this.coordinatePointMatrix(a.zoom),c=j.transformMat4([],[a.column,a.row,0,1],b);return new f(c[0]/c[3],c[1]/c[3])},coordinatePointMatrix:function(a){var b=this.getProjMatrix(),c=this.worldSize/this.zoomScale(a);return k.scale(b,b,[c,c,1]),k.multiply(b,this.getPixelMatrix(),b),b},getPixelMatrix:function(){var a=k.create();return k.scale(a,a,[this.width/2,-this.height/2,1]),k.translate(a,a,[1,-1,0]),a},_constrain:function(){if(this.center){var a,b,c,d,e,g,h,i,j=this.size;this.latRange&&(a=this.latY(this.latRange[1]),b=this.latY(this.latRange[0]),e=b-a<j.y?j.y/(b-a):0),this.lngRange&&(c=this.lngX(this.lngRange[0]),d=this.lngX(this.lngRange[1]),g=d-c<j.x?j.x/(d-c):0);var k=Math.max(g||0,e||0);if(k)return this.center=this.unproject(new f(g?(d+c)/2:this.x,e?(b+a)/2:this.y)),void(this.zoom+=this.scaleZoom(k));if(this.latRange){var l=this.y,m=j.y/2;a>l-m&&(i=a+m),l+m>b&&(i=b-m)}if(this.lngRange){var n=this.x,o=j.x/2;c>n-o&&(h=c+o),n+o>d&&(h=d-o)}(void 0!==h||void 0!==i)&&(this.center=this.unproject(new f(void 0!==h?h:this.x,void 0!==i?i:this.y)))}},getProjMatrix:function(){var a=new Float64Array(16),b=Math.atan(.5/this.altitude),c=Math.sin(b)*this.altitude/Math.sin(Math.PI/2-this._pitch-b),d=Math.cos(Math.PI/2-this._pitch)*c+this.altitude;return k.perspective(a,2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,d),k.translate(a,a,[0,0,-this.altitude]),k.scale(a,a,[1,-1,1/this.height]),k.rotateX(a,a,this._pitch),k.rotateZ(a,a,this.angle),k.translate(a,a,[-this.x,-this.y,0]),a}}},{"../util/interpolate":102,"../util/util":106,"./coordinate":19,"./lng_lat":20,"gl-matrix":119,"point-geometry":137}],23:[function(a,b,c){"use strict";var d={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],
"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};b.exports=function(a,b,c,e){e=e||1;var f,g,h,i,j,k,l,m,n=[];for(f=0,g=a.length;g>f;f++)if(j=d[a[f]]){for(m=null,h=0,i=j[1].length;i>h;h+=2)-1===j[1][h]&&-1===j[1][h+1]?m=null:(k=b+j[1][h]*e,l=c-j[1][h+1]*e,m&&n.push(m.x,m.y,k,l),m={x:k,y:l});b+=j[0]*e}return n}},{}],24:[function(a,b,c){"use strict";var d=b.exports={};d.Map=a("./ui/map"),d.Control=a("./ui/control/control"),d.Navigation=a("./ui/control/navigation"),d.Attribution=a("./ui/control/attribution"),d.Popup=a("./ui/popup"),d.GeoJSONSource=a("./source/geojson_source"),d.VideoSource=a("./source/video_source"),d.ImageSource=a("./source/image_source"),d.Style=a("./style/style"),d.LngLat=a("./geo/lng_lat"),d.LngLatBounds=a("./geo/lng_lat_bounds"),d.Point=a("point-geometry"),d.Evented=a("./util/evented"),d.util=a("./util/util"),d.supported=a("./util/browser").supported;var e=a("./util/ajax");d.util.getJSON=e.getJSON,d.util.getArrayBuffer=e.getArrayBuffer;var f=a("./util/config");d.config=f,Object.defineProperty(d,"accessToken",{get:function(){return f.ACCESS_TOKEN},set:function(a){f.ACCESS_TOKEN=a}})},{"./geo/lng_lat":20,"./geo/lng_lat_bounds":21,"./source/geojson_source":39,"./source/image_source":41,"./source/video_source":48,"./style/style":56,"./ui/control/attribution":79,"./ui/control/control":80,"./ui/control/navigation":81,"./ui/map":91,"./ui/popup":92,"./util/ajax":94,"./util/browser":95,"./util/config":99,"./util/evented":100,"./util/util":106,"point-geometry":137}],25:[function(a,b,c){"use strict";function d(a,b,c){var d,f=a.gl,g=b.paint["background-color"],h=b.paint["background-pattern"],i=b.paint["background-opacity"],j=h?a.spriteAtlas.getPosition(h.from,!0):null,k=h?a.spriteAtlas.getPosition(h.to,!0):null;if(j&&k){d=a.patternShader,f.switchShader(d,c),f.uniform1i(d.u_image,0),f.uniform2fv(d.u_pattern_tl_a,j.tl),f.uniform2fv(d.u_pattern_br_a,j.br),f.uniform2fv(d.u_pattern_tl_b,k.tl),f.uniform2fv(d.u_pattern_br_b,k.br),f.uniform1f(d.u_opacity,i);var l=a.transform,m=j.size,n=k.size,o=l.locationCoordinate(l.center),p=1/Math.pow(2,l.zoomFraction);f.uniform1f(d.u_mix,h.t);var q=e.create();e.scale(q,q,[1/(m[0]*h.fromScale),1/(m[1]*h.fromScale)]),e.translate(q,q,[o.column*l.tileSize%(m[0]*h.fromScale),o.row*l.tileSize%(m[1]*h.fromScale)]),e.rotate(q,q,-l.angle),e.scale(q,q,[p*l.width/2,-p*l.height/2]);var r=e.create();e.scale(r,r,[1/(n[0]*h.toScale),1/(n[1]*h.toScale)]),e.translate(r,r,[o.column*l.tileSize%(n[0]*h.toScale),o.row*l.tileSize%(n[1]*h.toScale)]),e.rotate(r,r,-l.angle),e.scale(r,r,[p*l.width/2,-p*l.height/2]),f.uniformMatrix3fv(d.u_patternmatrix_a,!1,q),f.uniformMatrix3fv(d.u_patternmatrix_b,!1,r),a.spriteAtlas.bind(f,!0)}else d=a.fillShader,f.switchShader(d,c),f.uniform4fv(d.u_color,g);f.disable(f.STENCIL_TEST),f.bindBuffer(f.ARRAY_BUFFER,a.backgroundBuffer),f.vertexAttribPointer(d.a_pos,a.backgroundBuffer.itemSize,f.SHORT,!1,0,0),f.drawArrays(f.TRIANGLE_STRIP,0,a.backgroundBuffer.itemCount),f.enable(f.STENCIL_TEST),f.stencilMask(0),f.stencilFunc(f.EQUAL,128,128)}var e=a("gl-matrix").mat3;b.exports=d},{"gl-matrix":119}],26:[function(a,b,c){"use strict";function d(a,b,c,d){if(d.buffers){c=a.translateMatrix(c,d,b.paint["circle-translate"],b.paint["circle-translate-anchor"]);var f=d.elementGroups[b.ref||b.id];if(f){var g=a.gl;g.disable(g.STENCIL_TEST),g.switchShader(a.circleShader,c,d.exMatrix);var h=d.buffers.circleVertex,i=a.circleShader,j=d.buffers.circleElement,k=1/e.devicePixelRatio/b.paint["circle-radius"];g.uniform4fv(i.u_color,b.paint["circle-color"]),g.uniform1f(i.u_blur,Math.max(b.paint["circle-blur"],k)),g.uniform1f(i.u_size,b.paint["circle-radius"]);for(var l=0;l<f.groups.length;l++){var m=f.groups[l],n=m.vertexStartIndex*h.itemSize;h.bind(g,i,n),j.bind(g,i,n);var o=3*m.elementLength,p=m.elementStartIndex*j.itemSize;g.drawElements(g.TRIANGLES,o,g.UNSIGNED_SHORT,p)}g.enable(g.STENCIL_TEST)}}}var e=a("../util/browser.js");b.exports=d},{"../util/browser.js":95}],27:[function(a,b,c){"use strict";function d(a,b,c,d){var e=d.elementGroups[b.ref||b.id].collisionBox;if(e){var f=a.gl,g=d.buffers.collisionBoxVertex,h=a.collisionBoxShader;f.enable(f.STENCIL_TEST),f.switchShader(h,c),g.bind(f,h),f.lineWidth(1);var i=12;f.vertexAttribPointer(h.a_pos,2,f.SHORT,!1,i,0),f.vertexAttribPointer(h.a_extrude,2,f.SHORT,!1,i,4),f.vertexAttribPointer(h.a_data,2,f.UNSIGNED_BYTE,!1,i,8),f.uniform1f(h.u_scale,Math.pow(2,a.transform.zoom-d.coord.z)),f.uniform1f(h.u_zoom,10*a.transform.zoom),f.uniform1f(h.u_maxzoom,10*(d.coord.z+1));var j=e.groups[0].vertexStartIndex,k=e.groups[0].vertexLength;f.drawArrays(f.LINES,j,k),f.disable(f.STENCIL_TEST)}}b.exports=d},{}],28:[function(a,b,c){"use strict";function d(a,b){var c=a.gl;c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.switchShader(a.debugShader,b.posMatrix),c.bindBuffer(c.ARRAY_BUFFER,a.debugBuffer),c.vertexAttribPointer(a.debugShader.a_pos,a.debugBuffer.itemSize,c.SHORT,!1,0,0),c.uniform4f(a.debugShader.u_color,1,0,0,1),c.lineWidth(4),c.drawArrays(c.LINE_STRIP,0,a.debugBuffer.itemCount);var d=e(b.coord.toString(),50,200,5);c.bindBuffer(c.ARRAY_BUFFER,a.debugTextBuffer),c.bufferData(c.ARRAY_BUFFER,new Int16Array(d),c.STREAM_DRAW),c.vertexAttribPointer(a.debugShader.a_pos,a.debugTextBuffer.itemSize,c.SHORT,!1,0,0),c.lineWidth(8*f.devicePixelRatio),c.uniform4f(a.debugShader.u_color,1,1,1,1),c.drawArrays(c.LINES,0,d.length/a.debugTextBuffer.itemSize),c.lineWidth(2*f.devicePixelRatio),c.uniform4f(a.debugShader.u_color,0,0,0,1),c.drawArrays(c.LINES,0,d.length/a.debugTextBuffer.itemSize),c.blendFunc(c.ONE_MINUS_DST_ALPHA,c.ONE)}var e=a("../lib/debugtext"),f=a("../util/browser");b.exports=d},{"../lib/debugtext":23,"../util/browser":95}],29:[function(a,b,c){"use strict";function d(a,b,c,d){if(d.buffers){var g=d.elementGroups[b.ref||b.id];if(g){var h,i,j,k,l=a.gl,m=a.translateMatrix(c,d,b.paint["fill-translate"],b.paint["fill-translate-anchor"]),n=b.paint["fill-color"];l.stencilMask(63),l.clear(l.STENCIL_BUFFER_BIT),l.stencilFunc(l.NOTEQUAL,128,128),l.stencilOpSeparate(l.FRONT,l.INCR_WRAP,l.KEEP,l.KEEP),l.stencilOpSeparate(l.BACK,l.DECR_WRAP,l.KEEP,l.KEEP),l.colorMask(!1,!1,!1,!1),l.switchShader(a.fillShader,m),h=d.buffers.fillVertex,h.bind(l),i=d.buffers.fillElement,i.bind(l);for(var o,p,q=0;q<g.groups.length;q++)j=g.groups[q],o=j.vertexStartIndex*h.itemSize,l.vertexAttribPointer(a.fillShader.a_pos,2,l.SHORT,!1,4,o+0),k=3*j.elementLength,p=j.elementStartIndex*i.itemSize,l.drawElements(l.TRIANGLES,k,l.UNSIGNED_SHORT,p);l.colorMask(!0,!0,!0,!0),l.stencilOp(l.KEEP,l.KEEP,l.KEEP),l.stencilMask(0);var r=b.paint["fill-outline-color"];if(b.paint["fill-antialias"]===!0&&(!b.paint["fill-pattern"]||r)){l.switchShader(a.outlineShader,m),l.lineWidth(2*e.devicePixelRatio),r?l.stencilFunc(l.EQUAL,128,128):l.stencilFunc(l.EQUAL,128,191),l.uniform2f(a.outlineShader.u_world,l.drawingBufferWidth,l.drawingBufferHeight),l.uniform4fv(a.outlineShader.u_color,r?r:n),h=d.buffers.fillVertex,i=d.buffers.outlineElement,i.bind(l);for(var s=0;s<g.groups.length;s++)j=g.groups[s],o=j.vertexStartIndex*h.itemSize,l.vertexAttribPointer(a.outlineShader.a_pos,2,l.SHORT,!1,4,o+0),k=2*j.secondElementLength,p=j.secondElementStartIndex*i.itemSize,l.drawElements(l.LINES,k,l.UNSIGNED_SHORT,p)}var t,u=b.paint["fill-pattern"],v=b.paint["fill-opacity"]||1;if(u){var w=a.spriteAtlas.getPosition(u.from,!0),x=a.spriteAtlas.getPosition(u.to,!0);if(!w||!x)return;t=a.patternShader,l.switchShader(t,c),l.uniform1i(t.u_image,0),l.uniform2fv(t.u_pattern_tl_a,w.tl),l.uniform2fv(t.u_pattern_br_a,w.br),l.uniform2fv(t.u_pattern_tl_b,x.tl),l.uniform2fv(t.u_pattern_br_b,x.br),l.uniform1f(t.u_opacity,v),l.uniform1f(t.u_mix,u.t);var y=d.tileExtent/d.tileSize/Math.pow(2,a.transform.tileZoom-d.coord.z),z=f.create();f.scale(z,z,[1/(w.size[0]*y*u.fromScale),1/(w.size[1]*y*u.fromScale)]);var A=f.create();f.scale(A,A,[1/(x.size[0]*y*u.toScale),1/(x.size[1]*y*u.toScale)]),l.uniformMatrix3fv(t.u_patternmatrix_a,!1,z),l.uniformMatrix3fv(t.u_patternmatrix_b,!1,A),a.spriteAtlas.bind(l,!0)}else t=a.fillShader,l.switchShader(t,c),l.uniform4fv(t.u_color,n);l.stencilFunc(l.NOTEQUAL,0,63),l.bindBuffer(l.ARRAY_BUFFER,a.tileExtentBuffer),l.vertexAttribPointer(t.a_pos,a.tileExtentBuffer.itemSize,l.SHORT,!1,0,0),l.drawArrays(l.TRIANGLE_STRIP,0,a.tileExtentBuffer.itemCount),l.stencilMask(0),l.stencilFunc(l.EQUAL,128,128)}}}var e=a("../util/browser"),f=a("gl-matrix").mat3;b.exports=d},{"../util/browser":95,"gl-matrix":119}],30:[function(a,b,c){"use strict";var d=a("../util/browser"),e=a("gl-matrix").mat2;b.exports=function(a,b,c,f){if(f.buffers){var g=f.elementGroups[b.ref||b.id];if(g){var h=a.gl;if(!(b.paint["line-width"]<=0)){var i=1/d.devicePixelRatio,j=b.paint["line-blur"]+i,k=b.paint["line-width"]/2,l=-1,m=0,n=0;b.paint["line-gap-width"]>0&&(l=b.paint["line-gap-width"]/2+.5*i,k=b.paint["line-width"],m=l-i/2);var o=m+k+i/2+n,p=b.paint["line-color"],q=a.transform.scale/(1<<f.coord.z)/(f.tileExtent/f.tileSize),r=a.translateMatrix(c,f,b.paint["line-translate"],b.paint["line-translate-anchor"]),s=a.transform,t=e.create();e.scale(t,t,[1,Math.cos(s._pitch)]),e.rotate(t,t,a.transform.angle);var u,v=Math.sqrt(s.height*s.height/4*(1+s.altitude*s.altitude)),w=s.height/2*Math.tan(s._pitch),x=(v+w)/v-1,y=f.tileSize/a.transform.tileSize,z=b.paint["line-dasharray"],A=b.paint["line-pattern"];if(z){u=a.linesdfpatternShader,h.switchShader(u,r,f.exMatrix),h.uniform2fv(u.u_linewidth,[o,l]),h.uniform1f(u.u_ratio,q),h.uniform1f(u.u_blur,j),h.uniform4fv(u.u_color,p);var B=a.lineAtlas.getDash(z.from,"round"===b.layout["line-cap"]),C=a.lineAtlas.getDash(z.to,"round"===b.layout["line-cap"]);a.lineAtlas.bind(h);var D=Math.pow(2,Math.floor(Math.log(a.transform.scale)/Math.LN2)-f.coord.z)/8*y,E=[D/B.width/z.fromScale,-B.height/2],F=a.lineAtlas.width/(z.fromScale*B.width*256*d.devicePixelRatio)/2,G=[D/C.width/z.toScale,-C.height/2],H=a.lineAtlas.width/(z.toScale*C.width*256*d.devicePixelRatio)/2;h.uniform2fv(u.u_patternscale_a,E),h.uniform1f(u.u_tex_y_a,B.y),h.uniform2fv(u.u_patternscale_b,G),h.uniform1f(u.u_tex_y_b,C.y),h.uniform1i(u.u_image,0),h.uniform1f(u.u_sdfgamma,Math.max(F,H)),h.uniform1f(u.u_mix,z.t),h.uniform1f(u.u_extra,x),h.uniformMatrix2fv(u.u_antialiasingmatrix,!1,t)}else if(A){var I=a.spriteAtlas.getPosition(A.from,!0),J=a.spriteAtlas.getPosition(A.to,!0);if(!I||!J)return;var K=f.tileExtent/f.tileSize/Math.pow(2,a.transform.tileZoom-f.coord.z)*y;a.spriteAtlas.bind(h,!0),u=a.linepatternShader,h.switchShader(u,r,f.exMatrix),h.uniform2fv(u.u_linewidth,[o,l]),h.uniform1f(u.u_ratio,q),h.uniform1f(u.u_blur,j),h.uniform2fv(u.u_pattern_size_a,[I.size[0]*K*A.fromScale,J.size[1]]),h.uniform2fv(u.u_pattern_size_b,[J.size[0]*K*A.toScale,J.size[1]]),h.uniform2fv(u.u_pattern_tl_a,I.tl),h.uniform2fv(u.u_pattern_br_a,I.br),h.uniform2fv(u.u_pattern_tl_b,J.tl),h.uniform2fv(u.u_pattern_br_b,J.br),h.uniform1f(u.u_fade,A.t),h.uniform1f(u.u_opacity,b.paint["line-opacity"]),h.uniform1f(u.u_extra,x),h.uniformMatrix2fv(u.u_antialiasingmatrix,!1,t)}else u=a.lineShader,h.switchShader(u,r,f.exMatrix),h.uniform2fv(u.u_linewidth,[o,l]),h.uniform1f(u.u_ratio,q),h.uniform1f(u.u_blur,j),h.uniform1f(u.u_extra,x),h.uniformMatrix2fv(u.u_antialiasingmatrix,!1,t),h.uniform4fv(u.u_color,p);var L=f.buffers.lineVertex;L.bind(h);var M=f.buffers.lineElement;M.bind(h);for(var N=0;N<g.groups.length;N++){var O=g.groups[N],P=O.vertexStartIndex*L.itemSize;h.vertexAttribPointer(u.a_pos,2,h.SHORT,!1,8,P+0),h.vertexAttribPointer(u.a_data,4,h.BYTE,!1,8,P+4);var Q=3*O.elementLength,R=O.elementStartIndex*M.itemSize;h.drawElements(h.TRIANGLES,Q,h.UNSIGNED_SHORT,R)}}}}}},{"../util/browser":95,"gl-matrix":119}],31:[function(a,b,c){"use strict";function d(a,b,c,d){var i=a.gl;i.disable(i.STENCIL_TEST);var j=a.rasterShader;i.switchShader(j,c),i.uniform1f(j.u_brightness_low,b.paint["raster-brightness-min"]),i.uniform1f(j.u_brightness_high,b.paint["raster-brightness-max"]),i.uniform1f(j.u_saturation_factor,g(b.paint["raster-saturation"])),i.uniform1f(j.u_contrast_factor,f(b.paint["raster-contrast"])),i.uniform3fv(j.u_spin_weights,e(b.paint["raster-hue-rotate"]));var k,l,m=d.source&&d.source._pyramid.findLoadedParent(d.coord,0,{}),n=h(d,m,b,a.transform);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,d.texture),m?(i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,m.texture),k=Math.pow(2,m.coord.z-d.coord.z),l=[d.coord.x*k%1,d.coord.y*k%1]):n[1]=0,i.uniform2fv(j.u_tl_parent,l||[0,0]),i.uniform1f(j.u_scale_parent,k||1),i.uniform1f(j.u_buffer_scale,1),i.uniform1f(j.u_opacity0,n[0]),i.uniform1f(j.u_opacity1,n[1]),i.uniform1i(j.u_image0,0),i.uniform1i(j.u_image1,1),i.bindBuffer(i.ARRAY_BUFFER,d.boundsBuffer||a.tileExtentBuffer),i.vertexAttribPointer(j.a_pos,2,i.SHORT,!1,8,0),i.vertexAttribPointer(j.a_texture_pos,2,i.SHORT,!1,8,4),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.enable(i.STENCIL_TEST)}function e(a){a*=Math.PI/180;var b=Math.sin(a),c=Math.cos(a);return[(2*c+1)/3,(-Math.sqrt(3)*b-c+1)/3,(Math.sqrt(3)*b-c+1)/3]}function f(a){return a>0?1/(1-a):1+a}function g(a){return a>0?1-1/(1.001-a):-a}function h(a,b,c,d){if(!a.source)return[1,0];var e=(new Date).getTime(),f=c.paint["raster-fade-duration"],g=(e-a.timeAdded)/f,h=b?(e-b.timeAdded)/f:-1,j=a.source._pyramid.coveringZoomLevel(d),k=!!b&&Math.abs(b.coord.z-j)>Math.abs(a.coord.z-j),l=[];!b||k?(l[0]=i.clamp(g,0,1),l[1]=1-l[0]):(l[0]=i.clamp(1-h,0,1),l[1]=1-l[0]);var m=c.paint["raster-opacity"];return l[0]*=m,l[1]*=m,l}var i=a("../util/util");b.exports=d},{"../util/util":106}],32:[function(a,b,c){"use strict";function d(a,b,c,d){if(d.buffers){var f=d.elementGroups[b.ref||b.id];if(f){var g=!(b.layout["text-allow-overlap"]||b.layout["icon-allow-overlap"]||b.layout["text-ignore-placement"]||b.layout["icon-ignore-placement"]),i=a.gl;g&&i.disable(i.STENCIL_TEST),f.text.groups.length&&e(a,b,c,d,f.text,"text",!0),f.icon.groups.length&&e(a,b,c,d,f.icon,"icon",f.sdfIcons),h(a,b,c,d),g&&i.enable(i.STENCIL_TEST)}}}function e(a,b,c,d,e,h,j){var k=a.gl;c=a.translateMatrix(c,d,b.paint[h+"-translate"],b.paint[h+"-translate-anchor"]);var l,m,n,o=a.transform,p="map"===b.layout[h+"-rotation-alignment"],q=p;q?(l=g.create(),m=d.tileExtent/d.tileSize/Math.pow(2,a.transform.zoom-d.coord.z),n=1/Math.cos(o._pitch)):(l=g.clone(d.exMatrix),m=a.transform.altitude,n=1),g.scale(l,l,[m,m,1]);var r=b.paint[h+"-size"],s=r/i[h];g.scale(l,l,[s,s,1]);var t,u,v,w,x=Math.sqrt(o.height*o.height/4*(1+o.altitude*o.altitude)),y=o.height/2*Math.tan(o._pitch),z=(x+y)/x-1,A="text"===h;if(A||a.style.sprite.loaded()){k.activeTexture(k.TEXTURE0),t=j?a.sdfShader:a.iconShader,A?(a.glyphAtlas.updateTexture(k),u=d.buffers.glyphVertex,v=d.buffers.glyphElement,w=[a.glyphAtlas.width/4,a.glyphAtlas.height/4]):(a.spriteAtlas.bind(k,p||a.options.rotating||a.options.zooming||1!==s||j||a.transform.pitch),u=d.buffers.iconVertex,v=d.buffers.iconElement,w=[a.spriteAtlas.width/4,a.spriteAtlas.height/4]),k.switchShader(t,c,l),k.uniform1i(t.u_texture,0),k.uniform2fv(t.u_texsize,w),k.uniform1i(t.u_skewed,q),k.uniform1f(t.u_extra,z);var B=Math.log(r/e[h+"-size"])/Math.LN2||0;k.uniform1f(t.u_zoom,10*(a.transform.zoom-B));var C=a.frameHistory.getFadeProperties(300);k.uniform1f(t.u_fadedist,10*C.fadedist),k.uniform1f(t.u_minfadezoom,Math.floor(10*C.minfadezoom)),k.uniform1f(t.u_maxfadezoom,Math.floor(10*C.maxfadezoom)),k.uniform1f(t.u_fadezoom,10*(a.transform.zoom+C.bump));var D,E,F,G;if(v.bind(k),j){var H=8,I=1.19,J=6,K=.105*i[h]/r/f.devicePixelRatio;k.uniform1f(t.u_gamma,K*n),k.uniform4fv(t.u_color,b.paint[h+"-color"]),k.uniform1f(t.u_buffer,.75);for(var L=0;L<e.groups.length;L++)D=e.groups[L],E=D.vertexStartIndex*u.itemSize,u.bind(k,t,E),F=3*D.elementLength,G=D.elementStartIndex*v.itemSize,k.drawElements(k.TRIANGLES,F,k.UNSIGNED_SHORT,G);if(b.paint[h+"-halo-width"]){k.uniform1f(t.u_gamma,(b.paint[h+"-halo-blur"]*I/s/H+K)*n),k.uniform4fv(t.u_color,b.paint[h+"-halo-color"]),k.uniform1f(t.u_buffer,(J-b.paint[h+"-halo-width"]/s)/H);for(var M=0;M<e.groups.length;M++)D=e.groups[M],E=D.vertexStartIndex*u.itemSize,u.bind(k,t,E),F=3*D.elementLength,G=D.elementStartIndex*v.itemSize,k.drawElements(k.TRIANGLES,F,k.UNSIGNED_SHORT,G)}}else{k.uniform1f(t.u_opacity,b.paint["icon-opacity"]);for(var N=0;N<e.groups.length;N++)D=e.groups[N],E=D.vertexStartIndex*u.itemSize,u.bind(k,t,E),F=3*D.elementLength,G=D.elementStartIndex*v.itemSize,k.drawElements(k.TRIANGLES,F,k.UNSIGNED_SHORT,G)}}}var f=a("../util/browser"),g=a("gl-matrix").mat4,h=a("./draw_collision_debug");b.exports=d;var i={icon:1,text:24}},{"../util/browser":95,"./draw_collision_debug":27,"gl-matrix":119}],33:[function(a,b,c){"use strict";function d(a,b,c,d){function g(b,c,d,f){h.switchShader(a.dotShader,d),h.uniform1f(a.dotShader.u_size,4*e.devicePixelRatio),h.uniform1f(a.dotShader.u_blur,.25),h.uniform4fv(a.dotShader.u_color,[.1,0,0,.1]),b.bind(h,a.dotShader,0);for(var g=0;g<c.length;g++){var i=c[g],j=i.vertexStartIndex,k=i.vertexLength;h.vertexAttribPointer(a.dotShader.a_pos,2,h.SHORT,!1,f,0),h.drawArrays(h.POINTS,j,k)}}var h=a.gl;if(d&&d.buffers){var i=d.elementGroups[b.ref||b.id];if(i){if(h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),"fill"===b.type)g(d.buffers.fillVertex,i.groups,c,4);else if("symbol"===b.type)g(d.buffers.iconVertex,i.icon.groups,c,16),g(d.buffers.glyphVertex,i.text.groups,c,16);else if("line"===b.type){var j=f.clone(c);f.scale(j,j,[.5,.5,1]),g(d.buffers.lineVertex,i.groups,j,8)}h.blendFunc(h.ONE_MINUS_DST_ALPHA,h.ONE)}}}var e=a("../util/browser"),f=a("gl-matrix").mat4;b.exports=d},{"../util/browser":95,"gl-matrix":119}],34:[function(a,b,c){"use strict";function d(){this.frameHistory=[]}b.exports=d,d.prototype.getFadeProperties=function(a){void 0===a&&(a=300);for(var b=(new Date).getTime();this.frameHistory.length>3&&this.frameHistory[1].time+a<b;)this.frameHistory.shift();this.frameHistory[1].time+a<b&&(this.frameHistory[0].z=this.frameHistory[1].z);var c=this.frameHistory.length;3>c&&console.warn("there should never be less than three frames in the history");var d=this.frameHistory[0].z,e=this.frameHistory[c-1],f=e.z,g=Math.min(d,f),h=Math.max(d,f),i=e.z-this.frameHistory[1].z,j=e.time-this.frameHistory[1].time,k=i/(j/a);isNaN(k)&&console.warn("fadedist should never be NaN");var l=(b-e.time)/a*k;return{fadedist:k,minfadezoom:g,maxfadezoom:h,bump:l}},d.prototype.record=function(a){var b=(new Date).getTime();this.frameHistory.length||this.frameHistory.push({time:0,z:a},{time:0,z:a}),(2===this.frameHistory.length||this.frameHistory[this.frameHistory.length-1].z!==a)&&this.frameHistory.push({time:b,z:a})}},{}],35:[function(a,b,c){"use strict";var d=a("./shaders"),e=a("../util/util");c.extend=function(a){var b=a.lineWidth,c=a.getParameter(a.ALIASED_LINE_WIDTH_RANGE);return a.lineWidth=function(d){b.call(a,e.clamp(d,c[0],c[1]))},a.getShader=function(a,b){var c=b===this.FRAGMENT_SHADER?"fragment":"vertex";if(!d[a]||!d[a][c])throw new Error("Could not find shader "+a);var e=this.createShader(b),f=d[a][c];if("undefined"==typeof orientation&&(f=f.replace(/ highp /g," ")),this.shaderSource(e,f),this.compileShader(e),!this.getShaderParameter(e,this.COMPILE_STATUS))throw new Error(this.getShaderInfoLog(e));return e},a.initializeShader=function(a,b,c){var d={program:this.createProgram(),fragment:this.getShader(a,this.FRAGMENT_SHADER),vertex:this.getShader(a,this.VERTEX_SHADER),attributes:[]};if(this.attachShader(d.program,d.vertex),this.attachShader(d.program,d.fragment),this.linkProgram(d.program),this.getProgramParameter(d.program,this.LINK_STATUS)){for(var e=0;e<b.length;e++)d[b[e]]=this.getAttribLocation(d.program,b[e]),d.attributes.push(d[b[e]]);for(var f=0;f<c.length;f++)d[c[f]]=this.getUniformLocation(d.program,c[f])}else console.error(this.getProgramInfoLog(d.program));return d},a.switchShader=function(a,b,c){if(b||console.trace("posMatrix does not have required argument"),this.currentShader!==a){this.useProgram(a.program);for(var d=this.currentShader?this.currentShader.attributes:[],e=a.attributes,f=0;f<d.length;f++)e.indexOf(d[f])<0&&this.disableVertexAttribArray(d[f]);for(var g=0;g<e.length;g++)d.indexOf(e[g])<0&&this.enableVertexAttribArray(e[g]);this.currentShader=a}a.posMatrix!==b&&(this.uniformMatrix4fv(a.u_matrix,!1,b),a.posMatrix=b),c&&a.exMatrix!==c&&a.u_exmatrix&&(this.uniformMatrix4fv(a.u_exmatrix,!1,c),a.exMatrix=c)},a.vertexAttrib2fv=function(b,c){a.vertexAttrib2f(b,c[0],c[1])},a.vertexAttrib3fv=function(b,c){a.vertexAttrib3f(b,c[0],c[1],c[2])},a.vertexAttrib4fv=function(b,c){a.vertexAttrib4f(b,c[0],c[1],c[2],c[3])},a}},{"../util/util":106,"./shaders":38}],36:[function(a,b,c){"use strict";function d(a,b){this.width=a,this.height=b,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}}b.exports=d,d.prototype.setSprite=function(a){this.sprite=a},d.prototype.getDash=function(a,b){var c=a.join(",")+b;return this.positions[c]||(this.positions[c]=this.addDash(a,b)),this.positions[c]},d.prototype.addDash=function(a,b){var c=b?7:0,d=2*c+1,e=128;if(this.nextRow+d>this.height)return console.warn("LineAtlas out of space"),null;for(var f=0,g=0;g<a.length;g++)f+=a[g];for(var h=this.width/f,i=h/2,j=a.length%2===1,k=-c;c>=k;k++)for(var l=this.nextRow+c+k,m=this.width*l,n=j?-a[a.length-1]:0,o=a[0],p=1,q=0;q<this.width;q++){for(;q/h>o;)n=o,o+=a[p],j&&p===a.length-1&&(o+=a[0]),p++;var r,s=Math.abs(q-n*h),t=Math.abs(q-o*h),u=Math.min(s,t),v=p%2===1;if(b){var w=c?k/c*(i+1):0;if(v){var x=i-Math.abs(w);r=Math.sqrt(u*u+x*x)}else r=i-Math.sqrt(u*u+w*w)}else r=(v?1:-1)*u;this.data[3+4*(m+q)]=Math.max(0,Math.min(255,r+e))}var y={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:f};return this.nextRow+=d,this.dirty=!0,y},d.prototype.bind=function(a){this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.RGBA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,this.data))},d.prototype.debug=function(){var a=document.createElement("canvas");document.body.appendChild(a),a.style.position="absolute",a.style.top=0,a.style.left=0,a.style.background="#ff0",a.width=this.width,a.height=this.height;for(var b=a.getContext("2d"),c=b.getImageData(0,0,this.width,this.height),d=0;d<this.data.length;d++)if(this.sdf){var e=4*d;c.data[e]=c.data[e+1]=c.data[e+2]=0,c.data[e+3]=this.data[d]}else c.data[d]=this.data[d];b.putImageData(c,0,0)}},{}],37:[function(a,b,c){"use strict";function d(a,b){this.gl=e.extend(a),this.transform=b,this.reusableTextures={},this.preFbos={},this.frameHistory=new h,this.setup()}var e=a("./gl_util"),f=a("../util/browser"),g=a("gl-matrix").mat4,h=a("./frame_history");b.exports=d,d.prototype.resize=function(a,b){var c=this.gl;this.width=a*f.devicePixelRatio,this.height=b*f.devicePixelRatio,c.viewport(0,0,this.width,this.height)},d.prototype.setup=function(){var a=this.gl;a.verbose=!0,a.enable(a.BLEND),a.blendFunc(a.ONE_MINUS_DST_ALPHA,a.ONE),a.enable(a.STENCIL_TEST),this.debugShader=a.initializeShader("debug",["a_pos"],["u_matrix","u_color"]),this.rasterShader=a.initializeShader("raster",["a_pos","a_texture_pos"],["u_matrix","u_brightness_low","u_brightness_high","u_saturation_factor","u_spin_weights","u_contrast_factor","u_opacity0","u_opacity1","u_image0","u_image1","u_tl_parent","u_scale_parent","u_buffer_scale"]),this.circleShader=a.initializeShader("circle",["a_pos"],["u_matrix","u_exmatrix","u_blur","u_size","u_color"]),this.lineShader=a.initializeShader("line",["a_pos","a_data"],["u_matrix","u_linewidth","u_color","u_ratio","u_blur","u_extra","u_antialiasingmatrix"]),this.linepatternShader=a.initializeShader("linepattern",["a_pos","a_data"],["u_matrix","u_linewidth","u_ratio","u_pattern_size_a","u_pattern_size_b","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_blur","u_fade","u_opacity","u_extra","u_antialiasingmatrix"]),this.linesdfpatternShader=a.initializeShader("linesdfpattern",["a_pos","a_data"],["u_matrix","u_linewidth","u_color","u_ratio","u_blur","u_patternscale_a","u_tex_y_a","u_patternscale_b","u_tex_y_b","u_image","u_sdfgamma","u_mix","u_extra","u_antialiasingmatrix"]),this.dotShader=a.initializeShader("dot",["a_pos"],["u_matrix","u_size","u_color","u_blur"]),this.sdfShader=a.initializeShader("sdf",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_color","u_gamma","u_buffer","u_zoom","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_skewed","u_extra"]),this.iconShader=a.initializeShader("icon",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_zoom","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_opacity","u_skewed","u_extra"]),this.outlineShader=a.initializeShader("outline",["a_pos"],["u_matrix","u_color","u_world"]),this.patternShader=a.initializeShader("pattern",["a_pos"],["u_matrix","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_mix","u_patternmatrix_a","u_patternmatrix_b","u_opacity","u_image"]),this.fillShader=a.initializeShader("fill",["a_pos"],["u_matrix","u_color"]),this.collisionBoxShader=a.initializeShader("collisionbox",["a_pos","a_extrude","a_data"],["u_matrix","u_scale","u_zoom","u_maxzoom"]),this.identityMatrix=g.create(),this.backgroundBuffer=a.createBuffer(),
this.backgroundBuffer.itemSize=2,this.backgroundBuffer.itemCount=4,a.bindBuffer(a.ARRAY_BUFFER,this.backgroundBuffer),a.bufferData(a.ARRAY_BUFFER,new Int16Array([-1,-1,1,-1,-1,1,1,1]),a.STATIC_DRAW),this.setExtent(4096),this.debugTextBuffer=a.createBuffer(),this.debugTextBuffer.itemSize=2},d.prototype.setExtent=function(a){if(a&&a!==this.tileExtent){this.tileExtent=a;var b=this.gl;this.tileExtentBuffer=b.createBuffer(),this.tileExtentBuffer.itemSize=4,this.tileExtentBuffer.itemCount=4,b.bindBuffer(b.ARRAY_BUFFER,this.tileExtentBuffer),b.bufferData(b.ARRAY_BUFFER,new Int16Array([0,0,0,0,this.tileExtent,0,32767,0,0,this.tileExtent,0,32767,this.tileExtent,this.tileExtent,32767,32767]),b.STATIC_DRAW),this.debugBuffer=b.createBuffer(),this.debugBuffer.itemSize=2,this.debugBuffer.itemCount=5,b.bindBuffer(b.ARRAY_BUFFER,this.debugBuffer),b.bufferData(b.ARRAY_BUFFER,new Int16Array([0,0,this.tileExtent-1,0,this.tileExtent-1,this.tileExtent-1,0,this.tileExtent-1,0,0]),b.STATIC_DRAW)}},d.prototype.clearColor=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},d.prototype.clearStencil=function(){var a=this.gl;a.clearStencil(0),a.stencilMask(255),a.clear(a.STENCIL_BUFFER_BIT)},d.prototype.drawClippingMask=function(a){var b=this.gl;b.switchShader(this.fillShader,a.posMatrix),b.colorMask(!1,!1,!1,!1),b.clearStencil(0),b.stencilMask(191),b.clear(b.STENCIL_BUFFER_BIT),b.stencilFunc(b.EQUAL,192,64),b.stencilMask(192),b.stencilOp(b.REPLACE,b.KEEP,b.KEEP),b.bindBuffer(b.ARRAY_BUFFER,this.tileExtentBuffer),b.vertexAttribPointer(this.fillShader.a_pos,this.tileExtentBuffer.itemSize,b.SHORT,!1,8,0),b.drawArrays(b.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),b.stencilFunc(b.EQUAL,128,128),b.stencilOp(b.KEEP,b.KEEP,b.REPLACE),b.stencilMask(0),b.colorMask(!0,!0,!0,!0)},d.prototype.prepareBuffers=function(){},d.prototype.bindDefaultFramebuffer=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)};var i={symbol:a("./draw_symbol"),circle:a("./draw_circle"),line:a("./draw_line"),fill:a("./draw_fill"),raster:a("./draw_raster"),background:a("./draw_background"),debug:a("./draw_debug"),vertices:a("./draw_vertices")};d.prototype.render=function(a,b){this.style=a,this.options=b,this.lineAtlas=a.lineAtlas,this.spriteAtlas=a.spriteAtlas,this.spriteAtlas.setSprite(a.sprite),this.glyphAtlas=a.glyphAtlas,this.glyphAtlas.bind(this.gl),this.frameHistory.record(this.transform.zoom),this.prepareBuffers(),this.clearColor();for(var c=a._groups.length-1;c>=0;c--){var d=a._groups[c],e=a.sources[d.source];e?(this.clearStencil(),e.render(d,this)):void 0===d.source&&this.drawLayers(d,this.identityMatrix)}},d.prototype.drawTile=function(a,b){this.setExtent(a.tileExtent),this.drawClippingMask(a),this.drawLayers(b,a.posMatrix,a),this.options.debug&&i.debug(this,a)},d.prototype.drawLayers=function(a,b,c){for(var d=a.length-1;d>=0;d--){var e=a[d];e.hidden||(i[e.type](this,e,b,c),this.options.vertices&&i.vertices(this,e,b,c))}},d.prototype.drawStencilBuffer=function(){var a=this.gl;a.switchShader(this.fillShader,this.identityMatrix),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.stencilMask(0),a.stencilFunc(a.EQUAL,128,128),a.bindBuffer(a.ARRAY_BUFFER,this.backgroundBuffer),a.vertexAttribPointer(this.fillShader.a_pos,this.backgroundBuffer.itemSize,a.SHORT,!1,0,0),a.uniform4fv(this.fillShader.u_color,[0,0,0,.5]),a.drawArrays(a.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),a.blendFunc(a.ONE_MINUS_DST_ALPHA,a.ONE)},d.prototype.translateMatrix=function(a,b,c,d){if(!c[0]&&!c[1])return a;if("viewport"===d){var e=Math.sin(-this.transform.angle),f=Math.cos(-this.transform.angle);c=[c[0]*f-c[1]*e,c[0]*e+c[1]*f]}var h=this.transform.scale/(1<<b.coord.z)/(b.tileExtent/b.tileSize),i=[c[0]/h,c[1]/h,0],j=new Float32Array(16);return g.translate(j,a,i),j},d.prototype.saveTexture=function(a){var b=this.reusableTextures[a.size];b?b.push(a):this.reusableTextures[a.size]=[a]},d.prototype.getTexture=function(a){var b=this.reusableTextures[a];return b&&b.length>0?b.pop():null}},{"../util/browser":95,"./draw_background":25,"./draw_circle":26,"./draw_debug":28,"./draw_fill":29,"./draw_line":30,"./draw_raster":31,"./draw_symbol":32,"./draw_vertices":33,"./frame_history":34,"./gl_util":35,"gl-matrix":119}],38:[function(a,b,c){"use strict";b.exports={debug:{vertex:"precision mediump float;attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,step(32767.,a_pos.x),1);}",fragment:"precision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}"},dot:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform float u_size;attribute vec2 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);gl_PointSize=u_size;}",fragment:"precision mediump float;uniform vec4 u_color;uniform float u_blur;void main(){float a,b;a=length(gl_PointCoord-.5);b=smoothstep(.5,.5-u_blur,a);gl_FragColor=u_color*b;}"},fill:{vertex:"precision mediump float;attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}",fragment:"precision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}"},circle:{vertex:"precision mediump float;uniform float u_size;attribute vec2 a_pos;uniform mat4 u_matrix,u_exmatrix;varying vec2 a;void main(){a=vec2(mod(a_pos,2.)*2.-1.);vec4 b=u_exmatrix*vec4(a*u_size,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5),0,1);gl_Position+=b*gl_Position.w;}",fragment:"precision mediump float;uniform vec4 u_color;uniform float u_blur,u_size;varying vec2 a;void main(){float b=smoothstep(1.-u_blur,1.,length(a));gl_FragColor=u_color*(1.-b);}"},line:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform float u_ratio,u_extra;uniform vec2 u_linewidth;uniform mat2 u_antialiasingmatrix;varying vec2 a;varying float b,c;void main(){vec2 d,e;d=a_data.xy;e=mod(a_pos,2.);e.y=sign(e.y-.5);a=e;vec4 f=vec4(u_linewidth.s*d*.015873016,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5)+f.xy/u_ratio,0,1);float g,h,i;g=gl_Position.y/gl_Position.w;h=length(d)/length(u_antialiasingmatrix*d);i=1./(1.-min(g*u_extra,.9));c=i*h;}",fragment:"precision mediump float;uniform vec2 u_linewidth;uniform vec4 u_color;uniform float u_blur;varying vec2 a;varying float b,c;void main(){float d,e,f;d=length(a)*u_linewidth.s;e=u_blur*c;f=clamp(min(d-(u_linewidth.t-e),u_linewidth.s-d)/e,0.,1.);gl_FragColor=u_color*f;}"},linepattern:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform float u_ratio,u_extra;uniform vec2 u_linewidth;uniform vec4 u_color;uniform mat2 u_antialiasingmatrix;varying vec2 a;varying float b,c;void main(){vec2 d,f,g,h;d=a_data.xy;float e,i,j,k;e=a_data.z*128.+a_data.w;f=mod(a_pos,2.);f.y=sign(f.y-.5);a=f;g=d*.015873016;h=u_linewidth.s*g;gl_Position=u_matrix*vec4(floor(a_pos*.5)+h.xy/u_ratio,0,1);b=e;i=gl_Position.y/gl_Position.w;j=length(d)/length(u_antialiasingmatrix*d);k=1./(1.-min(i*u_extra,.9));c=k*j;}",fragment:"precision mediump float;uniform vec2 u_linewidth,u_pattern_size_a,u_pattern_size_b,u_pattern_tl_a,u_pattern_br_a,u_pattern_tl_b,u_pattern_br_b;uniform float u_point,u_blur,u_fade,u_opacity;uniform sampler2D u_image;varying vec2 a;varying float b,c;void main(){float d,e,f,g,h,i,j;d=length(a)*u_linewidth.s;e=u_blur*c;f=clamp(min(d-(u_linewidth.t-e),u_linewidth.s-d)/e,0.,1.);g=mod(b/u_pattern_size_a.x,1.);h=mod(b/u_pattern_size_b.x,1.);i=.5+a.y*u_linewidth.s/u_pattern_size_a.y;j=.5+a.y*u_linewidth.s/u_pattern_size_b.y;vec2 k,l;k=mix(u_pattern_tl_a,u_pattern_br_a,vec2(g,i));l=mix(u_pattern_tl_b,u_pattern_br_b,vec2(h,j));vec4 m=mix(texture2D(u_image,k),texture2D(u_image,l),u_fade);f*=u_opacity;gl_FragColor=m*f;}"},linesdfpattern:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform vec2 u_linewidth,u_patternscale_a,u_patternscale_b;uniform float u_ratio,u_tex_y_a,u_tex_y_b,u_extra;uniform mat2 u_antialiasingmatrix;varying vec2 a,b,c;varying float d;void main(){vec2 e,g;e=a_data.xy;float f,i,j,k;f=a_data.z*128.+a_data.w;g=mod(a_pos,2.);g.y=sign(g.y-.5);a=g;vec4 h=vec4(u_linewidth.s*e*.015873016,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5)+h.xy/u_ratio,0,1);b=vec2(f*u_patternscale_a.x,g.y*u_patternscale_a.y+u_tex_y_a);c=vec2(f*u_patternscale_b.x,g.y*u_patternscale_b.y+u_tex_y_b);i=gl_Position.y/gl_Position.w;j=length(e)/length(u_antialiasingmatrix*e);k=1./(1.-min(i*u_extra,.9));d=k*j;}",fragment:"precision mediump float;uniform vec2 u_linewidth;uniform vec4 u_color;uniform float u_blur,u_sdfgamma,u_mix;uniform sampler2D u_image;varying vec2 a,b,c;varying float d;void main(){float e,f,g,h,i,j;e=length(a)*u_linewidth.s;f=u_blur*d;g=clamp(min(e-(u_linewidth.t-f),u_linewidth.s-e)/f,0.,1.);h=texture2D(u_image,b).a;i=texture2D(u_image,c).a;j=mix(h,i,u_mix);g*=smoothstep(.5-u_sdfgamma,.5+u_sdfgamma,j);gl_FragColor=u_color*g;}"},outline:{vertex:"precision mediump float;attribute vec2 a_pos;uniform highp mat4 u_matrix;uniform vec2 u_world;varying vec2 a;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(gl_Position.xy/gl_Position.w+1.)/2.*u_world;}",fragment:"precision mediump float;uniform vec4 u_color;varying vec2 a;void main(){float b,c;b=length(a-gl_FragCoord.xy);c=smoothstep(1.,0.,b);gl_FragColor=u_color*c;}"},pattern:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform mat3 u_patternmatrix_a,u_patternmatrix_b;attribute vec2 a_pos;varying vec2 a,b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(u_patternmatrix_a*vec3(a_pos,1)).xy;b=(u_patternmatrix_b*vec3(a_pos,1)).xy;}",fragment:"precision mediump float;uniform float u_opacity,u_mix;uniform vec2 u_pattern_tl_a,u_pattern_br_a,u_pattern_tl_b,u_pattern_br_b;uniform sampler2D u_image;varying vec2 a,b;void main(){vec2 c,d,f,g;c=mod(a,1.);d=mix(u_pattern_tl_a,u_pattern_br_a,c);vec4 e,h;e=texture2D(u_image,d);f=mod(b,1.);g=mix(u_pattern_tl_b,u_pattern_br_b,f);h=texture2D(u_image,g);gl_FragColor=mix(e,h,u_mix)*u_opacity;}"},raster:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent,u_buffer_scale;attribute vec2 a_pos,a_texture_pos;varying vec2 a,b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(a_texture_pos/32767.-.5)/u_buffer_scale+.5;b=a*u_scale_parent+u_tl_parent;}",fragment:"precision mediump float;uniform float u_opacity0,u_opacity1,u_brightness_low,u_brightness_high,u_saturation_factor,u_contrast_factor;uniform sampler2D u_image0,u_image1;varying vec2 a,b;uniform vec3 u_spin_weights;void main(){vec4 c,d,e;c=texture2D(u_image0,a);d=texture2D(u_image1,b);e=c*u_opacity0+d*u_opacity1;vec3 f,h,i;f=e.rgb;f=vec3(dot(f,u_spin_weights.xyz),dot(f,u_spin_weights.zxy),dot(f,u_spin_weights.yzx));float g=(e.r+e.g+e.b)/3.;f+=(g-f)*u_saturation_factor;f=(f-.5)*u_contrast_factor+.5;h=vec3(u_brightness_low);i=vec3(u_brightness_high);gl_FragColor=vec4(mix(h,i,f),e.a);}"},icon:{vertex:"precision mediump float;attribute vec2 a_pos,a_offset;attribute vec4 a_data1,a_data2;uniform highp mat4 u_matrix;uniform mat4 u_exmatrix;uniform float u_zoom,u_fadedist,u_minfadezoom,u_maxfadezoom,u_fadezoom,u_opacity,u_extra;uniform bool u_skewed;uniform vec2 u_texsize;varying vec2 a;varying float b;void main(){vec2 c,e;c=a_data1.xy;float d,f,g,h,i,j;d=a_data1[2];e=a_data2.st;f=e[0];g=e[1];h=10.;i=2.-step(f,u_zoom)-(1.-step(g,u_zoom));j=clamp((u_fadezoom-d)/u_fadedist,0.,1.);if(u_fadedist>=0.)b=j;else b=1.-j;if(u_maxfadezoom<d)b=0.;if(u_minfadezoom>=d)b=1.;i+=step(b,0.);if(u_skewed){vec4 k=u_exmatrix*vec4(a_offset/64.,0,0);gl_Position=u_matrix*vec4(a_pos+k.xy,0,1);gl_Position.z+=i*gl_Position.w;}else{vec4 k=u_exmatrix*vec4(a_offset/64.,i,0);gl_Position=u_matrix*vec4(a_pos,0,1)+k;}a=c/u_texsize;b*=u_opacity;}",fragment:"precision mediump float;uniform sampler2D u_texture;varying vec2 a;varying float b;void main(){gl_FragColor=texture2D(u_texture,a)*b;}"},sdf:{vertex:"precision mediump float;attribute vec2 a_pos,a_offset;attribute vec4 a_data1,a_data2;uniform highp mat4 u_matrix;uniform mat4 u_exmatrix;uniform float u_zoom,u_fadedist,u_minfadezoom,u_maxfadezoom,u_fadezoom,u_extra;uniform bool u_skewed;uniform vec2 u_texsize;varying vec2 a;varying float b,c;void main(){vec2 d,f;d=a_data1.xy;float e,g,h,i,j,k,l;e=a_data1[2];f=a_data2.st;g=f[0];h=f[1];i=2.-step(g,u_zoom)-(1.-step(h,u_zoom));j=clamp((u_fadezoom-e)/u_fadedist,0.,1.);if(u_fadedist>=0.)b=j;else b=1.-j;if(u_maxfadezoom<e)b=0.;if(u_minfadezoom>=e)b=1.;i+=step(b,0.);if(u_skewed){vec4 k=u_exmatrix*vec4(a_offset/64.,0,0);gl_Position=u_matrix*vec4(a_pos+k.xy,0,1);gl_Position.z+=i*gl_Position.w;}else{vec4 k=u_exmatrix*vec4(a_offset/64.,i,0);gl_Position=u_matrix*vec4(a_pos,0,1)+k;}k=gl_Position.y/gl_Position.w;l=1./(1.-k*u_extra);c=l;a=d/u_texsize;}",fragment:"precision mediump float;uniform sampler2D u_texture;uniform vec4 u_color;uniform float u_buffer,u_gamma;varying vec2 a;varying float b,c;void main(){float d,e,f;d=u_gamma*c;e=texture2D(u_texture,a).a;f=smoothstep(u_buffer-d,u_buffer+d,e)*b;gl_FragColor=u_color*f;}"},collisionbox:{vertex:"precision mediump float;attribute vec2 a_pos,a_extrude,a_data;uniform mat4 u_matrix;uniform float u_scale;varying float a,b;void main(){gl_Position=u_matrix*vec4(a_pos+a_extrude/u_scale,0,1);a=a_data.x;b=a_data.y;}",fragment:"precision mediump float;uniform float u_zoom,u_maxzoom;varying float a,b;void main(){float c=.5;gl_FragColor=vec4(0,1,0,1)*c;if(b>u_zoom)gl_FragColor=vec4(1,0,0,1)*c;if(u_zoom>=a)gl_FragColor=vec4(0,0,0,1)*c*.25;if(b>=u_maxzoom)gl_FragColor=vec4(0,0,1,1)*c*.2;}"}}},{}],39:[function(a,b,c){"use strict";function d(a){a=a||{},this._data=a.data,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),this.geojsonVtOptions={maxZoom:this.maxzoom},void 0!==a.buffer&&(this.geojsonVtOptions.buffer=a.buffer),void 0!==a.tolerance&&(this.geojsonVtOptions.tolerance=a.tolerance),this._pyramid=new g({tileSize:512,minzoom:this.minzoom,maxzoom:this.maxzoom,cacheSize:20,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this)})}var e=a("../util/util"),f=a("../util/evented"),g=a("./tile_pyramid"),h=a("./source"),i=a("resolve-url");b.exports=d,d.prototype=e.inherit(f,{minzoom:0,maxzoom:14,_dirty:!0,setData:function(a){return this._data=a,this._dirty=!0,this.fire("change"),this.map&&this.update(this.map.transform),this},onAdd:function(a){this.map=a},loaded:function(){return this._loaded&&this._pyramid.loaded()},update:function(a){this._dirty&&this._updateData(),this._loaded&&this._pyramid.update(this.used,a)},reload:function(){this._loaded&&this._pyramid.reload()},render:h._renderTiles,featuresAt:h._vectorFeaturesAt,featuresIn:h._vectorFeaturesIn,_updateData:function(){this._dirty=!1;var a=this._data;"string"==typeof a&&(a=i(window.location.href,a)),this.workerID=this.dispatcher.send("parse geojson",{data:a,tileSize:512,source:this.id,geojsonVtOptions:this.geojsonVtOptions},function(a){return a?void this.fire("error",{error:a}):(this._loaded=!0,this._pyramid.reload(),void this.fire("change"))}.bind(this))},_loadTile:function(a){var b=a.coord.z>this.maxzoom?Math.pow(2,a.coord.z-this.maxzoom):1,c={uid:a.uid,coord:a.coord,zoom:a.coord.z,maxZoom:this.maxzoom,tileSize:512,source:this.id,overscaling:b,angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug};a.workerID=this.dispatcher.send("load geojson tile",c,function(b,c){if(a.unloadVectorData(this.map.painter),!a.aborted){if(b)return void this.fire("tile.error",{tile:a});a.loadVectorData(c),this.fire("tile.load",{tile:a})}}.bind(this),this.workerID)},_abortTile:function(a){a.aborted=!0},_addTile:function(a){this.fire("tile.add",{tile:a})},_removeTile:function(a){this.fire("tile.remove",{tile:a})},_unloadTile:function(a){a.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(a.uid),this.dispatcher.send("remove tile",{uid:a.uid,source:this.id},null,a.workerID)}})},{"../util/evented":100,"../util/util":106,"./source":43,"./tile_pyramid":46,"resolve-url":139}],40:[function(a,b,c){"use strict";function d(a){this.features=a,this.length=a.length}function e(a){this.type=a.type,this.rawGeometry=1===a.type?[a.geometry]:a.geometry,this.properties=a.tags,this.extent=4096}var f=a("point-geometry"),g=a("vector-tile").VectorTileFeature;b.exports=d,d.prototype.feature=function(a){return new e(this.features[a])},e.prototype.loadGeometry=function(){var a=this.rawGeometry;this.geometry=[];for(var b=0;b<a.length;b++){for(var c=a[b],d=[],e=0;e<c.length;e++)d.push(new f(c[e][0],c[e][1]));this.geometry.push(d)}return this.geometry},e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var a=this.geometry,b=1/0,c=-(1/0),d=1/0,e=-(1/0),f=0;f<a.length;f++)for(var g=a[f],h=0;h<g.length;h++){var i=g[h];b=Math.min(b,i.x),c=Math.max(c,i.x),d=Math.min(d,i.y),e=Math.max(e,i.y)}return[b,d,c,e]},e.prototype.toGeoJSON=g.prototype.toGeoJSON},{"point-geometry":137,"vector-tile":141}],41:[function(a,b,c){"use strict";function d(a){this.coordinates=a.coordinates,j.getImage(a.url,function(a,b){a||(this.image=b,this.image.addEventListener("load",function(){this.map._rerender()}.bind(this)),this._loaded=!0,this.map&&(this.createTile(),this.fire("change")))}.bind(this))}var e=a("../util/util"),f=a("./tile"),g=a("../geo/lng_lat"),h=a("point-geometry"),i=a("../util/evented"),j=a("../util/ajax");b.exports=d,d.prototype=e.inherit(i,{onAdd:function(a){this.map=a,this.image&&this.createTile()},createTile:function(){var a=this.map,b=this.coordinates.map(function(b){var c=g.convert(b);return a.transform.locationCoordinate(c).zoomTo(0)}),c=e.getCoordinatesCenter(b),d=4096,i=b.map(function(a){var b=a.zoomTo(c.zoom);return new h(Math.round((b.column-c.column)*d),Math.round((b.row-c.row)*d))}),j=a.painter.gl,k=32767,l=new Int16Array([i[0].x,i[0].y,0,0,i[1].x,i[1].y,k,0,i[3].x,i[3].y,0,k,i[2].x,i[2].y,k,k]);this.tile=new f,this.tile.buckets={},this.tile.boundsBuffer=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,this.tile.boundsBuffer),j.bufferData(j.ARRAY_BUFFER,l,j.STATIC_DRAW),this.center=c},loaded:function(){return this.image&&this.image.complete},update:function(){},render:function(a,b){if(this._loaded&&this.loaded()){var c=this.center;this.tile.calculateMatrices(c.zoom,c.column,c.row,this.map.transform,b);var d=b.gl;this.tile.texture?(d.bindTexture(d.TEXTURE_2D,this.tile.texture),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.image)):(this.tile.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.tile.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,this.image)),b.drawLayers(a,this.tile.posMatrix,this.tile)}},featuresAt:function(a,b,c){return c(null,[])}})},{"../geo/lng_lat":20,"../util/ajax":94,"../util/evented":100,"../util/util":106,"./tile":44,"point-geometry":137}],42:[function(a,b,c){"use strict";function d(a){e.extend(this,e.pick(a,["url","tileSize"])),h._loadTileJSON.call(this,a)}var e=a("../util/util"),f=a("../util/ajax"),g=a("../util/evented"),h=a("./source"),i=a("../util/mapbox").normalizeTileURL;b.exports=d,d.prototype=e.inherit(g,{minzoom:0,maxzoom:22,roundZoom:!0,tileSize:512,_loaded:!1,onAdd:function(a){this.map=a},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(a){this._pyramid&&this._pyramid.update(this.used,a,this.map.style.rasterFadeDuration)},reload:function(){},render:h._renderTiles,_loadTile:function(a){f.getImage(i(a.coord.url(this.tiles),this.url),function(b,c){if(!a.aborted){if(b)return void this.fire("tile.error",{tile:a});var d=this.map.painter.gl;a.texture=this.map.painter.getTexture(c.width),a.texture?(d.bindTexture(d.TEXTURE_2D,a.texture),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,c)):(a.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,a.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c),a.texture.size=c.width),d.generateMipmap(d.TEXTURE_2D),a.timeAdded=(new Date).getTime(),this.map.animationLoop.set(this.style.rasterFadeDuration),a.source=this,a.loaded=!0,this.fire("tile.load",{tile:a})}}.bind(this))},_abortTile:function(a){a.aborted=!0},_addTile:function(a){this.fire("tile.add",{tile:a})},_removeTile:function(a){this.fire("tile.remove",{tile:a})},_unloadTile:function(a){a.texture&&this.map.painter.saveTexture(a.texture)},featuresAt:function(a,b,c){c(null,[])},featuresIn:function(a,b,c){c(null,[])}})},{"../util/ajax":94,"../util/evented":100,"../util/mapbox":103,"../util/util":106,"./source":43}],43:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/ajax"),f=a("../util/browser"),g=a("./tile_pyramid"),h=a("./tile_coord"),i=a("../util/mapbox").normalizeSourceURL;c._loadTileJSON=function(a){var b=function(a,b){return a?void this.fire("error",{error:a}):(d.extend(this,d.pick(b,["tiles","minzoom","maxzoom","attribution"])),this._pyramid=new g({tileSize:this.tileSize,cacheSize:20,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom,reparseOverscaled:this.reparseOverscaled,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this),redoPlacement:this._redoTilePlacement?this._redoTilePlacement.bind(this):void 0}),void this.fire("load"))}.bind(this);a.url?e.getJSON(i(a.url),b):f.frame(b.bind(this,null,a))},c._renderTiles=function(a,b){if(this._pyramid)for(var c=this._pyramid.renderedIDs(),d=0;d<c.length;d++){var e=this._pyramid.getTile(c[d]),f=h.fromID(c[d]),g=f.z,i=f.x,j=f.y,k=f.w;g=Math.min(g,this.maxzoom),i+=k*(1<<g),e.calculateMatrices(g,i,j,b.transform,b),b.drawTile(e,a)}},c._vectorFeaturesAt=function(a,b,c){if(!this._pyramid)return c(null,[]);var d=this._pyramid.tileAt(a);return d?void this.dispatcher.send("query features",{uid:d.tile.uid,x:d.x,y:d.y,scale:d.scale,source:this.id,params:b},c,d.tile.workerID):c(null,[])},c._vectorFeaturesIn=function(a,b,c){if(!this._pyramid)return c(null,[]);var e=this._pyramid.tilesIn(a);return e?void d.asyncAll(e,function(a,c){this.dispatcher.send("query features",{uid:a.tile.uid,source:this.id,minX:a.minX,maxX:a.maxX,minY:a.minY,maxY:a.maxY,params:b},c,a.tile.workerID)}.bind(this),function(a,b){c(a,Array.prototype.concat.apply([],b))}):c(null,[])},c.create=function(b){var c={vector:a("./vector_tile_source"),raster:a("./raster_tile_source"),geojson:a("./geojson_source"),video:a("./video_source"),image:a("./image_source")};for(var d in c)if(b instanceof c[d])return b;return new c[b.type](b)}},{"../util/ajax":94,"../util/browser":95,"../util/mapbox":103,"../util/util":106,"./geojson_source":39,"./image_source":41,"./raster_tile_source":42,"./tile_coord":45,"./tile_pyramid":46,"./vector_tile_source":47,"./video_source":48}],44:[function(a,b,c){"use strict";function d(a,b){this.coord=a,this.uid=h.uniqueId(),this.loaded=!1,this.uses=0,this.tileSize=b}var e=a("gl-matrix"),f=e.mat2,g=e.mat4,h=a("../util/util"),i=a("../data/buffer/buffer_set");b.exports=d,d.prototype={tileExtent:4096,calculateMatrices:function(a,b,c,d){var e=Math.pow(2,a),h=d.worldSize/e;this.scale=h,this.posMatrix=new Float64Array(16),g.identity(this.posMatrix),g.translate(this.posMatrix,this.posMatrix,[b*h,c*h,0]),g.scale(this.posMatrix,this.posMatrix,[h/this.tileExtent,h/this.tileExtent,1]),g.multiply(this.posMatrix,d.getProjMatrix(),this.posMatrix),this.exMatrix=g.create(),g.ortho(this.exMatrix,0,d.width,d.height,0,0,-1),this.rotationMatrix=f.create(),f.rotate(this.rotationMatrix,this.rotationMatrix,d.angle),this.posMatrix=new Float32Array(this.posMatrix)},positionAt:function(a,b){return a=a.zoomTo(Math.min(this.coord.z,b)),{x:4096*(a.column-this.coord.x),y:4096*(a.row-this.coord.y),scale:this.scale}},loadVectorData:function(a){this.loaded=!0,a&&(this.buffers=new i(a.buffers),this.elementGroups=a.elementGroups,this.tileExtent=a.extent)},reloadSymbolData:function(a,b){if(this.buffers){this.buffers.glyphVertex.destroy(b.gl),this.buffers.glyphElement.destroy(b.gl),this.buffers.iconVertex.destroy(b.gl),this.buffers.iconElement.destroy(b.gl),this.buffers.collisionBoxVertex.destroy(b.gl);var c=new i(a.buffers);this.buffers.glyphVertex=c.glyphVertex,this.buffers.glyphElement=c.glyphElement,this.buffers.iconVertex=c.iconVertex,this.buffers.iconElement=c.iconElement,this.buffers.collisionBoxVertex=c.collisionBoxVertex;for(var d in a.elementGroups)this.elementGroups[d]=a.elementGroups[d]}},unloadVectorData:function(a){for(var b in this.buffers)this.buffers[b].destroy(a.gl);this.buffers=null}}},{"../data/buffer/buffer_set":2,"../util/util":106,"gl-matrix":119}],45:[function(a,b,c){"use strict";function d(a,b,c,d){void 0===d&&(d=0),this.z=a,this.x=b,this.y=c,this.w=d,d*=2,0>d&&(d=-1*d-1);var e=1<<this.z;this.id=32*(e*e*d+e*this.y+this.x)+this.z}function e(a,b){if(a.row>b.row){var c=a;a=b,b=c}return{x0:a.column,y0:a.row,x1:b.column,y1:b.row,dx:b.column-a.column,dy:b.row-a.row}}function f(a,b,c,d,e){var f=Math.max(c,Math.floor(b.y0)),g=Math.min(d,Math.ceil(b.y1));if(a.x0===b.x0&&a.y0===b.y0?a.x0+b.dy/a.dy*a.dx<b.x1:a.x1-b.dy/a.dy*a.dx<b.x0){var h=a;a=b,b=h}for(var i=a.dx/a.dy,j=b.dx/b.dy,k=a.dx>0,l=b.dx<0,m=f;g>m;m++){var n=i*Math.max(0,Math.min(a.dy,m+k-a.y0))+a.x0,o=j*Math.max(0,Math.min(b.dy,m+l-b.y0))+b.x0;e(Math.floor(o),Math.ceil(n),m)}}function g(a,b,c,d,g,h){var i,j=e(a,b),k=e(b,c),l=e(c,a);j.dy>k.dy&&(i=j,j=k,k=i),j.dy>l.dy&&(i=j,j=l,l=i),k.dy>l.dy&&(i=k,k=l,l=i),j.dy&&f(l,j,d,g,h),k.dy&&f(l,k,d,g,h)}b.exports=d,d.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},d.fromID=function(a){var b=a%32,c=1<<b,e=(a-b)/32,f=e%c,g=(e-f)/c%c,h=Math.floor(e/(c*c));return h%2!==0&&(h=-1*h-1),h/=2,new d(b,f,g,h)},d.prototype.url=function(a,b){return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,b||this.z)).replace("{x}",this.x).replace("{y}",this.y)},d.prototype.parent=function(a){return 0===this.z?null:this.z>a?new d(this.z-1,this.x,this.y,this.w):new d(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},d.prototype.wrapped=function(){return new d(this.z,this.x,this.y,0)},d.prototype.children=function(a){if(this.z>=a)return[new d(this.z+1,this.x,this.y,this.w)];var b=this.z+1,c=2*this.x,e=2*this.y;return[new d(b,c,e,this.w),new d(b,c+1,e,this.w),new d(b,c,e+1,this.w),new d(b,c+1,e+1,this.w)]},d.cover=function(a,b,c){function e(a,b,e){var g,i;if(e>=0&&f>=e)for(g=a;b>g;g++){i=(g+f)%f;var j=new d(c,i,e,Math.floor(g/f));h[j.id]=j}}var f=1<<a,h={};return g(b[0],b[1],b[2],0,f,e),g(b[2],b[3],b[0],0,f,e),Object.keys(h).map(function(a){return h[a]})}},{}],46:[function(a,b,c){"use strict";function d(a){this.tileSize=a.tileSize,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,this.roundZoom=a.roundZoom,this.reparseOverscaled=a.reparseOverscaled,this._load=a.load,this._abort=a.abort,this._unload=a.unload,this._add=a.add,this._remove=a.remove,this._redoPlacement=a.redoPlacement,this._tiles={},this._cache=new h(a.cacheSize,function(a){return this._unload(a)}.bind(this))}var e=a("./tile"),f=a("./tile_coord"),g=a("point-geometry"),h=a("../util/mru_cache"),i=a("../util/util");b.exports=d,d.prototype={loaded:function(){for(var a in this._tiles)if(!this._tiles[a].loaded)return!1;return!0},orderedIDs:function(){return Object.keys(this._tiles).sort(function(a,b){return b%32-a%32}).map(function(a){return+a})},renderedIDs:function(){return this.orderedIDs().filter(function(a){return this._tiles[a].loaded&&!this._coveredTiles[a]}.bind(this))},reload:function(){this._cache.reset();for(var a in this._tiles)this._load(this._tiles[a])},getTile:function(a){return this._tiles[a]},getZoom:function(a){return a.zoom+Math.log(a.tileSize/this.tileSize)/Math.LN2},coveringZoomLevel:function(a){return(this.roundZoom?Math.round:Math.floor)(this.getZoom(a))},coveringTiles:function(a){var b=this.coveringZoomLevel(a),c=b;if(b<this.minzoom)return[];b>this.maxzoom&&(b=this.maxzoom);var d=a,e=d.locationCoordinate(d.center)._zoomTo(b),h=new g(e.column-.5,e.row-.5);return f.cover(b,[d.pointCoordinate(new g(0,0))._zoomTo(b),d.pointCoordinate(new g(d.width,0))._zoomTo(b),d.pointCoordinate(new g(d.width,d.height))._zoomTo(b),d.pointCoordinate(new g(0,d.height))._zoomTo(b)],this.reparseOverscaled?c:b).sort(function(a,b){return h.dist(a)-h.dist(b)})},findLoadedChildren:function(a,b,c){for(var d=!0,e=a.z,f=a.children(this.maxzoom),g=0;g<f.length;g++){var h=f[g].id;this._tiles[h]&&this._tiles[h].loaded?c[h]=!0:(d=!1,b>e&&this.findLoadedChildren(f[g],b,c))}return d},findLoadedParent:function(a,b,c){for(var d=a.z-1;d>=b;d--){a=a.parent(this.maxzoom);var e=this._tiles[a.id];if(e&&e.loaded)return c[a.id]=!0,e}},update:function(a,b,c){var d,e,g,h=(this.roundZoom?Math.round:Math.floor)(this.getZoom(b)),j=i.clamp(h-10,this.minzoom,this.maxzoom),k=i.clamp(h+1,this.minzoom,this.maxzoom),l={},m=(new Date).getTime();this._coveredTiles={};var n=a?this.coveringTiles(b):[];for(d=0;d<n.length;d++)e=n[d],g=this.addTile(e),l[e.id]=!0,g.loaded||this.findLoadedChildren(e,k,l)||this.findLoadedParent(e,j,l);for(var o in l)e=f.fromID(o),g=this._tiles[o],g&&g.timeAdded>m-(c||0)&&(this.findLoadedChildren(e,k,l)?(this._coveredTiles[o]=!0,l[o]=!0):this.findLoadedParent(e,j,l));var p=i.keysDifference(this._tiles,l);for(d=0;d<p.length;d++)this.removeTile(+p[d])},addTile:function(a){var b=this._tiles[a.id];if(b)return b;var c=a.wrapped();if(b=this._tiles[c.id],b||(b=this._cache.get(c.id),b&&this._redoPlacement&&this._redoPlacement(b)),!b){var d=a.z,f=d>this.maxzoom?Math.pow(2,d-this.maxzoom):1;b=new e(c,this.tileSize*f),this._load(b)}return b.uses++,this._tiles[a.id]=b,this._add(b,a),b},removeTile:function(a){var b=this._tiles[a];b&&(b.uses--,delete this._tiles[a],this._remove(b),b.uses>0||(b.loaded?this._cache.add(b.coord.wrapped().id,b):(this._abort(b),this._unload(b))))},clearTiles:function(){for(var a in this._tiles)this.removeTile(a);this._cache.reset()},tileAt:function(a){for(var b=this.orderedIDs(),c=0;c<b.length;c++){var d=this._tiles[b[c]],e=d.positionAt(a,this.maxzoom);if(e&&e.x>=0&&e.x<4096&&e.y>=0&&e.y<4096)return{tile:d,x:e.x,y:e.y,scale:e.scale}}},tilesIn:function(a){for(var b=[],c=this.orderedIDs(),d=0;d<c.length;d++){var e=this._tiles[c[d]],f=[e.positionAt(a[0],this.maxzoom),e.positionAt(a[1],this.maxzoom)];f[0].x<4096&&f[0].y<4096&&f[1].x>=0&&f[1].y>=0&&b.push({tile:e,minX:f[0].x,maxX:f[1].x,minY:f[0].y,maxY:f[1].y})}return b}}},{"../util/mru_cache":104,"../util/util":106,"./tile":44,"./tile_coord":45,"point-geometry":137}],47:[function(a,b,c){"use strict";function d(a){if(e.extend(this,e.pick(a,["url","tileSize"])),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");g._loadTileJSON.call(this,a)}var e=a("../util/util"),f=a("../util/evented"),g=a("./source");b.exports=d,d.prototype=e.inherit(f,{minzoom:0,maxzoom:22,tileSize:512,reparseOverscaled:!0,_loaded:!1,onAdd:function(a){this.map=a},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(a){this._pyramid&&this._pyramid.update(this.used,a)},reload:function(){this._pyramid&&this._pyramid.reload()},redoPlacement:function(){if(this._pyramid)for(var a=this._pyramid.orderedIDs(),b=0;b<a.length;b++){var c=this._pyramid.getTile(a[b]);this._redoTilePlacement(c)}},render:g._renderTiles,featuresAt:g._vectorFeaturesAt,featuresIn:g._vectorFeaturesIn,_loadTile:function(a){var b=a.coord.z>this.maxzoom?Math.pow(2,a.coord.z-this.maxzoom):1,c={url:a.coord.url(this.tiles,this.maxzoom),uid:a.uid,coord:a.coord,zoom:a.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize*b,source:this.id,overscaling:b,
angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug};a.workerID?this.dispatcher.send("reload tile",c,this._tileLoaded.bind(this,a),a.workerID):a.workerID=this.dispatcher.send("load tile",c,this._tileLoaded.bind(this,a))},_tileLoaded:function(a,b,c){if(!a.aborted){if(b)return void this.fire("tile.error",{tile:a});a.loadVectorData(c),a.redoWhenDone&&(a.redoWhenDone=!1,this._redoTilePlacement(a)),this.fire("tile.load",{tile:a})}},_abortTile:function(a){a.aborted=!0,this.dispatcher.send("abort tile",{uid:a.uid,source:this.id},null,a.workerID)},_addTile:function(a){this.fire("tile.add",{tile:a})},_removeTile:function(a){this.fire("tile.remove",{tile:a})},_unloadTile:function(a){a.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(a.uid),this.dispatcher.send("remove tile",{uid:a.uid,source:this.id},null,a.workerID)},_redoTilePlacement:function(a){function b(b,c){a.reloadSymbolData(c,this.map.painter),this.fire("tile.load",{tile:a}),a.redoingPlacement=!1,a.redoWhenDone&&(this._redoTilePlacement(a),a.redoWhenDone=!1)}return!a.loaded||a.redoingPlacement?void(a.redoWhenDone=!0):(a.redoingPlacement=!0,void this.dispatcher.send("redo placement",{uid:a.uid,source:this.id,angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug},b.bind(this),a.workerID))}})},{"../util/evented":100,"../util/util":106,"./source":43}],48:[function(a,b,c){"use strict";function d(a){this.coordinates=a.coordinates,j.getVideo(a.urls,function(a,b){if(!a){this.video=b,this.video.loop=!0;var c;this.video.addEventListener("playing",function(){c=this.map.style.animationLoop.set(1/0),this.map._rerender()}.bind(this)),this.video.addEventListener("pause",function(){this.map.style.animationLoop.cancel(c)}.bind(this)),this._loaded=!0,this.map&&(this.video.play(),this.createTile(),this.fire("change"))}}.bind(this))}var e=a("../util/util"),f=a("./tile"),g=a("../geo/lng_lat"),h=a("point-geometry"),i=a("../util/evented"),j=a("../util/ajax");b.exports=d,d.prototype=e.inherit(i,{roundZoom:!0,getVideo:function(){return this.video},onAdd:function(a){this.map=a,this.video&&(this.video.play(),this.createTile())},createTile:function(){var a=this.map,b=this.coordinates.map(function(b){var c=g.convert(b);return a.transform.locationCoordinate(c).zoomTo(0)}),c=e.getCoordinatesCenter(b),d=4096,i=b.map(function(a){var b=a.zoomTo(c.zoom);return new h(Math.round((b.column-c.column)*d),Math.round((b.row-c.row)*d))}),j=a.painter.gl,k=32767,l=new Int16Array([i[0].x,i[0].y,0,0,i[1].x,i[1].y,k,0,i[3].x,i[3].y,0,k,i[2].x,i[2].y,k,k]);this.tile=new f,this.tile.buckets={},this.tile.boundsBuffer=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,this.tile.boundsBuffer),j.bufferData(j.ARRAY_BUFFER,l,j.STATIC_DRAW),this.center=c},loaded:function(){return this.video&&this.video.readyState>=2},update:function(){},reload:function(){},render:function(a,b){if(this._loaded&&!(this.video.readyState<2)){var c=this.center;this.tile.calculateMatrices(c.zoom,c.column,c.row,this.map.transform,b);var d=b.gl;this.tile.texture?(d.bindTexture(d.TEXTURE_2D,this.tile.texture),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.tile.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.tile.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,this.video)),b.drawLayers(a,this.tile.posMatrix,this.tile)}},featuresAt:function(a,b,c){return c(null,[])},featuresIn:function(a,b,c){return c(null,[])}})},{"../geo/lng_lat":20,"../util/ajax":94,"../util/evented":100,"../util/util":106,"./tile":44,"point-geometry":137}],49:[function(a,b,c){"use strict";function d(a){this.self=a,this.actor=new e(a,this),this.loading={},this.loaded={},this.layers=[],this.geoJSONIndexes={}}var e=a("../util/actor"),f=a("./worker_tile"),g=a("../util/util"),h=a("../util/ajax"),i=a("vector-tile"),j=a("pbf"),k=a("geojson-vt"),l=a("./geojson_wrapper");b.exports=function(a){return new d(a)},g.extend(d.prototype,{"set layers":function(a){this.layers=a},"load tile":function(a,b){function c(a,c){return delete this.loading[d][e],a?b(a):(g.data=new i.VectorTile(new j(new Uint8Array(c))),g.parse(g.data,this.layers,this.actor,b),this.loaded[d]=this.loaded[d]||{},void(this.loaded[d][e]=g))}var d=a.source,e=a.uid;this.loading[d]||(this.loading[d]={});var g=this.loading[d][e]=new f(a);g.xhr=h.getArrayBuffer(a.url,c.bind(this))},"reload tile":function(a,b){var c=this.loaded[a.source],d=a.uid;if(c&&c[d]){var e=c[d];e.parse(e.data,this.layers,this.actor,b)}},"abort tile":function(a){var b=this.loading[a.source],c=a.uid;b&&b[c]&&(b[c].xhr.abort(),delete b[c])},"remove tile":function(a){var b=this.loaded[a.source],c=a.uid;b&&b[c]&&delete b[c]},"redo placement":function(a,b){var c=this.loaded[a.source],d=this.loading[a.source],e=a.uid;if(c&&c[e]){var f=c[e],g=f.redoPlacement(a.angle,a.pitch,a.collisionDebug);g.result&&b(null,g.result,g.transferables)}else d&&d[e]&&(d[e].angle=a.angle)},"parse geojson":function(a,b){var c=function(c,d){return c?b(c):(this.geoJSONIndexes[a.source]=k(d,a.geojsonVtOptions),void b(null))}.bind(this);"string"==typeof a.data?h.getJSON(a.data,c):c(null,a.data)},"load geojson tile":function(a,b){var c=a.source,d=a.coord,e=this.geoJSONIndexes[c].getTile(d.z,d.x,d.y);if(!e)return b(null,null);var g=new f(a);g.parse(new l(e.features),this.layers,this.actor,b),this.loaded[c]=this.loaded[c]||{},this.loaded[c][a.uid]=g},"query features":function(a,b){var c=this.loaded[a.source]&&this.loaded[a.source][a.uid];c?c.featureTree.query(a,b):b(null,[])}})},{"../util/actor":93,"../util/ajax":94,"../util/util":106,"./geojson_wrapper":40,"./worker_tile":50,"geojson-vt":115,pbf:135,"vector-tile":141}],50:[function(a,b,c){"use strict";function d(a){this.coord=a.coord,this.uid=a.uid,this.zoom=a.zoom,this.maxZoom=a.maxZoom,this.tileSize=a.tileSize,this.source=a.source,this.overscaling=a.overscaling,this.angle=a.angle,this.pitch=a.pitch,this.collisionDebug=a.collisionDebug,this.stacks={}}var e=a("../data/feature_tree"),f=a("../symbol/collision_tile"),g=a("../data/buffer/buffer_set"),h=a("../data/create_bucket");b.exports=d,d.prototype.parse=function(a,b,c,d){function i(a,b){for(var c=0;c<a.length;c++){var d=a.feature(c);for(var e in b){var f=b[e];f.filter(d)&&f.features.push(d)}}}function j(a){return function(b){a.dependenciesLoaded=!0,k(q,a,b)}}function k(a,b,c){if(!(b.getDependencies&&!b.dependenciesLoaded||b.needsPlacement&&!b.previousPlaced)){if(!c){var d=Date.now();b.features.length&&b.addFeatures(s);var e=Date.now()-d;if(b.interactive)for(var f=0;f<b.features.length;f++){var g=b.features[f];a.featureTree.insert(g.bbox(),b.layers,g)}"undefined"!=typeof self&&(self.bucketStats=self.bucketStats||{_total:0},self.bucketStats._total+=e,self.bucketStats[b.id]=(self.bucketStats[b.id]||0)+e)}return C--,C?void(b.next&&(b.next.previousPlaced=!0,k(a,b.next))):void l()}}function l(){if(q.status="done",q.redoPlacementAfterDone){var a=q.redoPlacement(q.angle,q.pitch).result;r.glyphVertex=a.buffers.glyphVertex,r.iconVertex=a.buffers.iconVertex,r.collisionBoxVertex=a.buffers.collisionBoxVertex}var b=[],c={};for(n in r)b.push(r[n].array);for(n in t)c[n]=t[n].elementGroups;d(null,{elementGroups:c,buffers:r,extent:A},b)}this.status="parsing",this.featureTree=new e(this.coord,this.overscaling);var m,n,o,p,q=this,r=new g,s=new f(this.angle,this.pitch),t={},u=this.bucketsInOrder=[],v={};for(m=0;m<b.length;m++)if(o=b[m],o.source===this.source&&!o.ref){var w=o.minzoom;if(!(w&&this.zoom<w&&w<this.maxZoom)){var x=o.maxzoom;if(!(x&&this.zoom>=x)){var y=o.layout.visibility;if("none"!==y)if(p=h(o,r,this.zoom,this.overscaling,this.collisionDebug),p.layers=[o.id],t[p.id]=p,u.push(p),a.layers){var z=o["source-layer"];v[z]||(v[z]={}),v[z][p.id]=p}else v[p.id]=p}}}for(m=0;m<b.length;m++)o=b[m],o.source===this.source&&o.ref&&(p=t[o.ref],p&&p.layers.push(o.id));var A=4096;if(a.layers)for(n in v)o=a.layers[n],o&&(o.extent&&(A=o.extent),i(o,v[n]));else i(a,v);var B,C=u.length;for(m=u.length-1;m>=0;m--)p=u[m],p.needsPlacement&&(B?B.next=p:p.previousPlaced=!0,B=p),p.getDependencies&&p.getDependencies(this,c,j(p)),p.needsPlacement||p.getDependencies||k(q,p)},d.prototype.redoPlacement=function(a,b,c){if("done"!==this.status)return this.redoPlacementAfterDone=!0,this.angle=a,{};for(var d=new g,e=[],h={},i=new f(a,b),j=this.bucketsInOrder,k=j.length-1;k>=0;k--){var l=j[k];"symbol"===l.type&&(l.placeFeatures(i,d,c),h[l.id]=l.elementGroups)}for(var m in d)e.push(d[m].array);return{result:{elementGroups:h,buffers:d},transferables:e}}},{"../data/buffer/buffer_set":2,"../data/create_bucket":13,"../data/feature_tree":15,"../symbol/collision_tile":68}],51:[function(a,b,c){"use strict";function d(){this.n=0,this.times=[]}b.exports=d,d.prototype.stopped=function(){return this.times=this.times.filter(function(a){return a.time>=(new Date).getTime()}),!this.times.length},d.prototype.set=function(a){return this.times.push({id:this.n,time:a+(new Date).getTime()}),this.n++},d.prototype.cancel=function(a){this.times=this.times.filter(function(b){return b.id!==a})}},{}],52:[function(a,b,c){"use strict";function d(a){this.base=a,this.retina=h.devicePixelRatio>1;var b=this.retina?"@2x":"";g.getJSON(i(a,b,".json"),function(a,b){return a?void this.fire("error",{error:a}):(this.data=b,void(this.img&&this.fire("load")))}.bind(this)),g.getImage(i(a,b,".png"),function(a,b){if(a)return void this.fire("error",{error:a});for(var c=b.getData(),d=b.data=new Uint8Array(c.length),e=0;e<c.length;e+=4){var f=c[e+3]/255;d[e+0]=c[e+0]*f,d[e+1]=c[e+1]*f,d[e+2]=c[e+2]*f,d[e+3]=c[e+3]}this.img=b,this.data&&this.fire("load")}.bind(this))}function e(){}var f=a("../util/evented"),g=a("../util/ajax"),h=a("../util/browser"),i=a("../util/mapbox").normalizeSpriteURL;b.exports=d,d.prototype=Object.create(f),d.prototype.toJSON=function(){return this.base},d.prototype.loaded=function(){return!(!this.data||!this.img)},d.prototype.resize=function(){if(h.devicePixelRatio>1!==this.retina){var a=new d(this.base);a.on("load",function(){this.img=a.img,this.data=a.data,this.retina=a.retina}.bind(this))}},e.prototype={x:0,y:0,width:0,height:0,pixelRatio:1,sdf:!1},d.prototype.getSpritePosition=function(a){if(!this.loaded())return new e;var b=this.data&&this.data[a];return b&&this.img?b:new e}},{"../util/ajax":94,"../util/browser":95,"../util/evented":100,"../util/mapbox":103}],53:[function(a,b,c){"use strict";var d=a("./reference");b.exports={},d.layout.forEach(function(a){var c=function(a){for(var b in a)this[b]=a[b]},e=d[a];for(var f in e)void 0!==e[f]["default"]&&(c.prototype[f]=e[f]["default"]);b.exports[a.replace("layout_","")]=c})},{"./reference":55}],54:[function(a,b,c){"use strict";var d=a("./reference"),e=a("csscolorparser").parseCSSColor;b.exports={},d.paint.forEach(function(a){var c=function(){},f=d[a];for(var g in f){var h=f[g],i=h["default"];void 0!==i&&("color"===h.type&&(i=e(i)),c.prototype[g]=i)}c.prototype.hidden=!1,b.exports[a.replace("paint_","")]=c})},{"./reference":55,csscolorparser:111}],55:[function(a,b,c){b.exports=a("mapbox-gl-style-spec/reference/latest")},{"mapbox-gl-style-spec/reference/latest":132}],56:[function(a,b,c){"use strict";function d(a,b){this.animationLoop=b||new r,this.dispatcher=new q(Math.max(p.hardwareConcurrency-1,1),this),this.glyphAtlas=new j(1024,1024),this.spriteAtlas=new k(512,512),this.spriteAtlas.resize(p.devicePixelRatio),this.lineAtlas=new l(256,512),this._layers={},this._order=[],this._groups=[],this.sources={},this.zoomHistory={},m.bindAll(["_forwardSourceEvent","_forwardTileEvent","_redoPlacement"],this);var c=function(a,b){if(a)return void this.fire("error",{error:a});var c=s(b);if(c.length)for(var d=0;d<c.length;d++)this.fire("error",{error:new Error(c[d].message)});else{this._loaded=!0,this.stylesheet=b;var e=b.sources;for(var f in e)this.addSource(f,e[f]);b.sprite&&(this.sprite=new h(b.sprite),this.sprite.on("load",this.fire.bind(this,"change"))),this.glyphSource=new i(b.glyphs,this.glyphAtlas),this._resolve(),this.fire("load")}}.bind(this);"string"==typeof a?n.getJSON(o(a),c):p.frame(c.bind(this,null,a))}var e=a("../util/evented"),f=a("./style_batch"),g=a("./style_layer"),h=a("./image_sprite"),i=a("../symbol/glyph_source"),j=a("../symbol/glyph_atlas"),k=a("../symbol/sprite_atlas"),l=a("../render/line_atlas"),m=a("../util/util"),n=a("../util/ajax"),o=a("../util/mapbox").normalizeStyleURL,p=a("../util/browser"),q=a("../util/dispatcher"),r=a("./animation_loop"),s=a("mapbox-gl-style-spec/lib/validate/latest");b.exports=d,d.prototype=m.inherit(e,{_loaded:!1,loaded:function(){if(!this._loaded)return!1;for(var a in this.sources)if(!this.sources[a].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},_resolve:function(){var a,b;this._layers={},this._order=[];for(var c=0;c<this.stylesheet.layers.length;c++)b=new g(this.stylesheet.layers[c]),this._layers[b.id]=b,this._order.push(b.id);for(a in this._layers)this._layers[a].resolveLayout();for(a in this._layers)this._layers[a].resolveReference(this._layers),this._layers[a].resolvePaint();this._groupLayers(),this._broadcastLayers()},_groupLayers:function(){var a;this._groups=[];for(var b=0;b<this._order.length;++b){var c=this._layers[this._order[b]];a&&c.source===a.source||(a=[],a.source=c.source,this._groups.push(a)),a.push(c)}},_broadcastLayers:function(){var a=[];for(var b in this._layers)a.push(this._layers[b].json());this.dispatcher.broadcast("set layers",a)},_cascade:function(a,b){if(this._loaded){b=b||{transition:!0};for(var c in this._layers)this._layers[c].cascade(a,b,this.stylesheet.transition||{},this.animationLoop);this.fire("change")}},_recalculate:function(a){for(var b in this.sources)this.sources[b].used=!1;this._updateZoomHistory(a),this.rasterFadeDuration=300;for(b in this._layers){var c=this._layers[b];c.recalculate(a,this.zoomHistory)&&c.source&&(this.sources[c.source].used=!0)}var d=300;Math.floor(this.z)!==Math.floor(a)&&this.animationLoop.set(d),this.z=a,this.fire("zoom")},_updateZoomHistory:function(a){var b=this.zoomHistory;void 0===b.lastIntegerZoom&&(b.lastIntegerZoom=Math.floor(a),b.lastIntegerZoomTime=0,b.lastZoom=a),Math.floor(b.lastZoom)<Math.floor(a)?(b.lastIntegerZoom=Math.floor(a),b.lastIntegerZoomTime=Date.now()):Math.floor(b.lastZoom)>Math.floor(a)&&(b.lastIntegerZoom=Math.floor(a+1),b.lastIntegerZoomTime=Date.now()),b.lastZoom=a},batch:function(a){f(this,a)},addSource:function(a,b){return this.batch(function(c){c.addSource(a,b)}),this},removeSource:function(a){return this.batch(function(b){b.removeSource(a)}),this},getSource:function(a){return this.sources[a]},addLayer:function(a,b){return this.batch(function(c){c.addLayer(a,b)}),this},removeLayer:function(a){return this.batch(function(b){b.removeLayer(a)}),this},getLayer:function(a){return this._layers[a]},getReferentLayer:function(a){var b=this.getLayer(a);return b.ref&&(b=this.getLayer(b.ref)),b},setFilter:function(a,b){return this.batch(function(c){c.setFilter(a,b)}),this},setLayerZoomRange:function(a,b,c){return this.batch(function(d){d.setLayerZoomRange(a,b,c)}),this},getFilter:function(a){return this.getReferentLayer(a).filter},getLayoutProperty:function(a,b){return this.getReferentLayer(a).getLayoutProperty(b)},getPaintProperty:function(a,b,c){return this.getLayer(a).getPaintProperty(b,c)},featuresAt:function(a,b,c){var d=[],e=null;b.layer&&(b.layerIds=Array.isArray(b.layer)?b.layer:[b.layer]),m.asyncEach(Object.keys(this.sources),function(c,f){var g=this.sources[c];g.featuresAt(a,b,function(a,b){b&&(d=d.concat(b)),a&&(e=a),f()})}.bind(this),function(){return e?c(e):void c(null,d.filter(function(a){return void 0!==this._layers[a.layer]}.bind(this)).map(function(a){return a.layer=this._layers[a.layer].json(),a}.bind(this)))}.bind(this))},featuresIn:function(a,b,c){var d=[],e=null;b.layer&&(b.layer={id:b.layer}),m.asyncEach(Object.keys(this.sources),function(c,f){var g=this.sources[c];g.featuresIn(a,b,function(a,b){b&&(d=d.concat(b)),a&&(e=a),f()})}.bind(this),function(){return e?c(e):void c(null,d.filter(function(a){return void 0!==this._layers[a.layer]}.bind(this)).map(function(a){return a.layer=this._layers[a.layer].json(),a}.bind(this)))}.bind(this))},_remove:function(){this.dispatcher.remove()},_reloadSource:function(a){this.sources[a].reload()},_updateSources:function(a){for(var b in this.sources)this.sources[b].update(a)},_redoPlacement:function(){for(var a in this.sources)this.sources[a].redoPlacement&&this.sources[a].redoPlacement()},_forwardSourceEvent:function(a){this.fire("source."+a.type,m.extend({source:a.target},a))},_forwardTileEvent:function(a){this.fire(a.type,m.extend({source:a.target},a))},"get sprite json":function(a,b){var c=this.sprite;c.loaded()?b(null,{sprite:c.data,retina:c.retina}):c.on("load",function(){b(null,{sprite:c.data,retina:c.retina})})},"get icons":function(a,b){var c=this.sprite,d=this.spriteAtlas;c.loaded()?(d.setSprite(c),d.addIcons(a.icons,b)):c.on("load",function(){d.setSprite(c),d.addIcons(a.icons,b)})},"get glyphs":function(a,b){this.glyphSource.getSimpleGlyphs(a.fontstack,a.codepoints,a.uid,b)}})},{"../render/line_atlas":36,"../symbol/glyph_atlas":70,"../symbol/glyph_source":71,"../symbol/sprite_atlas":77,"../util/ajax":94,"../util/browser":95,"../util/dispatcher":97,"../util/evented":100,"../util/mapbox":103,"../util/util":106,"./animation_loop":51,"./image_sprite":52,"./style_batch":57,"./style_layer":60,"mapbox-gl-style-spec/lib/validate/latest":130}],57:[function(a,b,c){"use strict";function d(a,b){if(!a._loaded)throw new Error("Style is not done loading");var c=Object.create(d.prototype);c._style=a,c._groupLayers=!1,c._broadcastLayers=!1,c._reloadSources={},c._events=[],c._change=!1,b(c),c._groupLayers&&c._style._groupLayers(),c._broadcastLayers&&c._style._broadcastLayers(),Object.keys(c._reloadSources).forEach(function(a){c._style._reloadSource(a)}),c._events.forEach(function(a){c._style.fire.apply(c._style,a)}),c._change&&c._style.fire("change")}var e=a("../source/source"),f=a("./style_layer");d.prototype={addLayer:function(a,b){if(void 0!==this._style._layers[a.id])throw new Error("There is already a layer with this ID");return a instanceof f||(a=new f(a)),this._style._layers[a.id]=a,this._style._order.splice(b?this._style._order.indexOf(b):1/0,0,a.id),a.resolveLayout(),a.resolveReference(this._style._layers),a.resolvePaint(),this._groupLayers=!0,this._broadcastLayers=!0,a.source&&(this._reloadSources[a.source]=!0),this._events.push(["layer.add",{layer:a}]),this._change=!0,this},removeLayer:function(a){var b=this._style._layers[a];if(void 0===b)throw new Error("There is no layer with this ID");for(var c in this._style._layers)this._style._layers[c].ref===a&&this.removeLayer(c);return delete this._style._layers[a],this._style._order.splice(this._style._order.indexOf(a),1),this._groupLayers=!0,this._broadcastLayers=!0,this._events.push(["layer.remove",{layer:b}]),this._change=!0,this},setPaintProperty:function(a,b,c,d){return this._style.getLayer(a).setPaintProperty(b,c,d),this._change=!0,this},setLayoutProperty:function(a,b,c){return a=this._style.getReferentLayer(a),a.setLayoutProperty(b,c),this._broadcastLayers=!0,a.source&&(this._reloadSources[a.source]=!0),this._change=!0,this},setFilter:function(a,b){return a=this._style.getReferentLayer(a),a.filter=b,this._broadcastLayers=!0,a.source&&(this._reloadSources[a.source]=!0),this._change=!0,this},setLayerZoomRange:function(a,b,c){var d=this._style.getReferentLayer(a);return null!=b&&(d.minzoom=b),null!=c&&(d.maxzoom=c),this._broadcastLayers=!0,d.source&&(this._reloadSources[d.source]=!0),this._change=!0,this},addSource:function(a,b){if(!this._style._loaded)throw new Error("Style is not done loading");if(void 0!==this._style.sources[a])throw new Error("There is already a source with this ID");return b=e.create(b),this._style.sources[a]=b,b.id=a,b.style=this._style,b.dispatcher=this._style.dispatcher,b.glyphAtlas=this._style.glyphAtlas,b.on("load",this._style._forwardSourceEvent).on("error",this._style._forwardSourceEvent).on("change",this._style._forwardSourceEvent).on("tile.add",this._style._forwardTileEvent).on("tile.load",this._style._forwardTileEvent).on("tile.error",this._style._forwardTileEvent).on("tile.remove",this._style._forwardTileEvent),this._events.push(["source.add",{source:b}]),this._change=!0,this},removeSource:function(a){if(void 0===this._style.sources[a])throw new Error("There is no source with this ID");var b=this._style.sources[a];return delete this._style.sources[a],b.off("load",this._style._forwardSourceEvent).off("error",this._style._forwardSourceEvent).off("change",this._style._forwardSourceEvent).off("tile.add",this._style._forwardTileEvent).off("tile.load",this._style._forwardTileEvent).off("tile.error",this._style._forwardTileEvent).off("tile.remove",this._style._forwardTileEvent),this._events.push(["source.remove",{source:b}]),this._change=!0,this}},b.exports=d},{"../source/source":43,"./style_layer":60}],58:[function(a,b,c){"use strict";function d(a,b){this.type=a.type,this.transitionable=a.transition,null==b&&(b=a["default"]),this.json=JSON.stringify(b),"color"===this.type?this.value=f(b):this.value=b,"interpolated"===a["function"]?this.calculate=i.interpolated(this.value):(this.calculate=i["piecewise-constant"](this.value),a.transition&&(this.calculate=e(this.calculate)))}function e(a){return function(b,c,d){var e,f,g,h=b%1,i=Math.min((Date.now()-c.lastIntegerZoomTime)/d,1),j=1,k=1;return b>c.lastIntegerZoom?(e=h+(1-h)*i,j*=2,f=a(b-1),g=a(b)):(e=1-(1-i)*h,g=a(b),f=a(b+1),j/=2),{from:f,fromScale:j,to:g,toScale:k,t:e}}}function f(a){if(k[a])return k[a];if(Array.isArray(a))return a;if(a.stops)return j.extend({},a,{stops:a.stops.map(function(a){return[a[0],f(a[1])]})});if("string"==typeof a){var b=g(h(a));return k[a]=b,b}throw new Error("Invalid color "+a)}function g(a){return[a[0]/255,a[1]/255,a[2]/255,a[3]/1]}var h=a("csscolorparser").parseCSSColor,i=a("mapbox-gl-function"),j=a("../util/util");b.exports=d;var k={}},{"../util/util":106,csscolorparser:111,"mapbox-gl-function":129}],59:[function(a,b,c){"use strict";function d(a){function b(a){this._values={},this._transitions={};for(var b in a)this[b]=a[b]}return Object.keys(a).forEach(function(c){var d=a[c];Object.defineProperty(b.prototype,c,{set:function(a){this._values[c]=new g(d,a)},get:function(){return this._values[c].value}}),d.transition&&Object.defineProperty(b.prototype,c+"-transition",{set:function(a){this._transitions[c]=a},get:function(){return this._transitions[c]}})}),b.prototype.values=function(){return this._values},b.prototype.transition=function(a,b){var c=this._transitions[a]||{};return{duration:e.coalesce(c.duration,b.duration,300),delay:e.coalesce(c.delay,b.delay,0)}},b.prototype.json=function(){var a={};for(var b in this._values)a[b]=this._values[b].value;for(var c in this._transitions)a[c+"-transition"]=this._transitions[b];return a},b}var e=a("../util/util"),f=a("./reference"),g=a("./style_declaration"),h={paint:{},layout:{}};f.layer.type.values.forEach(function(a){h.paint[a]=d(f["paint_"+a]),h.layout[a]=d(f["layout_"+a])}),b.exports=function(a,b,c){return new h[a][b](c)}},{"../util/util":106,"./reference":55,"./style_declaration":58}],60:[function(a,b,c){"use strict";function d(a){this._layer=a,this.id=a.id,this.ref=a.ref,this._resolved={},this._cascaded={},this.assign(a)}function e(a,b){var c=b+"-color",d=b+"-halo-color",e=b+"-outline-color",g=a[c],h=a[d],i=a[e],j=a[b+"-opacity"],k=g&&j*g[3],l=h&&j*h[3],m=i&&j*i[3];void 0!==k&&1>k&&(a[c]=f.premultiply([g[0],g[1],g[2],k])),void 0!==l&&1>l&&(a[d]=f.premultiply([h[0],h[1],h[2],l])),void 0!==m&&1>m&&(a[e]=f.premultiply([i[0],i[1],i[2],m]))}var f=a("../util/util"),g=a("./style_transition"),h=a("./style_declaration_set"),i=a("./layout_properties"),j=a("./paint_properties");b.exports=d,d.prototype={resolveLayout:function(){this.ref||(this.layout=new i[this.type](this._layer.layout),"line"===this.layout["symbol-placement"]&&(this.layout.hasOwnProperty("text-rotation-alignment")||(this.layout["text-rotation-alignment"]="map"),this.layout.hasOwnProperty("icon-rotation-alignment")||(this.layout["icon-rotation-alignment"]="map"),this.layout["symbol-avoid-edges"]=!0))},setLayoutProperty:function(a,b){null==b?delete this.layout[a]:this.layout[a]=b},getLayoutProperty:function(a){return this.layout[a]},resolveReference:function(a){this.ref&&this.assign(a[this.ref])},resolvePaint:function(){for(var a in this._layer){var b=a.match(/^paint(?:\.(.*))?$/);b&&(this._resolved[b[1]||""]=new h("paint",this.type,this._layer[a]))}},setPaintProperty:function(a,b,c){var d=this._resolved[c||""];d||(d=this._resolved[c||""]=new h("paint",this.type,{})),d[a]=b},getPaintProperty:function(a,b){var c=this._resolved[b||""];return c?c[a]:void 0},cascade:function(a,b,c,d){for(var e in this._resolved)if(""===e||a[e]){var f=this._resolved[e],i=f.values();for(var j in i){var k=i[j],l=b.transition?this._cascaded[j]:void 0;if(!l||l.declaration.json!==k.json){var m=f.transition(j,c),n=this._cascaded[j]=new g(k,l,m);n.instant()||(n.loopID=d.set(n.endTime-(new Date).getTime())),l&&d.cancel(l.loopID)}}}if("symbol"===this.type){var o=new h("layout",this.type,this.layout);this._cascaded["text-size"]=new g(o.values()["text-size"],(void 0),c),this._cascaded["icon-size"]=new g(o.values()["icon-size"],(void 0),c)}},recalculate:function(a,b){var c=this.type,d=this.paint=new j[c];for(var f in this._cascaded)d[f]=this._cascaded[f].at(a,b);if(this.hidden=this.minzoom&&a<this.minzoom||this.maxzoom&&a>=this.maxzoom||"none"===this.layout.visibility,"symbol"===c?0!==d["text-opacity"]&&this.layout["text-field"]||0!==d["icon-opacity"]&&this.layout["icon-image"]?(e(d,"text"),e(d,"icon")):this.hidden=!0:0===d[c+"-opacity"]?this.hidden=!0:e(d,c),this._cascaded["line-dasharray"]){var g=d["line-dasharray"],h=this._cascaded["line-width"]?this._cascaded["line-width"].at(Math.floor(a),1/0):d["line-width"];g.fromScale*=h,g.toScale*=h}return!this.hidden},assign:function(a){f.extend(this,f.pick(a,["type","source","source-layer","minzoom","maxzoom","filter","layout"]))},json:function(){return f.extend({},this._layer,f.pick(this,["type","source","source-layer","minzoom","maxzoom","filter","layout","paint"]))}}},{"../util/util":106,"./layout_properties":53,"./paint_properties":54,"./style_declaration_set":59,"./style_transition":61}],61:[function(a,b,c){"use strict";function d(a,b,c){this.declaration=a,this.startTime=this.endTime=(new Date).getTime();var d=a.type;"string"!==d&&"array"!==d||!a.transitionable?this.interp=g[d]:this.interp=e,this.oldTransition=b,this.duration=c.duration||0,this.delay=c.delay||0,this.instant()||(this.endTime=this.startTime+this.duration+this.delay,this.ease=f.easeCubicInOut),b&&b.endTime<=this.startTime&&delete b.oldTransition}function e(a,b,c){return{from:a.to,fromScale:a.toScale,to:b.to,toScale:b.toScale,t:c}}var f=a("../util/util"),g=a("../util/interpolate");b.exports=d,d.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},d.prototype.at=function(a,b,c){var d=this.declaration.calculate(a,b,this.duration);if(this.instant())return d;if(c=c||Date.now(),c<this.endTime){var e=this.oldTransition.at(a,b,this.startTime),f=this.ease((c-this.startTime-this.delay)/this.duration);d=this.interp(e,d,f)}return d}},{"../util/interpolate":102,"../util/util":106}],62:[function(a,b,c){"use strict";function d(a,b,c,d){this.x=a,this.y=b,this.angle=c,void 0!==d&&(this.segment=d)}var e=a("point-geometry");b.exports=d,d.prototype=Object.create(e.prototype),d.prototype.clone=function(){return new d(this.x,this.y,this.angle,this.segment)}},{"point-geometry":137}],63:[function(a,b,c){"use strict";function d(a,b){this.width=a,this.height=b,this.free=[{x:0,y:0,w:a,h:b}]}b.exports=d,d.prototype.release=function(a){for(var b=0;b<this.free.length;b++){var c=this.free[b];if(c.y===a.y&&c.h===a.h&&c.x+c.w===a.x)c.w+=a.w;else if(c.x===a.x&&c.w===a.w&&c.y+c.h===a.y)c.h+=a.h;else if(a.y===c.y&&a.h===c.h&&a.x+a.w===c.x)c.x=a.x,c.w+=a.w;else{if(a.x!==c.x||a.w!==c.w||a.y+a.h!==c.y)continue;c.y=a.y,c.h+=a.h}return this.free.splice(b,1),void this.release(c)}this.free.push(a)},d.prototype.allocate=function(a,b){for(var c={x:1/0,y:1/0,w:1/0,h:1/0},d=-1,e=0;e<this.free.length;e++){var f=this.free[e];a<=f.w&&b<=f.h&&f.y<=c.y&&f.x<=c.x&&(c=f,d=e)}return 0>d?{x:-1,y:-1}:(this.free.splice(d,1),c.w<c.h?(c.w>a&&this.free.push({x:c.x+a,y:c.y,w:c.w-a,h:b}),c.h>b&&this.free.push({x:c.x,y:c.y+b,w:c.w,h:c.h-b})):(c.w>a&&this.free.push({x:c.x+a,y:c.y,w:c.w-a,h:c.h}),c.h>b&&this.free.push({x:c.x,y:c.y+b,w:a,h:c.h-b})),{x:c.x,y:c.y,w:a,h:b})}},{}],64:[function(a,b,c){"use strict";function d(a,b,c,d,e){if(void 0===b.segment)return!0;for(var f=b,g=b.segment+1,h=0;h>-c/2;){if(g--,0>g)return!1;h-=a[g].dist(f),f=a[g]}h+=a[g].dist(a[g+1]),g++;for(var i=[],j=0;c/2>h;){var k=a[g-1],l=a[g],m=a[g+1];if(!m)return!1;var n=k.angleTo(l)-l.angleTo(m);for(n=(n+3*Math.PI)%(2*Math.PI)-Math.PI,i.push({distance:h,angleDelta:n}),j+=n;h-i[0].distance>d;)j-=i.shift().angleDelta;if(Math.abs(j)>e)return!1;g++,h+=l.dist(m)}return!0}b.exports=d},{}],65:[function(a,b,c){"use strict";function d(a,b,c,d,f){for(var g=[],h=0;h<a.length;h++)for(var i,j=a[h],k=0;k<j.length-1;k++){var l=j[k],m=j[k+1];l.x<b&&m.x<b||(l.x<b?l=new e(b,l.y+(m.y-l.y)*((b-l.x)/(m.x-l.x))):m.x<b&&(m=new e(b,l.y+(m.y-l.y)*((b-l.x)/(m.x-l.x)))),l.y<c&&m.y<c||(l.y<c?l=new e(l.x+(m.x-l.x)*((c-l.y)/(m.y-l.y)),c):m.y<c&&(m=new e(l.x+(m.x-l.x)*((c-l.y)/(m.y-l.y)),c)),l.x>=d&&m.x>=d||(l.x>=d?l=new e(d,l.y+(m.y-l.y)*((d-l.x)/(m.x-l.x))):m.x>=d&&(m=new e(d,l.y+(m.y-l.y)*((d-l.x)/(m.x-l.x)))),l.y>=f&&m.y>=f||(l.y>=f?l=new e(l.x+(m.x-l.x)*((f-l.y)/(m.y-l.y)),f):m.y>=f&&(m=new e(l.x+(m.x-l.x)*((f-l.y)/(m.y-l.y)),f)),i&&l.equals(i[i.length-1])||(i=[l],g.push(i)),i.push(m)))))}return g}var e=a("point-geometry");b.exports=d},{"point-geometry":137}],66:[function(a,b,c){"use strict";function d(a,b,c,d,e,f){this.anchorPoint=a,this.x1=b,this.y1=c,this.x2=d,this.y2=e,this.maxScale=f,this.placementScale=0,this[0]=this[1]=this[2]=this[3]=0}b.exports=d},{}],67:[function(a,b,c){"use strict";function d(a,b,c,d,g,h){var i=c.top*d-g,j=c.bottom*d+g,k=c.left*d-g,l=c.right*d+g;if(this.boxes=[],h){var m=j-i,n=l-k;if(0>=m)return;m=Math.max(10*d,m),this._addLineCollisionBoxes(a,b,n,m)}else this.boxes.push(new e(new f(b.x,b.y),k,i,l,j,1/0))}var e=a("./collision_box"),f=a("point-geometry");b.exports=d,d.prototype._addLineCollisionBoxes=function(a,b,c,d){var f=d/2,g=Math.floor(c/f),h=-d/2,i=this.boxes,j=b,k=b.segment+1,l=h;do{if(k--,0>k)return i;l-=a[k].dist(j),j=a[k]}while(l>-c/2);for(var m=a[k].dist(a[k+1]),n=0;g>n;n++){for(var o=-c/2+n*f;o>l+m;){if(l+=m,k++,k+1>=a.length)return i;m=a[k].dist(a[k+1])}var p=o-l,q=a[k],r=a[k+1],s=r.sub(q)._unit()._mult(p)._add(q),t=Math.max(Math.abs(o-h)-f/2,0),u=c/2/t;i.push(new e(s,-d/2,-d/2,d/2,d/2,u))}return i}},{"./collision_box":66,"point-geometry":137}],68:[function(a,b,c){"use strict";function d(a,b){this.tree=e(),this.angle=a;var c=Math.sin(a),d=Math.cos(a);this.rotationMatrix=[d,-c,c,d],this.yStretch=1/Math.cos(b/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3)}var e=a("rbush");b.exports=d,d.prototype.minScale=.25,d.prototype.maxScale=2,d.prototype.placeCollisionFeature=function(a){for(var b=this.minScale,c=this.rotationMatrix,d=this.yStretch,e=0;e<a.boxes.length;e++){var f=a.boxes[e],g=f.anchorPoint.matMult(c),h=g.x,i=g.y;f[0]=h+f.x1,f[1]=i+f.y1*d,f[2]=h+f.x2,f[3]=i+f.y2*d;for(var j=this.tree.search(f),k=0;k<j.length;k++){var l=j[k],m=l.anchorPoint.matMult(c),n=(l.x1-f.x2)/(h-m.x),o=(l.x2-f.x1)/(h-m.x),p=(l.y1-f.y2)*d/(i-m.y),q=(l.y2-f.y1)*d/(i-m.y);(isNaN(n)||isNaN(o))&&(n=o=1),(isNaN(p)||isNaN(q))&&(p=q=1);var r=Math.min(Math.max(n,o),Math.max(p,q));if(r>l.maxScale&&(r=l.maxScale),r>f.maxScale&&(r=f.maxScale),
r>b&&r>=l.placementScale&&(b=r),b>=this.maxScale)return b}}return b},d.prototype.insertCollisionFeature=function(a,b){for(var c=a.boxes,d=0;d<c.length;d++)c[d].placementScale=b;b<this.maxScale&&this.tree.load(c)}},{rbush:138}],69:[function(a,b,c){"use strict";function d(a,b,c,d,f,g,h,i){var j=d?.6*g*h:0,k=Math.max(d?d.right-d.left:0,f?f.right-f.left:0);if(0===a[0].x||4096===a[0].x||0===a[0].y||4096===a[0].y)var l=!0;b/4>b-k*h&&(b=k*h+b/4);var m=2*g,n=l?b/2*i%b:(k/2+m)*h*i%b;return e(a,n,b,j,c,k*h,l,!1)}function e(a,b,c,d,i,j,k,l){for(var m=0,n=b-c,o=[],p=0;p<a.length-1;p++){for(var q=a[p],r=a[p+1],s=q.dist(r),t=r.angleTo(q);m+s>n+c;){n+=c;var u=(n-m)/s,v=f(q.x,r.x,u),w=f(q.y,r.y,u);if(v>=0&&4096>v&&w>=0&&4096>w){v=Math.round(v),w=Math.round(w);var x=new g(v,w,t,p);(!d||h(a,x,j,d,i))&&o.push(x)}}m+=s}return l||o.length||k||(o=e(a,m/2,c,d,i,j,k,!0)),o}var f=a("../util/interpolate"),g=a("../symbol/anchor"),h=a("./check_max_angle");b.exports=d},{"../symbol/anchor":62,"../util/interpolate":102,"./check_max_angle":64}],70:[function(a,b,c){"use strict";function d(a,b){this.width=a,this.height=b,this.bin=new e(a,b),this.index={},this.ids={},this.data=new Uint8Array(a*b)}var e=a("./bin_pack");b.exports=d,d.prototype={get debug(){return"canvas"in this},set debug(a){a&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!a&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},d.prototype.getGlyphs=function(){var a,b,c,d={};for(var e in this.ids)a=e.split("#"),b=a[0],c=a[1],d[b]||(d[b]=[]),d[b].push(c);return d},d.prototype.getRects=function(){var a,b,c,d={};for(var e in this.ids)a=e.split("#"),b=a[0],c=a[1],d[b]||(d[b]={}),d[b][c]=this.index[e];return d},d.prototype.removeGlyphs=function(a){for(var b in this.ids){var c=this.ids[b],d=c.indexOf(a);if(d>=0&&c.splice(d,1),this.ids[b]=c,!c.length){for(var e=this.index[b],f=this.data,g=0;g<e.h;g++)for(var h=this.width*(e.y+g)+e.x,i=0;i<e.w;i++)f[h+i]=0;this.dirty=!0,this.bin.release(e),delete this.index[b],delete this.ids[b]}}this.updateTexture(this.gl)},d.prototype.addGlyph=function(a,b,c,d){if(!c)return null;var e=b+"#"+c.id;if(this.index[e])return this.ids[e].indexOf(a)<0&&this.ids[e].push(a),this.index[e];if(!c.bitmap)return null;var f=c.width+2*d,g=c.height+2*d,h=1,i=f+2*h,j=g+2*h;i+=4-i%4,j+=4-j%4;var k=this.bin.allocate(i,j);if(k.x<0)return console.warn("glyph bitmap overflow"),{glyph:c,rect:null};this.index[e]=k,this.ids[e]=[a];for(var l=this.data,m=c.bitmap,n=0;g>n;n++)for(var o=this.width*(k.y+n+h)+k.x+h,p=f*n,q=0;f>q;q++)l[o+q]=m[p+q];return this.dirty=!0,k},d.prototype.bind=function(a){this.gl=a,this.texture?a.bindTexture(a.TEXTURE_2D,this.texture):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,null))},d.prototype.updateTexture=function(a){if(this.bind(a),this.dirty){if(a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data),this.ctx){for(var b=this.ctx.getImageData(0,0,this.width,this.height),c=0,d=0;c<this.data.length;c++,d+=4)b.data[d]=this.data[c],b.data[d+1]=this.data[c],b.data[d+2]=this.data[c],b.data[d+3]=255;this.ctx.putImageData(b,0,0),this.ctx.strokeStyle="red";for(var e=0;e<this.bin.free.length;e++){var f=this.bin.free[e];this.ctx.strokeRect(f.x,f.y,f.w,f.h)}}this.dirty=!1}}},{"./bin_pack":63}],71:[function(a,b,c){"use strict";function d(a,b){this.url=a&&g(a),this.glyphAtlas=b,this.stacks=[],this.loading={}}function e(a,b,c){var d=1;this.advance=a.advance,this.left=a.left-c-d,this.top=a.top+c+d,this.rect=b}function f(a,b,c,d){return d=d||"abc",c.replace("{s}",d[a.length%d.length]).replace("{fontstack}",a).replace("{range}",b)}var g=a("../util/mapbox").normalizeGlyphsURL,h=a("../util/ajax").getArrayBuffer,i=a("../util/glyphs"),j=a("pbf");b.exports=d,d.prototype.getSimpleGlyphs=function(a,b,c,d){void 0===this.stacks[a]&&(this.stacks[a]={});for(var f,g={},h=this.stacks[a],i=this.glyphAtlas,j=3,k={},l=0,m=0;m<b.length;m++){var n=b[m];if(f=Math.floor(n/256),h[f]){var o=h[f].glyphs[n],p=i.addGlyph(c,a,o,j);o&&(g[n]=new e(o,p,j))}else void 0===k[f]&&(k[f]=[],l++),k[f].push(n)}l||d(void 0,g);var q=function(b,f,h){if(!b)for(var m=this.stacks[a][f]=h.stacks[0],n=0;n<k[f].length;n++){var o=k[f][n],p=m.glyphs[o],q=i.addGlyph(c,a,p,j);p&&(g[o]=new e(p,q,j))}l--,l||d(void 0,g)}.bind(this);for(var r in k)this.loadRange(a,r,q)},d.prototype.loadRange=function(a,b,c){if(256*b>65535)return c("gyphs > 65535 not supported");void 0===this.loading[a]&&(this.loading[a]={});var d=this.loading[a];if(d[b])d[b].push(c);else{d[b]=[c];var e=256*b+"-"+(256*b+255),g=f(a,e,this.url);h(g,function(a,c){for(var e=!a&&new i(new j(new Uint8Array(c))),f=0;f<d[b].length;f++)d[b][f](a,b,e);delete d[b]})}}},{"../util/ajax":94,"../util/glyphs":101,"../util/mapbox":103,pbf:135}],72:[function(a,b,c){"use strict";b.exports=function(a,b,c){function d(d){k.push(a[d]),l.push(c[d]),m.push(b[d]),n++}function e(a,b,c){var d=j[a];return delete j[a],j[b]=d,l[d][0].pop(),l[d][0]=l[d][0].concat(c[0]),d}function f(a,b,c){var d=i[b];return delete i[b],i[a]=d,l[d][0].shift(),l[d][0]=c[0].concat(l[d][0]),d}function g(a,b,c){var d=c?b[0][b[0].length-1]:b[0][0];return a+":"+d.x+":"+d.y}var h,i={},j={},k=[],l=[],m=[],n=0;for(h=0;h<a.length;h++){var o=c[h],p=b[h];if(p){var q=g(p,o),r=g(p,o,!0);if(q in j&&r in i&&j[q]!==i[r]){var s=f(q,r,o),t=e(q,r,l[s]);delete i[q],delete j[r],j[g(p,l[t],!0)]=t,l[s]=null}else q in j?e(q,r,o):r in i?f(q,r,o):(d(h),i[q]=n-1,j[r]=n-1)}else d(h)}return{features:k,textFeatures:m,geometries:l}}},{}],73:[function(a,b,c){"use strict";function d(a,b,c,d,e,f,g,h,i){this.anchorPoint=a,this.tl=b,this.tr=c,this.bl=d,this.br=e,this.tex=f,this.angle=g,this.minScale=h,this.maxScale=i}function e(a,b,c,e,f,g){var j=b.image.rect,k=1,l=b.left-k,m=l+j.w,n=b.top-k,o=n+j.h,p=new h(l,n),q=new h(m,n),r=new h(m,o),s=new h(l,o),t=f["icon-rotate"]*Math.PI/180;if(g){var u=e[a.segment];t+=Math.atan2(a.y-u.y,a.x-u.x)}if(t){var v=Math.sin(t),w=Math.cos(t),x=[w,-v,v,w];p=p.matMult(x),q=q.matMult(x),s=s.matMult(x),r=r.matMult(x)}return[new d(new h(a.x,a.y),p,q,s,r,b.image.rect,0,i,1/0)]}function f(a,b,c,e,f,j){for(var k=f["text-rotate"]*Math.PI/180,l=f["text-keep-upright"],m=b.positionedGlyphs,n=[],o=0;o<m.length;o++){var p=m[o],q=p.glyph,r=q.rect;if(r){var s,t=(p.x+q.advance/2)*c,u=i;j?(s=[],u=g(s,a,t,e,a.segment,!0),l&&(u=Math.min(u,g(s,a,t,e,a.segment,!1)))):s=[{anchorPoint:new h(a.x,a.y),offset:0,angle:0,maxScale:1/0,minScale:i}];for(var v=p.x+q.left,w=p.y-q.top,x=v+r.w,y=w+r.h,z=new h(v,w),A=new h(x,w),B=new h(v,y),C=new h(x,y),D=0;D<s.length;D++){var E=s[D],F=z,G=A,H=B,I=C,J=E.angle+k;if(J){var K=Math.sin(J),L=Math.cos(J),M=[L,-K,K,L];F=F.matMult(M),G=G.matMult(M),H=H.matMult(M),I=I.matMult(M)}var N=Math.max(E.minScale,u),O=(a.angle+k+E.offset+2*Math.PI)%(2*Math.PI);n.push(new d(E.anchorPoint,F,G,H,I,r,O,N,E.maxScale))}}}return n}function g(a,b,c,d,e,f){var g=!f;0>c&&(f=!f),f&&e++;var j=new h(b.x,b.y),k=d[e],l=1/0;c=Math.abs(c);for(var m=i;;){var n=j.dist(k),o=c/n,p=Math.atan2(k.y-j.y,k.x-j.x);if(f||(p+=Math.PI),g&&(p+=Math.PI),a.push({anchorPoint:j,offset:g?Math.PI:0,minScale:o,maxScale:l,angle:(p+2*Math.PI)%(2*Math.PI)}),m>=o)break;for(j=k;j.equals(k);)if(e+=f?1:-1,k=d[e],!k)return o;var q=k.sub(j)._unit();j=j.sub(q._mult(n)),l=o}return m}var h=a("point-geometry");b.exports={getIconQuads:e,getGlyphQuads:f};var i=.5},{"point-geometry":137}],74:[function(a,b,c){"use strict";function d(a,b){for(var c=[],d=0,f=a.length;f>d;d++){var g=e(a[d].properties,b["icon-image"]);g&&c.indexOf(g)<0&&c.push(g)}return c}var e=a("../util/token");b.exports=d},{"../util/token":105}],75:[function(a,b,c){"use strict";function d(a,b,c){for(var d=[],f=[],h=0,i=a.length;i>h;h++){var j=g(a[h].properties,b["text-field"]);if(j){j=j.toString();var k=b["text-transform"];"uppercase"===k?j=j.toLocaleUpperCase():"lowercase"===k&&(j=j.toLocaleLowerCase());for(var l=0,m=j.length;m>l;l++)f.push(j.charCodeAt(l));d[h]=j}else d[h]=null}return f=e(f,c),{textFeatures:d,codepoints:f}}function e(a,b){var c,d=[];a.sort(f);for(var e=0;e<a.length;e++)a[e]!==c&&(c=a[e],b[c]||d.push(a[e]));return d}function f(a,b){return a-b}var g=a("../util/token");b.exports=d},{"../util/token":105}],76:[function(a,b,c){"use strict";function d(a,b,c,d){this.codePoint=a,this.x=b,this.y=c,this.glyph=d}function e(a,b,c,d,e,f){this.positionedGlyphs=a,this.text=b,this.top=c,this.bottom=d,this.left=e,this.right=f}function f(a,b,c,f,h,i,j,k,l){for(var m=[],n=new e(m,a,l[1],l[1],l[0],l[0]),o=-17,p=l[0],q=l[1]+o,r=0;r<a.length;r++){var s=a.charCodeAt(r),t=b[s];t&&(m.push(new d(s,p,q,t)),p+=t.advance+k)}return!!m.length&&(g(n,b,f,c,h,i,j),n)}function g(a,b,c,d,e,f,g){var j=null,k=0,m=0,n=0,o=0,p=a.positionedGlyphs;if(d)for(var q=0;q<p.length;q++){var r=p[q];if(r.x-=k,r.y+=c*n,r.x>d&&null!==j){var s=p[j+1].x;o=Math.max(s,o);for(var t=j+1;q>=t;t++)p[t].y+=c,p[t].x-=s;g&&h(p,b,m,j-1,g),m=j+1,j=null,k+=s,n++}l[r.codePoint]&&(j=q)}var u=p[p.length-1],v=u.x+b[u.codePoint].advance;o=Math.max(o,v);var w=(n+1)*c;h(p,b,m,p.length-1,g),i(p,g,e,f,o,c,n),a.top+=-f*w,a.bottom=a.top+w,a.left+=-e*o,a.right=a.left+o}function h(a,b,c,d,e){for(var f=b[a[d].codePoint].advance,g=(a[d].x+f)*e,h=c;d>=h;h++)a[h].x-=g}function i(a,b,c,d,e,f,g){for(var h=(b-c)*e,i=(-d*(g+1)+.5)*f,j=0;j<a.length;j++)a[j].x+=h,a[j].y+=i}function j(a,b){if(!a||!a.rect)return null;var c=b["icon-offset"][0],d=b["icon-offset"][1],e=c-a.width/2,f=e+a.width,g=d-a.height/2,h=g+a.height;return new k(a,g,h,e,f)}function k(a,b,c,d,e){this.image=a,this.top=b,this.bottom=c,this.left=d,this.right=e}b.exports={shapeText:f,shapeIcon:j};var l={32:!0}},{}],77:[function(a,b,c){"use strict";function d(a,b){this.width=a,this.height=b,this.bin=new g(a,b),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}function e(a,b,c,d,e,f,g,h,i,j,k){var l,m,n=d*b+c,o=h*f+g;if(k)for(o-=f,m=-1;j>=m;m++,n=((m+j)%j+d)*b+c,o+=f)for(l=-1;i>=l;l++)e[o+l]=a[n+(l+i)%i];else for(m=0;j>m;m++,n+=b,o+=f)for(l=0;i>l;l++)e[o+l]=a[n+l]}function f(a,b,c,d){this.rect=a,this.width=b,this.height=c,this.sdf=d}var g=a("./bin_pack");b.exports=d,d.prototype={get debug(){return"canvas"in this},set debug(a){a&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.canvas.style.width=this.width+"px",this.canvas.style.width=this.width+"px",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!a&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},d.prototype.resize=function(a){if(this.pixelRatio===a)return!1;var b=this.pixelRatio;if(this.pixelRatio=a,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio),this.data){var c=this.data;this.data=!1,this.allocate(),this.texture=!1;for(var d=this.width*b,e=this.height*b,f=this.width*a,g=this.height*a,h=this.data,i=c,j=0;g>j;j++)for(var k=Math.floor(j*e/g)*d,l=j*f,m=0;f>m;m++){var n=Math.floor(m*d/f);h[l+m]=i[k+n]}c=null,this.dirty=!0}return this.dirty},d.prototype.allocateImage=function(a,b){var c=2,d=a+c+(4-(a+c)%4),e=b+c+(4-(b+c)%4),f=this.bin.allocate(d,e);return 0===f.w?f:(f.originalWidth=a,f.originalHeight=b,f)},d.prototype.getImage=function(a,b){if(this.images[a])return this.images[a];if(!this.sprite)return null;var c=this.sprite.getSpritePosition(a);if(!c.width||!c.height)return null;var d=c.width/c.pixelRatio,e=c.height/c.pixelRatio,g=this.allocateImage(d,e);if(0===g.w)return g;var h=new f(g,d,e,c.sdf);return this.images[a]=h,this.copy(g,c,b),h},d.prototype.getPosition=function(a,b){var c=this.getImage(a,b),d=c&&c.rect;if(!d)return null;var e=b?c.width:d.w,f=b?c.height:d.h,g=1;return{size:[e,f],tl:[(d.x+g)/this.width,(d.y+g)/this.height],br:[(d.x+g+e)/this.width,(d.y+g+f)/this.height]}},d.prototype.allocate=function(){if(!this.data){var a=Math.floor(this.width*this.pixelRatio),b=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(a*b);for(var c=0;c<this.data.length;c++)this.data[c]=0}},d.prototype.copy=function(a,b,c){if(this.sprite.img.data){var d=new Uint32Array(this.sprite.img.data.buffer);this.allocate();var f=this.data,g=1;e(d,this.sprite.img.width,b.x,b.y,f,this.width*this.pixelRatio,(a.x+g)*this.pixelRatio,(a.y+g)*this.pixelRatio,b.width,b.height,c),this.dirty=!0}},d.prototype.setSprite=function(a){this.sprite=a},d.prototype.addIcons=function(a,b){for(var c=0;c<a.length;c++)this.getImage(a[c]);b(null,this.images)},d.prototype.bind=function(a,b){var c=!1;this.texture?a.bindTexture(a.TEXTURE_2D,this.texture):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),c=!0);var d=b?a.LINEAR:a.NEAREST;if(d!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d),this.filter=d),this.dirty&&(this.allocate(),c?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1,this.ctx)){var e=this.ctx.getImageData(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio);e.data.set(new Uint8ClampedArray(this.data.buffer)),this.ctx.putImageData(e,0,0),this.ctx.strokeStyle="red";for(var f=0;f<this.bin.free.length;f++){var g=this.bin.free[f];this.ctx.strokeRect(g.x*this.pixelRatio,g.y*this.pixelRatio,g.w*this.pixelRatio,g.h*this.pixelRatio)}}}},{"./bin_pack":63}],78:[function(a,b,c){"use strict";var d=a("../util/util"),e=a("../util/interpolate"),f=a("../util/browser"),g=a("../geo/lng_lat"),h=a("../geo/lng_lat_bounds"),i=a("point-geometry"),j=b.exports=function(){};d.extend(j.prototype,{getCenter:function(){return this.transform.center},setCenter:function(a){return this.jumpTo({center:a}),this},panBy:function(a,b){return this.panTo(this.transform.center,d.extend({offset:i.convert(a).mult(-1)},b)),this},panTo:function(a,b){this.stop(),a=g.convert(a),b=d.extend({duration:500,easing:d.ease,offset:[0,0]},b);var c=this.transform,e=i.convert(b.offset).rotate(-c.angle),f=c.point,h=c.project(a).sub(e);return b.noMoveStart||this.fire("movestart"),this._ease(function(a){c.center=c.unproject(f.add(h.sub(f).mult(a))),this.fire("move")},function(){this.fire("moveend")},b),this},getZoom:function(){return this.transform.zoom},setZoom:function(a){return this.jumpTo({zoom:a}),this},zoomTo:function(a,b){this.stop(),b=d.extend({duration:500},b),b.easing=this._updateEasing(b.duration,a,b.easing);var c=this.transform,f=c.center,h=c.zoom;return b.around?f=g.convert(b.around):b.offset&&(f=c.pointLocation(c.centerPoint.add(i.convert(b.offset)))),b.animate===!1&&(b.duration=0),this.zooming||(this.zooming=!0,this.fire("movestart")),this._ease(function(b){c.setZoomAround(e(h,a,b),f),this.fire("move").fire("zoom")},function(){this.ease=null,b.duration>=200&&(this.zooming=!1,this.fire("moveend"))},b),b.duration<200&&(clearTimeout(this._onZoomEnd),this._onZoomEnd=setTimeout(function(){this.zooming=!1,this.fire("moveend")}.bind(this),200)),this},zoomIn:function(a){return this.zoomTo(this.getZoom()+1,a),this},zoomOut:function(a){return this.zoomTo(this.getZoom()-1,a),this},getBearing:function(){return this.transform.bearing},setBearing:function(a){return this.jumpTo({bearing:a}),this},rotateTo:function(a,b){this.stop(),b=d.extend({duration:500,easing:d.ease},b);var c=this.transform,f=this.getBearing(),h=c.center;return b.around?h=g.convert(b.around):b.offset&&(h=c.pointLocation(c.centerPoint.add(i.convert(b.offset)))),a=this._normalizeBearing(a,f),this.rotating=!0,this.fire("movestart"),this._ease(function(b){c.setBearingAround(e(f,a,b),h),this.fire("move").fire("rotate")},function(){this.rotating=!1,this.fire("moveend")},b),this},resetNorth:function(a){return this.rotateTo(0,d.extend({duration:1e3},a)),this},snapToNorth:function(a){return Math.abs(this.getBearing())<this.options.bearingSnap?this.resetNorth(a):this},getPitch:function(){return this.transform.pitch},setPitch:function(a){return this.jumpTo({pitch:a}),this},fitBounds:function(a,b){b=d.extend({padding:0,offset:[0,0],maxZoom:1/0},b),a=h.convert(a);var c=i.convert(b.offset),e=this.transform,f=e.project(a.getNorthWest()),g=e.project(a.getSouthEast()),j=g.sub(f),k=(e.width-2*b.padding-2*Math.abs(c.x))/j.x,l=(e.height-2*b.padding-2*Math.abs(c.y))/j.y;return b.center=e.unproject(f.add(g).div(2)),b.zoom=Math.min(e.scaleZoom(e.scale*Math.min(k,l)),b.maxZoom),b.bearing=0,b.linear?this.easeTo(b):this.flyTo(b)},jumpTo:function(a){this.stop();var b=this.transform,c=!1,d=!1,e=!1;return"center"in a&&(b.center=g.convert(a.center)),"zoom"in a&&b.zoom!==+a.zoom&&(c=!0,b.zoom=+a.zoom),"bearing"in a&&b.bearing!==+a.bearing&&(d=!0,b.bearing=+a.bearing),"pitch"in a&&b.pitch!==+a.pitch&&(e=!0,b.pitch=+a.pitch),this.fire("movestart").fire("move"),c&&this.fire("zoom"),d&&this.fire("rotate"),e&&this.fire("pitch"),this.fire("moveend")},easeTo:function(a){this.stop(),a=d.extend({offset:[0,0],duration:500,easing:d.ease},a);var b=this.transform,c=i.convert(a.offset).rotate(-b.angle),f=b.point,h=this.getZoom(),j=this.getBearing(),k=this.getPitch(),l="zoom"in a?+a.zoom:h,m="bearing"in a?this._normalizeBearing(a.bearing,j):j,n="pitch"in a?+a.pitch:k,o=b.zoomScale(l-h),p="center"in a?b.project(g.convert(a.center)).sub(c.div(o)):f,q=g.convert(a.around);return l!==h&&(this.zooming=!0),j!==m&&(this.rotating=!0),this.zooming&&!q&&(q=b.pointLocation(b.centerPoint.add(p.sub(f).div(1-1/o)))),this.fire("movestart"),this._ease(function(a){this.zooming?b.setZoomAround(e(h,l,a),q):b.center=b.unproject(f.add(p.sub(f).mult(a))),this.rotating&&(b.bearing=e(j,m,a)),n!==k&&(b.pitch=e(k,n,a)),this.fire("move"),this.zooming&&this.fire("zoom"),this.rotating&&this.fire("rotate")},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},a),this},flyTo:function(a){function b(a){var b=(x*x-w*w+(a?-1:1)*z*z*y*y)/(2*(a?x:w)*z*y);return Math.log(Math.sqrt(b*b+1)-b)}function c(a){return(Math.exp(a)-Math.exp(-a))/2}function f(a){return(Math.exp(a)+Math.exp(-a))/2}function h(a){return c(a)/f(a)}this.stop(),a=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},a);var j=this.transform,k=i.convert(a.offset),l=this.getZoom(),m=this.getBearing(),n="center"in a?g.convert(a.center):this.getCenter(),o="zoom"in a?+a.zoom:l,p="bearing"in a?this._normalizeBearing(a.bearing,m):m,q=j.zoomScale(o-l),r=j.point,s=j.project(n).sub(k.div(q)),t=j.worldSize,u=a.curve,v=a.speed,w=Math.max(j.width,j.height),x=w/q,y=s.sub(r).mag(),z=u*u,A=b(0),B=function(a){return f(A)/f(A+u*a)},C=function(a){return w*((f(A)*h(A+u*a)-c(A))/z)/y},D=(b(1)-A)/u;if(Math.abs(y)<1e-6){if(Math.abs(w-x)<1e-6)return this;var E=w>x?-1:1;D=Math.abs(Math.log(x/w))/u,C=function(){return 0},B=function(a){return Math.exp(E*u*a)}}return a.duration=1e3*D/v,this.zooming=!0,m!==p&&(this.rotating=!0),this.fire("movestart"),this._ease(function(a){var b=a*D,c=C(b);j.zoom=l+j.scaleZoom(1/B(b)),j.center=j.unproject(r.add(s.sub(r).mult(c)),t),p!==m&&(j.bearing=e(m,p,a)),this.fire("move").fire("zoom"),p!==m&&this.fire("rotate")},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},a),this},isEasing:function(){return!!this._abortFn},stop:function(){return this._abortFn&&(this._abortFn.call(this),this._finishEase()),this},_ease:function(a,b,c){this._finishFn=b,this._abortFn=f.timed(function(b){a.call(this,c.easing(b)),1===b&&this._finishEase()},c.animate===!1?0:c.duration,this)},_finishEase:function(){delete this._abortFn;var a=this._finishFn;delete this._finishFn,a.call(this)},_normalizeBearing:function(a,b){a=d.wrap(a,-180,180);var c=Math.abs(a-b);return Math.abs(a-360-b)<c&&(a-=360),Math.abs(a+360-b)<c&&(a+=360),a},_updateEasing:function(a,b,c){var e;if(this.ease){var f=this.ease,g=(Date.now()-f.start)/f.duration,h=f.easing(g+.01)-f.easing(g),i=.27/Math.sqrt(h*h+1e-4)*.01,j=Math.sqrt(.0729-i*i);e=d.bezier(i,j,.25,1)}else e=c?d.bezier.apply(d,c):d.ease;return this.ease={start:(new Date).getTime(),to:Math.pow(2,b),duration:a,easing:e},e}})},{"../geo/lng_lat":20,"../geo/lng_lat_bounds":21,"../util/browser":95,"../util/interpolate":102,"../util/util":106,"point-geometry":137}],79:[function(a,b,c){"use strict";function d(){}var e=a("./control"),f=a("../../util/dom"),g=a("../../util/util");b.exports=d,d.prototype=g.inherit(e,{options:{position:"bottom-right"},onAdd:function(a){var b="mapboxgl-ctrl-attrib",c=this._container=f.create("div",b,a.getContainer());return this._update(),a.on("source.load",this._update.bind(this)),a.on("source.change",this._update.bind(this)),a.on("source.remove",this._update.bind(this)),a.on("moveend",this._updateEditLink.bind(this)),c},_update:function(){var a=[];if(this._map.style)for(var b in this._map.style.sources){var c=this._map.style.sources[b];c.attribution&&a.indexOf(c.attribution)<0&&a.push(c.attribution)}this._container.innerHTML=a.join(" | "),this._editLink=this._container.getElementsByClassName("mapbox-improve-map")[0],this._updateEditLink()},_updateEditLink:function(){if(this._editLink){var a=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+a.lng+"/"+a.lat+"/"+Math.round(this._map.getZoom()+1)}}})},{"../../util/dom":98,"../../util/util":106,"./control":80}],80:[function(a,b,c){"use strict";function d(){}b.exports=d,d.prototype={addTo:function(a){this._map=a;var b=this._container=this.onAdd(a);if(this.options&&this.options.position){var c=this.options.position,d=a._controlCorners[c];b.className+=" mapboxgl-ctrl",-1!==c.indexOf("bottom")?d.insertBefore(b,d.firstChild):d.appendChild(b)}return this},remove:function(){return this._container.parentNode.removeChild(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this}}},{}],81:[function(a,b,c){"use strict";function d(a){g.setOptions(this,a)}var e=a("./control"),f=a("../../util/dom"),g=a("../../util/util");b.exports=d,d.prototype=g.inherit(e,{options:{position:"top-right"},onAdd:function(a){var b="mapboxgl-ctrl",c=this._container=f.create("div",b+"-group",a.getContainer());this._zoomInButton=this._createButton(b+"-icon "+b+"-zoom-in",a.zoomIn.bind(a)),this._zoomOutButton=this._createButton(b+"-icon "+b+"-zoom-out",a.zoomOut.bind(a)),this._compass=this._createButton(b+"-compass",a.resetNorth.bind(a));var d=this._compassCanvas=f.create("canvas",b+"-compass-canvas",this._compass);return d.style.cssText="width:30px; height:30px;",d.width=52,d.height=52,this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._compassCtx=d.getContext("2d"),a.on("rotate",this._drawNorth.bind(this)),this._drawNorth(),c},_onCompassDown:function(a){f.disableDrag(),document.addEventListener("mousemove",this._onCompassMove),document.addEventListener("mouseup",this._onCompassUp),this._prevX=a.screenX,a.stopPropagation()},_onCompassMove:function(a){var b=a.screenX,c=2>b?-5:b>window.screen.width-2?5:(b-this._prevX)/4;this._map.setBearing(this._map.getBearing()-c),this._prevX=a.screenX,this._moved=!0,a.preventDefault()},_onCompassUp:function(){document.removeEventListener("mousemove",this._onCompassMove),document.removeEventListener("mouseup",this._onCompassUp),f.enableDrag(),this._moved&&(this._moved=!1,f.suppressClick()),this._map.snapToNorth()},_createButton:function(a,b){var c=f.create("button",a,this._container);return c.addEventListener("click",function(){b()}),c},_drawNorth:function(){var a=20,b=8,c=26,d=this._map.transform.angle+Math.PI/2,e=this._compassCtx;this._compassCanvas.width=this._compassCanvas.width,e.translate(c,c),e.rotate(d),e.beginPath(),e.fillStyle="#000",e.lineTo(0,-b),e.lineTo(-a,0),e.lineTo(0,b),e.fill(),e.beginPath(),e.fillStyle="#bbb",e.moveTo(0,0),e.lineTo(0,b),e.lineTo(a,0),e.lineTo(0,-b),e.fill(),e.beginPath(),e.strokeStyle="#fff",e.lineWidth=4,e.moveTo(0,-b),e.lineTo(0,b),e.stroke()}})},{"../../util/dom":98,"../../util/util":106,"./control":80}],82:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),g.bindHandlers(this)}var e=a("../../util/dom"),f=a("../../geo/lng_lat_bounds"),g=a("../../util/util");b.exports=d,d.prototype={enable:function(){this._el.addEventListener("mousedown",this._onMouseDown,!1)},disable:function(){this._el.removeEventListener("mousedown",this._onMouseDown)},_onMouseDown:function(a){(a.shiftKey||1===a.which&&1===a.button)&&(document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("mouseup",this._onMouseUp,!1),this._startPos=e.mousePos(this._el,a),this.active=!0)},_onMouseMove:function(a){var b=this._startPos,c=e.mousePos(this._el,a);this._box||(this._box=e.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),e.disableDrag(),this._map.fire("boxzoomstart"));var d=Math.min(b.x,c.x),f=Math.max(b.x,c.x),g=Math.min(b.y,c.y),h=Math.max(b.y,c.y);e.setTransform(this._box,"translate("+d+"px,"+g+"px)"),this._box.style.width=f-d+"px",this._box.style.height=h-g+"px"},_onMouseUp:function(a){var b=this._startPos,c=e.mousePos(this._el,a),d=new f(this._map.unproject(b),this._map.unproject(c));this._finish(),this._map.fitBounds(d,{linear:!0}).fire("boxzoomend",{boxZoomBounds:d})},_onKeyDown:function(a){27===a.keyCode&&(this._finish(),this._map.fire("boxzoomcancel"))},_finish:function(){this._box&&(this.active=!1,document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box.parentNode.removeChild(this._box),this._box=null,e.enableDrag())}}},{"../../geo/lng_lat_bounds":21,"../../util/dom":98,"../../util/util":106}],83:[function(a,b,c){"use strict";function d(a){this._map=a,this._onDblClick=this._onDblClick.bind(this)}b.exports=d,d.prototype={enable:function(){this._map.on("dblclick",this._onDblClick)},disable:function(){this._map.off("dblclick",this._onDblClick)},_onDblClick:function(a){this._map.zoomTo(Math.round(this._map.getZoom())+1,{around:a.lngLat})}}},{}],84:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),f.bindHandlers(this)}var e=a("../../util/dom"),f=a("../../util/util");b.exports=d;var g=.25,h=f.bezier(0,0,g,1),i=3e3,j=4e3;d.prototype={enable:function(){this._el.addEventListener("mousedown",this._onDown,!1),this._el.addEventListener("touchstart",this._onDown,!1)},disable:function(){this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown)},_onDown:function(a){this._startPos=this._pos=e.mousePos(this._el,a),this._inertia=[[Date.now(),this._pos]],a.touches?1===a.touches.length&&(document.addEventListener("touchmove",this._onMove,!1),document.addEventListener("touchend",this._onTouchEnd,!1)):(document.addEventListener("mousemove",this._onMove,!1),document.addEventListener("mouseup",this._onMouseUp,!1))},_onMove:function(a){var b=this._map;if(!(b.boxZoom.active||b.dragRotate.active||a.touches&&a.touches.length>1)){var c=e.mousePos(this._el,a),d=this._inertia,f=Date.now();for(d.push([f,c]);d.length>2&&f-d[0][0]>50;)d.shift();b.stop(),b.transform.setLocationAtPoint(b.transform.pointLocation(this._pos),c),b.fire("move"),this._pos=c,a.preventDefault()}},_onUp:function(){var a=this._inertia;if(a.length<2)return void this._map.fire("moveend");var b=a[a.length-1],c=a[0],d=b[1].sub(c[1]),e=(b[0]-c[0])/1e3,f=d.mult(g/e),k=f.mag();k>i&&(k=i,f._unit()._mult(k));var l=k/(j*g),m=f.mult(-l/2);this._map.panBy(m,{duration:1e3*l,easing:h,noMoveStart:!0})},_onMouseUp:function(){this._onUp(),document.removeEventListener("mousemove",this._onMove,!1),document.removeEventListener("mouseup",this._onMouseUp,!1)},_onTouchEnd:function(){this._onUp(),document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)}}},{"../../util/dom":98,"../../util/util":106}],85:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),g.bindHandlers(this)}var e=a("../../util/dom"),f=a("point-geometry"),g=a("../../util/util");b.exports=d,d.prototype={enable:function(){this._el.addEventListener("contextmenu",this._onContextMenu,!1)},disable:function(){this._el.removeEventListener("contextmenu",this._onContextMenu)},_onContextMenu:function(a){this._map.stop(),this.active=!0,this._startPos=this._pos=e.mousePos(this._el,a),document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("mouseup",this._onMouseUp,!1),a.preventDefault()},_onMouseMove:function(a){var b=this._startPos,c=this._pos,d=e.mousePos(this._el,a),g=this._map,h=g.transform.centerPoint,i=b.sub(h),j=i.mag();g.rotating||(g.fire("movestart"),g.rotating=!0),200>j&&(h=b.add(new f((-200),0)._rotate(i.angle())));var k=c.sub(h).angleWith(d.sub(h))/Math.PI*180;g.transform.bearing=g.getBearing()-k,g.fire("move").fire("rotate"),clearTimeout(this._timeout),this._timeout=setTimeout(this._onTimeout,200),this._pos=d},_onTimeout:function(){var a=this._map;a.rotating=!1,a.snapToNorth(),a.rotating||(a._rerender(),a.fire("moveend"))},_onMouseUp:function(){this.active=!1,document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("mouseup",this._onMouseUp,!1)}}},{"../../util/dom":98,"../../util/util":106,"point-geometry":137}],86:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)}b.exports=d;var e=80,f=2;d.prototype={enable:function(){this._el.addEventListener("keydown",this._onKeyDown,!1)},disable:function(){this._el.removeEventListener("keydown",this._onKeyDown)},_onKeyDown:function(a){if(!(a.altKey||a.ctrlKey||a.metaKey)){var b=this._map;switch(a.keyCode){case 61:case 107:case 171:case 187:b.zoomTo(Math.round(b.getZoom())+(a.shiftKey?2:1));break;case 189:case 109:case 173:b.zoomTo(Math.round(b.getZoom())-(a.shiftKey?2:1));break;case 37:a.shiftKey?b.setBearing(b.getBearing()-f):b.panBy([-e,0]);break;case 39:a.shiftKey?b.setBearing(b.getBearing()+f):b.panBy([e,0]);break;case 38:b.panBy([0,-e]);break;case 40:b.panBy([0,e])}}}}},{}],87:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),f.bindHandlers(this)}var e=a("../../util/dom"),f=a("../../util/util");b.exports=d,d.prototype={enable:function(){this._el.addEventListener("touchstart",this._onStart,!1)},disable:function(){this._el.removeEventListener("touchstart",this._onStart)},_onStart:function(a){if(2===a.touches.length){var b=e.mousePos(this._el,a.touches[0]),c=e.mousePos(this._el,a.touches[1]);this._startVec=b.sub(c),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,document.addEventListener("touchmove",this._onMove,!1),document.addEventListener("touchend",this._onEnd,!1)}},_onMove:function(a){if(2===a.touches.length){var b=e.mousePos(this._el,a.touches[0]),c=e.mousePos(this._el,a.touches[1]),d=b.add(c).div(2),f=b.sub(c),g=f.mag()/this._startVec.mag(),h=180*f.angleWith(this._startVec)/Math.PI,i=this._map;i.easeTo({zoom:i.transform.scaleZoom(this._startScale*g),bearing:this._startBearing+h,duration:0,around:i.unproject(d)
}),a.preventDefault()}},_onEnd:function(){this._map.snapToNorth(),document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onEnd)}}},{"../../util/dom":98,"../../util/util":106}],88:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer(),g.bindHandlers(this)}var e=a("../../util/dom"),f=a("../../util/browser"),g=a("../../util/util");b.exports=d;var h="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",i=-1!==h.indexOf("firefox"),j=-1!==h.indexOf("safari")&&-1===h.indexOf("chrom");d.prototype={enable:function(){this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1)},disable:function(){this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel)},_onWheel:function(a){var b;"wheel"===a.type?(b=a.deltaY,i&&a.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL&&(b/=f.devicePixelRatio),a.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(b*=40)):"mousewheel"===a.type&&(b=-a.wheelDeltaY,j&&(b/=3));var c=(window.performance||Date).now(),d=c-(this._time||0);this._pos=e.mousePos(this._el,a),this._time=c,0!==b&&b%4.000244140625===0?(this._type="wheel",b=Math.floor(b/4)):0!==b&&Math.abs(b)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(d*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),a.shiftKey&&b&&(b/=4),this._type&&this._zoom(-b),a.preventDefault()},_onTimeout:function(){this._type="wheel",this._zoom(-this._lastValue)},_zoom:function(a){var b=this._map,c=2/(1+Math.exp(-Math.abs(a/100)));0>a&&0!==c&&(c=1/c);var d=b.ease?b.ease.to:b.transform.scale,e=b.transform.scaleZoom(d*c);b.zoomTo(e,{duration:0,around:b.unproject(this._pos)})}}},{"../../util/browser":95,"../../util/dom":98,"../../util/util":106}],89:[function(a,b,c){"use strict";function d(){e.bindAll(["_onHashChange","_updateHash"],this)}b.exports=d;var e=a("../util/util");d.prototype={addTo:function(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},remove:function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},_onHashChange:function(){var a=location.hash.replace("#","").split("/");return a.length>=3&&(this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:+(a[3]||0)}),!0)},_updateHash:function(){var a=this._map.getCenter(),b=this._map.getZoom(),c=this._map.getBearing(),d=Math.max(0,Math.ceil(Math.log(b)/Math.LN2)),e="#"+Math.round(100*b)/100+"/"+a.lat.toFixed(d)+"/"+a.lng.toFixed(d)+(c?"/"+Math.round(10*c)/10:"");window.history.replaceState("","",e)}}},{"../util/util":106}],90:[function(a,b,c){"use strict";function d(a){this._map=a,this._el=a.getCanvasContainer();for(var b in e)a[b]=new e[b](a);g.bindHandlers(this)}var e={scrollZoom:a("./handler/scroll_zoom"),boxZoom:a("./handler/box_zoom"),dragRotate:a("./handler/drag_rotate"),dragPan:a("./handler/drag_pan"),keyboard:a("./handler/keyboard"),doubleClickZoom:a("./handler/dblclick_zoom"),pinch:a("./handler/pinch")},f=a("../util/dom"),g=a("../util/util");b.exports=d,d.prototype={enable:function(){var a=this._map.options,b=this._el;for(var c in e)a[c]&&this._map[c].enable();b.addEventListener("mousedown",this._onMouseDown,!1),b.addEventListener("touchstart",this._onTouchStart,!1),b.addEventListener("click",this._onClick,!1),b.addEventListener("mousemove",this._onMouseMove,!1),b.addEventListener("dblclick",this._onDblClick,!1)},disable:function(){var a=this._map.options,b=this._el;for(var c in e)a[c]&&this._map[c].disable();b.removeEventListener("mousedown",this._onMouseDown),b.removeEventListener("touchstart",this._onTouchStart),b.removeEventListener("click",this._onClick),b.removeEventListener("mousemove",this._onMouseMove),b.removeEventListener("dblclick",this._onDblClick)},_onMouseDown:function(a){this._startPos=f.mousePos(this._el,a)},_onTouchStart:function(a){!a.touches||a.touches.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._fireEvent("dblclick",a)):this._tapped=setTimeout(this._onTimeout,300))},_onTimeout:function(){this._tapped=null},_onMouseMove:function(a){var b=this._map,c=this._el;if(!b.dragPan.active&&!b.dragRotate.active){for(var d=a.toElement||a.target;d&&d!==c;)d=d.parentNode;d===c&&this._fireEvent("mousemove",a)}},_onClick:function(a){var b=f.mousePos(this._el,a);b.equals(this._startPos)&&this._fireEvent("click",a)},_onDblClick:function(a){this._fireEvent("dblclick",a),a.preventDefault()},_fireEvent:function(a,b){var c=f.mousePos(this._el,b);this._map.fire(a,{lngLat:this._map.unproject(c),point:c,originalEvent:b})}}},{"../util/dom":98,"../util/util":106,"./handler/box_zoom":82,"./handler/dblclick_zoom":83,"./handler/drag_pan":84,"./handler/drag_rotate":85,"./handler/keyboard":86,"./handler/pinch":87,"./handler/scroll_zoom":88}],91:[function(a,b,c){"use strict";var d=a("../util/canvas"),e=a("../util/util"),f=a("../util/browser"),g=a("../util/evented"),h=a("../util/dom"),i=a("../style/style"),j=a("../style/animation_loop"),k=a("../render/painter"),l=a("../geo/transform"),m=a("./hash"),n=a("./interaction"),o=a("./camera"),p=a("../geo/lng_lat"),q=a("../geo/lng_lat_bounds"),r=a("point-geometry"),s=a("./control/attribution"),t=b.exports=function(a){if(a=this.options=e.inherit(this.options,a),this.animationLoop=new j,this.transform=new l(a.minZoom,a.maxZoom),a.maxBounds){var b=q.convert(a.maxBounds);this.transform.lngRange=[b.getWest(),b.getEast()],this.transform.latRange=[b.getSouth(),b.getNorth()]}e.bindAll(["_forwardStyleEvent","_forwardSourceEvent","_forwardLayerEvent","_forwardTileEvent","_onStyleLoad","_onStyleChange","_onSourceAdd","_onSourceRemove","_onSourceUpdate","_onWindowResize","onError","update","render"],this),this._setupContainer(),this._setupPainter(),this.on("move",this.update),this.on("zoom",this.update.bind(this,!0)),this.on("moveend",function(){this.animationLoop.set(300),this._rerender()}.bind(this)),"undefined"!=typeof window&&window.addEventListener("resize",this._onWindowResize,!1),this.interaction=new n(this),a.interactive&&this.interaction.enable(),this._hash=a.hash&&(new m).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo(a),this.sources={},this.stacks={},this._classes={},this.resize(),a.classes&&this.setClasses(a.classes),a.style&&this.setStyle(a.style),a.attributionControl&&this.addControl(new s),this.on("style.error",this.onError),this.on("source.error",this.onError),this.on("tile.error",this.onError)};e.extend(t.prototype,g),e.extend(t.prototype,o.prototype),e.extend(t.prototype,{options:{center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:20,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,pinch:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1},addControl:function(a){return a.addTo(this),this},addClass:function(a,b){this._classes[a]||(this._classes[a]=!0,this.style&&this.style._cascade(this._classes,b))},removeClass:function(a,b){this._classes[a]&&(delete this._classes[a],this.style&&this.style._cascade(this._classes,b))},setClasses:function(a,b){this._classes={};for(var c=0;c<a.length;c++)this._classes[a[c]]=!0;this.style&&this.style._cascade(this._classes,b)},hasClass:function(a){return!!this._classes[a]},getClasses:function(){return Object.keys(this._classes)},resize:function(){var a=0,b=0;return this._container&&(a=this._container.offsetWidth||400,b=this._container.offsetHeight||300),this._canvas.resize(a,b),this.transform.width=a,this.transform.height=b,this.transform._constrain(),this.painter.resize(a,b),this.fire("movestart").fire("move").fire("resize").fire("moveend")},getBounds:function(){return new q(this.transform.pointLocation(new r(0,0)),this.transform.pointLocation(this.transform.size))},project:function(a){return this.transform.locationPoint(p.convert(a))},unproject:function(a){return this.transform.pointLocation(r.convert(a))},featuresAt:function(a,b,c){var d=this.unproject(a).wrap(),e=this.transform.locationCoordinate(d);return this.style.featuresAt(e,b,c),this},featuresIn:function(a,b,c){return"undefined"==typeof c&&(c=b,b=a,a=[r.convert([0,0]),r.convert([this.transform.width,this.transform.height])]),a=a.map(r.convert.bind(r)),a=[new r(Math.min(a[0].x,a[1].x),Math.min(a[0].y,a[1].y)),new r(Math.max(a[0].x,a[1].x),Math.max(a[0].y,a[1].y))].map(this.transform.pointCoordinate.bind(this.transform)),this.style.featuresIn(a,b,c),this},batch:function(a){this.style.batch(a),this.style._cascade(this._classes),this.update(!0)},setStyle:function(a){return this.style&&(this.style.off("load",this._onStyleLoad).off("error",this._forwardStyleEvent).off("change",this._onStyleChange).off("source.add",this._onSourceAdd).off("source.remove",this._onSourceRemove).off("source.load",this._onSourceUpdate).off("source.error",this._forwardSourceEvent).off("source.change",this._onSourceUpdate).off("layer.add",this._forwardLayerEvent).off("layer.remove",this._forwardLayerEvent).off("tile.add",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent).off("tile.load",this.update).off("tile.error",this._forwardTileEvent)._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),a?(a instanceof i?this.style=a:this.style=new i(a,this.animationLoop),this.style.on("load",this._onStyleLoad).on("error",this._forwardStyleEvent).on("change",this._onStyleChange).on("source.add",this._onSourceAdd).on("source.remove",this._onSourceRemove).on("source.load",this._onSourceUpdate).on("source.error",this._forwardSourceEvent).on("source.change",this._onSourceUpdate).on("layer.add",this._forwardLayerEvent).on("layer.remove",this._forwardLayerEvent).on("tile.add",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent).on("tile.load",this.update).on("tile.error",this._forwardTileEvent),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},addSource:function(a,b){return this.style.addSource(a,b),this},removeSource:function(a){return this.style.removeSource(a),this},getSource:function(a){return this.style.getSource(a)},addLayer:function(a,b){return this.style.addLayer(a,b),this.style._cascade(this._classes),this},removeLayer:function(a){return this.style.removeLayer(a),this.style._cascade(this._classes),this},setFilter:function(a,b){return this.style.setFilter(a,b),this},setLayerZoomRange:function(a,b,c){return this.style.setLayerZoomRange(a,b,c),this},getFilter:function(a){return this.style.getFilter(a)},setPaintProperty:function(a,b,c,d){return this.batch(function(e){e.setPaintProperty(a,b,c,d)}),this},getPaintProperty:function(a,b,c){return this.style.getPaintProperty(a,b,c)},setLayoutProperty:function(a,b,c){return this.batch(function(d){d.setLayoutProperty(a,b,c)}),this},getLayoutProperty:function(a,b){return this.style.getLayoutProperty(a,b)},getContainer:function(){return this._container},getCanvasContainer:function(){return this._canvasContainer},getCanvas:function(){return this._canvas.getElement()},_setupContainer:function(){var a=this.options.container,b=this._container="string"==typeof a?document.getElementById(a):a;b.classList.add("mapboxgl-map");var c=this._canvasContainer=h.create("div","mapboxgl-canvas-container",b);this.options.interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=new d(this,c);var e=h.create("div","mapboxgl-control-container",b),f=this._controlCorners={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(a){f[a]=h.create("div","mapboxgl-ctrl-"+a,e)})},_setupPainter:function(){var a=this._canvas.getWebGLContext({failIfMajorPerformanceCaveat:this.options.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.options.preserveDrawingBuffer});return a?void(this.painter=new k(a,this.transform)):void console.error("Failed to initialize WebGL")},_contextLost:function(a){a.preventDefault(),this._frameId&&f.cancelFrame(this._frameId)},_contextRestored:function(){this._setupPainter(),this.resize(),this.update()},loaded:function(){return!this._styleDirty&&!this._sourcesDirty&&!(this.style&&!this.style.loaded())},update:function(a){return this.style?(this._styleDirty=this._styleDirty||a,this._sourcesDirty=!0,this._rerender(),this):this},render:function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&!this._sourcesDirtyTimeout&&(this._sourcesDirty=!1,this._sourcesDirtyTimeout=setTimeout(function(){this._sourcesDirtyTimeout=null}.bind(this),50),this.style._updateSources(this.transform)),this.painter.render(this.style,{debug:this.debug,vertices:this.vertices,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||!this.animationLoop.stopped())&&this._rerender(),this},remove:function(){return this._hash&&this._hash.remove(),f.cancelFrame(this._frameId),clearTimeout(this._sourcesDirtyTimeout),this.setStyle(null),"undefined"!=typeof window&&window.removeEventListener("resize",this._onWindowResize,!1),this},onError:function(a){console.error(a.error)},_rerender:function(){this.style&&!this._frameId&&(this._frameId=f.frame(this.render))},_forwardStyleEvent:function(a){this.fire("style."+a.type,e.extend({style:a.target},a))},_forwardSourceEvent:function(a){this.fire(a.type,e.extend({style:a.target},a))},_forwardLayerEvent:function(a){this.fire(a.type,e.extend({style:a.target},a))},_forwardTileEvent:function(a){this.fire(a.type,e.extend({style:a.target},a))},_onStyleLoad:function(a){var b=new l,c=this.transform;c.center.lng===b.center.lng&&c.center.lat===b.center.lat&&c.zoom===b.zoom&&c.bearing===b.bearing&&c.pitch===b.pitch&&this.jumpTo(this.style.stylesheet),this.style._cascade(this._classes,{transition:!1}),this._forwardStyleEvent(a)},_onStyleChange:function(a){this.update(!0),this._forwardStyleEvent(a)},_onSourceAdd:function(a){var b=a.source;b.onAdd&&b.onAdd(this),this._forwardSourceEvent(a)},_onSourceRemove:function(a){var b=a.source;b.onRemove&&b.onRemove(this),this._forwardSourceEvent(a)},_onSourceUpdate:function(a){this.update(),this._forwardSourceEvent(a)},_onWindowResize:function(){this.stop().resize().update()}}),e.extendAll(t.prototype,{_debug:!1,get debug(){return this._debug},set debug(a){this._debug=a,this.update()},_collisionDebug:!1,get collisionDebug(){return this._collisionDebug},set collisionDebug(a){this._collisionDebug=a;for(var b in this.style.sources)this.style.sources[b].reload();this.update()},_repaint:!1,get repaint(){return this._repaint},set repaint(a){this._repaint=a,this.update()},_vertices:!1,get vertices(){return this._vertices},set vertices(a){this._vertices=a,this.update()}})},{"../geo/lng_lat":20,"../geo/lng_lat_bounds":21,"../geo/transform":22,"../render/painter":37,"../style/animation_loop":51,"../style/style":56,"../util/browser":95,"../util/canvas":96,"../util/dom":98,"../util/evented":100,"../util/util":106,"./camera":78,"./control/attribution":79,"./hash":89,"./interaction":90,"point-geometry":137}],92:[function(a,b,c){"use strict";function d(a){e.setOptions(this,a),e.bindAll(["_updatePosition","_onClickClose"],this)}b.exports=d;var e=a("../util/util"),f=a("../util/evented"),g=a("../util/dom"),h=a("../geo/lng_lat");d.prototype=e.inherit(f,{options:{closeButton:!0,closeOnClick:!0},addTo:function(a){return this._map=a,this._map.on("move",this._updatePosition),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},remove:function(){return this._container&&this._container.parentNode.removeChild(this._container),this._map&&(this._map.off("move",this._updatePosition),this._map.off("click",this._onClickClose),delete this._map),this},getLngLat:function(){return this._lngLat},setLngLat:function(a){return this._lngLat=h.convert(a),this._update(),this},setText:function(a){return this._content=document.createTextNode(a),this._updateContent(),this},setHTML:function(a){this._content=document.createDocumentFragment();var b,c=document.createElement("body");for(c.innerHTML=a;b=c.firstChild,b;)this._content.appendChild(b);return this._updateContent(),this},_update:function(){this._map&&(this._container||(this._container=g.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=g.create("div","mapboxgl-popup-tip",this._container),this._wrapper=g.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=g.create("button","mapboxgl-popup-close-button",this._wrapper),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))),this._updateContent(),this._updatePosition())},_updateContent:function(){if(this._content&&this._container){for(var a=this._wrapper;a.hasChildNodes();)a.removeChild(a.firstChild);this.options.closeButton&&a.appendChild(this._closeButton),a.appendChild(this._content)}},_updatePosition:function(){if(this._lngLat&&this._container){var a=this._map.project(this._lngLat).round(),b=this.options.anchor;if(!b){var c=this._container.offsetWidth,d=this._container.offsetHeight;b=a.y<d?["top"]:a.y>this._map.transform.height-d?["bottom"]:[],a.x<c/2?b.push("left"):a.x>this._map.transform.width-c/2&&b.push("right"),b=0===b.length?"bottom":b.join("-"),this.options.anchor=b}var e={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},f=this._container.classList;for(var h in e)f.remove("mapboxgl-popup-anchor-"+h);f.add("mapboxgl-popup-anchor-"+b),g.setTransform(this._container,e[b]+" translate("+a.x+"px,"+a.y+"px)")}},_onClickClose:function(){this.remove()}})},{"../geo/lng_lat":20,"../util/dom":98,"../util/evented":100,"../util/util":106}],93:[function(a,b,c){"use strict";function d(a,b){this.target=a,this.parent=b,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)}b.exports=d,d.prototype.receive=function(a){var b,c=a.data;if("<response>"===c.type)b=this.callbacks[c.id],delete this.callbacks[c.id],b(c.error||null,c.data);else if("undefined"!=typeof c.id){var d=c.id;this.parent[c.type](c.data,function(a,b,c){this.postMessage({type:"<response>",id:String(d),error:a?String(a):null,data:b},c)}.bind(this))}else this.parent[c.type](c.data)},d.prototype.send=function(a,b,c,d){var e=null;c&&(this.callbacks[e=this.callbackID++]=c),this.postMessage({type:a,id:String(e),data:b},d)},d.prototype.postMessage=function(a,b){try{this.target.postMessage(a,b)}catch(c){this.target.postMessage(a)}}},{}],94:[function(a,b,c){"use strict";function d(a){var b=document.createElement("a");return b.href=a,b.protocol===document.location.protocol&&b.host===document.location.host}c.getJSON=function(a,b){var c=new XMLHttpRequest;return c.open("GET",a,!0),c.setRequestHeader("Accept","application/json"),c.onerror=function(a){b(a)},c.onload=function(){if(c.status>=200&&c.status<300&&c.response){var a;try{a=JSON.parse(c.response)}catch(d){return b(d)}b(null,a)}else b(new Error(c.statusText))},c.send(),c},c.getArrayBuffer=function(a,b){var c=new XMLHttpRequest;return c.open("GET",a,!0),c.responseType="arraybuffer",c.onerror=function(a){b(a)},c.onload=function(){c.status>=200&&c.status<300&&c.response?b(null,c.response):b(new Error(c.statusText))},c.send(),c},c.getImage=function(a,b){return c.getArrayBuffer(a,function(a,c){a&&b(a);var d=new Image;d.onload=function(){b(null,d),(window.URL||window.webkitURL).revokeObjectURL(d.src)};var e=new Blob([new Uint8Array(c)],{type:"image/png"});return d.src=(window.URL||window.webkitURL).createObjectURL(e),d.getData=function(){var a=document.createElement("canvas"),b=a.getContext("2d");return a.width=d.width,a.height=d.height,b.drawImage(d,0,0),b.getImageData(0,0,d.width,d.height).data},d})},c.getVideo=function(a,b){var c=document.createElement("video");c.onloadstart=function(){b(null,c)};for(var e=0;e<a.length;e++){var f=document.createElement("source");d(a[e])||(c.crossOrigin="Anonymous"),f.src=a[e],c.appendChild(f)}return c.getData=function(){return c},c}},{}],95:[function(a,b,c){"use strict";var d=a("./canvas"),e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;c.frame=function(a){return e(a)};var f=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;c.cancelFrame=function(a){f(a)},c.timed=function(a,b,d){function e(h){f||(window.performance||(h=Date.now()),h>=g+b?a.call(d,1):(a.call(d,(h-g)/b),c.frame(e)))}if(!b)return a.call(d,1),null;var f=!1,g=window.performance?window.performance.now():Date.now();return c.frame(e),function(){f=!0}},c.supported=function(a){for(var b=([function(){return"undefined"!=typeof window},function(){return"undefined"!=typeof document},function(){return!!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)},function(){return!(!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions))},function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},function(){return(new d).supportsWebGLContext(a&&a.failIfMajorPerformanceCaveat||!1)},function(){return"Worker"in window}]),c=0;c<b.length;c++)if(!b[c]())return!1;return!0},c.hardwareConcurrency=navigator.hardwareConcurrency||8,Object.defineProperty(c,"devicePixelRatio",{get:function(){return window.devicePixelRatio}})},{"./canvas":96}],96:[function(a,b,c){"use strict";function d(a,b){this.canvas=document.createElement("canvas"),a&&b&&(this.canvas.style.position="absolute",this.canvas.classList.add("mapboxgl-canvas"),this.canvas.addEventListener("webglcontextlost",a._contextLost.bind(a),!1),this.canvas.addEventListener("webglcontextrestored",a._contextRestored.bind(a),!1),this.canvas.setAttribute("tabindex",0),b.appendChild(this.canvas))}var e=a("../util");b.exports=d,d.prototype.resize=function(a,b){var c=window.devicePixelRatio||1;this.canvas.width=c*a,this.canvas.height=c*b,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px"};var f={antialias:!1,alpha:!0,stencil:!0,depth:!1};d.prototype.getWebGLContext=function(a){return a=e.extend({},a,f),this.canvas.getContext("webgl",a)||this.canvas.getContext("experimental-webgl",a)},d.prototype.supportsWebGLContext=function(a){var b=e.extend({failIfMajorPerformanceCaveat:a},f);return"probablySupportsContext"in this.canvas?this.canvas.probablySupportsContext("webgl",b)||this.canvas.probablySupportsContext("experimental-webgl",b):"supportsContext"in this.canvas?this.canvas.supportsContext("webgl",b)||this.canvas.supportsContext("experimental-webgl",b):!!window.WebGLRenderingContext&&!!this.getWebGLContext(a)},d.prototype.getElement=function(){return this.canvas}},{"../util":106}],97:[function(a,b,c){"use strict";function d(b,c){this.actors=[],this.currentActor=0;for(var d=0;b>d;d++){var g=new f(a("../../source/worker")),h=new e(g,c);h.name="Worker "+d,this.actors.push(h)}}var e=a("../actor"),f=a("webworkify");b.exports=d,d.prototype={broadcast:function(a,b){for(var c=0;c<this.actors.length;c++)this.actors[c].send(a,b)},send:function(a,b,c,d,e){return("number"!=typeof d||isNaN(d))&&(d=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[d].send(a,b,c,e),d},remove:function(){for(var a=0;a<this.actors.length;a++)this.actors[a].target.terminate();this.actors=[]}}},{"../../source/worker":49,"../actor":93,webworkify:145}],98:[function(a,b,c){"use strict";function d(a){for(var b=0;b<a.length;b++)if(a[b]in h)return a[b]}function e(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",e,!0)}var f=a("point-geometry");c.create=function(a,b,c){var d=document.createElement(a);return b&&(d.className=b),c&&c.appendChild(d),d};var g,h=document.documentElement.style,i=d(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){i&&(g=h[i],h[i]="none")},c.enableDrag=function(){i&&(h[i]=g)};var j=d(["transform","WebkitTransform"]);c.setTransform=function(a,b){a.style[j]=b},c.suppressClick=function(){window.addEventListener("click",e,!0),window.setTimeout(function(){window.removeEventListener("click",e,!0)},0)},c.mousePos=function(a,b){var c=a.getBoundingClientRect();return b=b.touches?b.touches[0]:b,new f(b.clientX-c.left-a.clientLeft,b.clientY-c.top-a.clientTop)}},{"point-geometry":137}],99:[function(a,b,c){"use strict";b.exports={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0}},{}],100:[function(a,b,c){"use strict";var d=a("./util"),e={on:function(a,b){return this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b),this},off:function(a,b){if(!a)return delete this._events,this;if(!this.listens(a))return this;if(b){var c=this._events[a].indexOf(b);c>=0&&this._events[a].splice(c,1),this._events[a].length||delete this._events[a]}else delete this._events[a];return this},once:function(a,b){var c=function(d){this.off(a,c),b.call(this,d)}.bind(this);return this.on(a,c),this},fire:function(a,b){if(!this.listens(a))return this;b=d.extend({},b),d.extend(b,{type:a,target:this});for(var c=this._events[a].slice(),e=0;e<c.length;e++)c[e].call(this,b);return this},listens:function(a){return!(!this._events||!this._events[a])}};b.exports=e},{"./util":106}],101:[function(a,b,c){"use strict";function d(a,b){this.stacks=a.readFields(e,[],b)}function e(a,b,c){if(1===a){var d=c.readMessage(f,{glyphs:{}});b.push(d)}}function f(a,b,c){if(1===a)b.name=c.readString();else if(2===a)b.range=c.readString();else if(3===a){var d=c.readMessage(g,{});b.glyphs[d.id]=d}}function g(a,b,c){1===a?b.id=c.readVarint():2===a?b.bitmap=c.readBytes():3===a?b.width=c.readVarint():4===a?b.height=c.readVarint():5===a?b.left=c.readSVarint():6===a?b.top=c.readSVarint():7===a&&(b.advance=c.readVarint())}b.exports=d},{}],102:[function(a,b,c){"use strict";function d(a,b,c){return a*(1-c)+b*c}b.exports=d,d.number=d,d.vec2=function(a,b,c){return[d(a[0],b[0],c),d(a[1],b[1],c)]},d.color=function(a,b,c){return[d(a[0],b[0],c),d(a[1],b[1],c),d(a[2],b[2],c),d(a[3],b[3],c)]},d.array=function(a,b,c){return a.map(function(a,e){return d(a,b[e],c)})}},{}],103:[function(a,b,c){"use strict";function d(a,b,c){if(c=c||e.ACCESS_TOKEN,!c&&e.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox GL. See https://www.mapbox.com/developers/api/#access-tokens");if(a=a.replace(/^mapbox:\/\//,e.API_URL+b),a+=-1!==a.indexOf("?")?"&access_token=":"?access_token=",e.REQUIRE_ACCESS_TOKEN){if("s"===c[0])throw new Error("Use a public access token (pk.*) with Mapbox GL JS, not a secret access token (sk.*). See https://www.mapbox.com/developers/api/#access-tokens");a+=c}return a}var e=a("./config"),f=a("./browser");b.exports.normalizeStyleURL=function(a,b){if(!a.match(/^mapbox:\/\/styles\//))return a;var c=a.split("/"),e=c[3],f=c[4],g=c[5]?"/draft":"";return d("mapbox://"+e+"/"+f+g,"/styles/v1/",b)},b.exports.normalizeSourceURL=function(a,b){return a.match(/^mapbox:\/\//)?d(a+".json","/v4/",b)+"&secure":a},b.exports.normalizeGlyphsURL=function(a,b){if(!a.match(/^mapbox:\/\//))return a;var c=a.split("/")[3];return d("mapbox://"+c+"/{fontstack}/{range}.pbf","/fonts/v1/",b)},b.exports.normalizeSpriteURL=function(a,b,c,e){if(!a.match(/^mapbox:\/\/sprites\//))return a+b+c;var f=a.split("/"),g=f[3],h=f[4],i=f[5]?"/draft":"";return d("mapbox://"+g+"/"+h+i+"/sprite"+b+c,"/styles/v1/",e)},b.exports.normalizeTileURL=function(a,b){return b&&b.match(/^mapbox:\/\//)?a.replace(/\.((?:png|jpg)\d*)(?=$|\?)/,f.devicePixelRatio>=2?"@2x.$1":".$1"):a}},{"./browser":95,"./config":99}],104:[function(a,b,c){"use strict";function d(a,b){this.max=a,this.onRemove=b,this.reset()}b.exports=d,d.prototype.reset=function(){for(var a in this.list)this.onRemove(this.list[a]);return this.list={},this.order=[],this},d.prototype.add=function(a,b){if(this.list[a]=b,this.order.push(a),this.order.length>this.max){var c=this.get(this.order[0]);c&&this.onRemove(c)}return this},d.prototype.has=function(a){return a in this.list},d.prototype.keys=function(){return this.order},d.prototype.get=function(a){if(!this.has(a))return null;var b=this.list[a];return delete this.list[a],this.order.splice(this.order.indexOf(a),1),b}},{}],105:[function(a,b,c){"use strict";function d(a,b){return b.replace(/{([^{}()\[\]<>$=:;.,^]+)}/g,function(b,c){return c in a?a[c]:""})}b.exports=d},{}],106:[function(a,b,c){"use strict";var d=a("unitbezier"),e=a("../geo/coordinate");c.easeCubicInOut=function(a){if(0>=a)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)},c.bezier=function(a,b,c,e){var f=new d(a,b,c,e);return function(a){return f.solve(a)}},c.ease=c.bezier(.25,.1,.25,1),c.premultiply=function(a){return a[0]*=a[3],a[1]*=a[3],a[2]*=a[3],a},c.clamp=function(a,b,c){return Math.min(c,Math.max(b,a))},c.wrap=function(a,b,c){var d=c-b;return a===c?a:((a-b)%d+d)%d+b},c.coalesce=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(null!==b&&void 0!==b)return b}},c.asyncEach=function(a,b,c){function d(){0===--e&&c()}var e=a.length;if(0===e)return c();for(var f=0;f<a.length;f++)b(a[f],d)},c.asyncAll=function(a,b,c){var d=a.length,e=new Array(a.length),f=null;a.forEach(function(a,g){b(a,function(a,b){a&&(f=a),e[g]=b,0===--d&&c(f,e)})})},c.keysDifference=function(a,b){var c=[];for(var d in a)d in b||c.push(d);return c},c.extend=function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a},c.extendAll=function(a,b){for(var c in b)Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c));return a},c.inherit=function(a,b){var d="function"==typeof a?a.prototype:a,e=Object.create(d);return c.extendAll(e,b),e},c.pick=function(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];e in a&&(c[e]=a[e])}return c};var f=1;c.uniqueId=function(){return f++},c.throttle=function(a,b,c){var d,e,f,g;return g=function(){d=!1,e&&(f.apply(c,e),e=!1)},f=function(){d?e=arguments:(a.apply(c,arguments),setTimeout(g,b),d=!0)}},c.debounce=function(a,b){var c,d;return function(){d=arguments,clearTimeout(c),c=setTimeout(function(){a.apply(null,d)},b)}},c.bindAll=function(a,b){a.forEach(function(a){b[a]=b[a].bind(b)})},c.bindHandlers=function(a){for(var b in a)"function"==typeof a[b]&&0===b.indexOf("_on")&&(a[b]=a[b].bind(a))},c.setOptions=function(a,b){a.hasOwnProperty("options")||(a.options=a.options?Object.create(a.options):{});for(var c in b)a.options[c]=b[c];return a.options},c.getCoordinatesCenter=function(a){for(var b=1/0,c=1/0,d=-(1/0),f=-(1/0),g=0;g<a.length;g++)b=Math.min(b,a[g].column),c=Math.min(c,a[g].row),d=Math.max(d,a[g].column),f=Math.max(f,a[g].row);var h=d-b,i=f-c,j=Math.max(h,i);return new e((b+d)/2,(c+f)/2,0).zoomTo(Math.floor(-Math.log(j)/Math.LN2))}},{"../geo/coordinate":19,unitbezier:140}],107:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],
108:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],109:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],110:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":109,_process:108,inherits:107}],111:[function(a,b,c){function d(a){return a=Math.round(a),0>a?0:a>255?255:a}function e(a){return 0>a?0:a>1?1:a}function f(a){return d("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function g(a){return e("%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))}function h(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function i(a){var b=a.replace(/ /g,"").toLowerCase();if(b in j)return j[b].slice();if("#"===b[0]){if(4===b.length){var c=parseInt(b.substr(1),16);return c>=0&&4095>=c?[(3840&c)>>4|(3840&c)>>8,240&c|(240&c)>>4,15&c|(15&c)<<4,1]:null}if(7===b.length){var c=parseInt(b.substr(1),16);return c>=0&&16777215>=c?[(16711680&c)>>16,(65280&c)>>8,255&c,1]:null}return null}var e=b.indexOf("("),i=b.indexOf(")");if(-1!==e&&i+1===b.length){var k=b.substr(0,e),l=b.substr(e+1,i-(e+1)).split(","),m=1;switch(k){case"rgba":if(4!==l.length)return null;m=g(l.pop());case"rgb":return 3!==l.length?null:[f(l[0]),f(l[1]),f(l[2]),m];case"hsla":if(4!==l.length)return null;m=g(l.pop());case"hsl":if(3!==l.length)return null;var n=(parseFloat(l[0])%360+360)%360/360,o=g(l[1]),p=g(l[2]),q=.5>=p?p*(o+1):p+o-p*o,r=2*p-q;return[d(255*h(r,q,n+1/3)),d(255*h(r,q,n)),d(255*h(r,q,n-1/3)),m];default:return null}}return null}var j={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{c.parseCSSColor=i}catch(k){}},{}],112:[function(a,b,c){"use strict";function d(a){return function(b,c,d){return"$type"===c?"t"+a+h.indexOf(d):"p["+JSON.stringify(c)+"]"+a+JSON.stringify(d)}}function e(a){var b=d(a);return function(a,c,d){return"$type"===c?b(a,c,d):"typeof(p["+JSON.stringify(c)+"]) === typeof("+JSON.stringify(d)+") && "+b(a,c,d)}}function f(a){return i[a[0]].apply(a,a)}function g(){return!0}var h=["Unknown","Point","LineString","Polygon"],i={"==":d("==="),"!=":d("!=="),">":e(">"),"<":e("<"),"<=":e("<="),">=":e(">="),"in":function(a,b){return Array.prototype.slice.call(arguments,2).map(function(c){return"("+i["=="](a,b,c)+")"}).join("||")||"false"},"!in":function(){return"!("+i["in"].apply(this,arguments)+")"},any:function(){return Array.prototype.slice.call(arguments,1).map(function(a){return"("+f(a)+")"}).join("||")||"false"},all:function(){return Array.prototype.slice.call(arguments,1).map(function(a){return"("+f(a)+")"}).join("&&")||"true"},none:function(){return"!("+i.any.apply(this,arguments)+")"}};b.exports=function(a){if(!a)return g;var b="var p = f.properties || f.tags || {}, t = f.type; return "+f(a)+";";return new Function("f",b)}},{}],113:[function(a,b,c){"use strict";function d(a,b,c,d,g,h,i,j){if(c/=b,d/=b,i>=c&&d>=j)return a;if(i>d||c>j)return null;for(var k=[],l=0;l<a.length;l++){var m,n,o=a[l],p=o.geometry,q=o.type;if(m=o.min[g],n=o.max[g],m>=c&&d>=n)k.push(o);else if(!(m>d||c>n)){var r=1===q?e(p,c,d,g):f(p,c,d,g,h,3===q);r.length&&k.push({geometry:r,type:q,tags:a[l].tags||null,min:o.min,max:o.max})}}return k.length?k:null}function e(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g[d];h>=b&&c>=h&&e.push(g)}return e}function f(a,b,c,d,e,f){for(var h=[],i=0;i<a.length;i++){var j,k,l=0,m=0,n=null,o=a[i],p=o.area,q=o.dist,r=o.length,s=[];for(k=0;r-1>k;k++)j=n||o[k],n=o[k+1],l=m||j[d],m=n[d],b>l?m>c?(s.push(e(j,n,b),e(j,n,c)),f||(s=g(h,s,p,q))):m>=b&&s.push(e(j,n,b)):l>c?b>m?(s.push(e(j,n,c),e(j,n,b)),f||(s=g(h,s,p,q))):c>=m&&s.push(e(j,n,c)):(s.push(j),b>m?(s.push(e(j,n,b)),f||(s=g(h,s,p,q))):m>c&&(s.push(e(j,n,c)),f||(s=g(h,s,p,q))));j=o[r-1],l=j[d],l>=b&&c>=l&&s.push(j),f&&s[0]!==s[s.length-1]&&s.push(s[0]),g(h,s,p,q)}return h}function g(a,b,c,d){return b.length&&(b.area=c,b.dist=d,a.push(b)),[]}b.exports=d},{}],114:[function(a,b,c){"use strict";function d(a,b){var c=[];if("FeatureCollection"===a.type)for(var d=0;d<a.features.length;d++)e(c,a.features[d],b);else"Feature"===a.type?e(c,a,b):e(c,{geometry:a},b);return c}function e(a,b,c){var d,i,j,k=b.geometry,l=k.type,m=k.coordinates,n=b.properties;if("Point"===l)a.push(f(n,1,[h(m)]));else if("MultiPoint"===l)a.push(f(n,1,g(m)));else if("LineString"===l)a.push(f(n,2,[g(m,c)]));else if("MultiLineString"===l||"Polygon"===l){for(j=[],d=0;d<m.length;d++)j.push(g(m[d],c));a.push(f(n,"Polygon"===l?3:2,j))}else if("MultiPolygon"===l){for(j=[],d=0;d<m.length;d++)for(i=0;i<m[d].length;i++)j.push(g(m[d][i],c));a.push(f(n,3,j))}else if("GeometryCollection"===l)for(d=0;d<k.geometries.length;d++)e(a,{geometry:k.geometries[d],properties:n},c);else console.warn("Unsupported GeoJSON type: "+k.type)}function f(a,b,c){var d={geometry:c,type:b,tags:a||null,min:[2,1],max:[-1,0]};return j(d),d}function g(a,b){for(var c=[],d=0;d<a.length;d++)c.push(h(a[d]));return b&&(l(c,b),i(c)),c}function h(a){var b=Math.sin(a[1]*Math.PI/180),c=a[0]/360+.5,d=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return d=-1>d?-1:d>1?1:d,[c,d,0]}function i(a){for(var b,c,d=0,e=0,f=0;f<a.length-1;f++)b=c||a[f],c=a[f+1],d+=b[0]*c[1]-c[0]*b[1],e+=Math.abs(c[0]-b[0])+Math.abs(c[1]-b[1]);a.area=Math.abs(d/2),a.dist=e}function j(a){var b=a.geometry,c=a.min,d=a.max;if(1===a.type)k(c,d,b);else for(var e=0;e<b.length;e++)k(c,d,b[e]);return a}function k(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],a[0]=Math.min(d[0],a[0]),b[0]=Math.max(d[0],b[0]),a[1]=Math.min(d[1],a[1]),b[1]=Math.max(d[1],b[1])}b.exports=d;var l=a("./simplify")},{"./simplify":116}],115:[function(a,b,c){"use strict";function d(a,b){return new e(a,b)}function e(a,b){b=this.options=l(Object.create(this.options),b);var c=b.debug;c&&console.time("preprocess data");var d=1<<b.maxZoom,e=m(a,b.tolerance/(d*b.extent));this.tiles={},c&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),e=o(e,b.buffer/b.extent,j),this.splitTile(e,0,0,0),c&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function f(a,b){if(!a||a.transformed)return a;var c,d,e,f=a.z2,h=a.x,i=a.y;for(c=0;c<a.features.length;c++){var j=a.features[c],k=j.geometry,l=j.type;if(1===l)for(d=0;d<k.length;d++)k[d]=g(k[d],b,f,h,i);else for(d=0;d<k.length;d++){var m=k[d];for(e=0;e<m.length;e++)m[e]=g(m[e],b,f,h,i)}}return a.transformed=!0,a}function g(a,b,c,d,e){var f=Math.round(b*(a[0]*c-d)),g=Math.round(b*(a[1]*c-e));return[f,g]}function h(a,b,c){if(1!==a.length)return!1;var d=a[0];if(3!==d.type||d.geometry.length>1)return!1;for(var e=0;e<d.geometry[0].length;e++){var f=d.geometry[0][e];if(f[0]!==-c&&f[0]!==b+c||f[1]!==-c&&f[1]!==b+c)return!1}return!0}function i(a,b,c){return 32*((1<<a)*c+b)+a}function j(a,b,c){return[c,(c-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function k(a,b,c){return[(c-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],c,1]}function l(a,b){for(var c in b)a[c]=b[c];return a}b.exports=d;var m=a("./convert"),n=a("./clip"),o=a("./wrap"),p=a("./tile");e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},e.prototype.splitTile=function(a,b,c,d,e,f,g){for(var l=[a,b,c,d],m=this.options,o=m.debug,q=m.extent,r=m.buffer;l.length;){a=l.shift(),b=l.shift(),c=l.shift(),d=l.shift();var s=1<<b,t=i(b,c,d),u=this.tiles[t],v=b===m.maxZoom?0:m.tolerance/(s*q);if(!u&&(o>1&&console.time("creation"),u=this.tiles[t]=p(a,s,c,d,v,b===m.maxZoom),o)){o>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,c,d,u.numFeatures,u.numPoints,u.numSimplified),console.timeEnd("creation"));var w="z"+b;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(u.source=a,!h(u.features,q,r)){if(e){if(b===m.maxZoom||b===e)continue;var x=1<<e-b;if(c!==Math.floor(f/x)&&d!==Math.floor(g/x))continue}else if(b===m.indexMaxZoom||u.numPoints<=m.indexMaxPoints)continue;u.source=null,o>1&&console.time("clipping");var y,z,A,B,C,D,E=.5*r/q,F=.5-E,G=.5+E,H=1+E;y=z=A=B=null,C=n(a,s,c-E,c+G,0,j,u.min[0],u.max[0]),D=n(a,s,c+F,c+H,0,j,u.min[0],u.max[0]),C&&(y=n(C,s,d-E,d+G,1,k,u.min[1],u.max[1]),z=n(C,s,d+F,d+H,1,k,u.min[1],u.max[1])),D&&(A=n(D,s,d-E,d+G,1,k,u.min[1],u.max[1]),B=n(D,s,d+F,d+H,1,k,u.min[1],u.max[1])),o>1&&console.timeEnd("clipping"),y&&l.push(y,b+1,2*c,2*d),z&&l.push(z,b+1,2*c,2*d+1),A&&l.push(A,b+1,2*c+1,2*d),B&&l.push(B,b+1,2*c+1,2*d+1)}}},e.prototype.getTile=function(a,b,c){var d=this.options,e=d.extent,g=d.debug,j=1<<a;b=(b%j+j)%j;var k=i(a,b,c);if(this.tiles[k])return f(this.tiles[k],e);g>1&&console.log("drilling down to z%d-%d-%d",a,b,c);for(var l,m=a,n=b,o=c;!l&&m>0;)m--,n=Math.floor(n/2),o=Math.floor(o/2),l=this.tiles[i(m,n,o)];if(g>1&&console.log("found parent tile z%d-%d-%d",m,n,o),l.source){if(h(l.features,d.extent,d.buffer))return f(l,e);g>1&&console.time("drilling down"),this.splitTile(l.source,m,n,o,a,b,c),g>1&&console.timeEnd("drilling down")}return f(this.tiles[k],e)}},{"./clip":113,"./convert":114,"./tile":117,"./wrap":118}],116:[function(a,b,c){"use strict";function d(a,b){var c,d,f,g,h=b*b,i=a.length,j=0,k=i-1,l=[];for(a[j][2]=1,a[k][2]=1;k;){for(d=0,c=j+1;k>c;c++)f=e(a[c],a[j],a[k]),f>d&&(g=c,d=f);d>h?(a[g][2]=d,l.push(j),l.push(g),j=g):(k=l.pop(),j=l.pop())}}function e(a,b,c){var d=b[0],e=b[1],f=c[0],g=c[1],h=a[0],i=a[1],j=f-d,k=g-e;if(0!==j||0!==k){var l=((h-d)*j+(i-e)*k)/(j*j+k*k);l>1?(d=f,e=g):l>0&&(d+=j*l,e+=k*l)}return j=h-d,k=i-e,j*j+k*k}b.exports=d},{}],117:[function(a,b,c){"use strict";function d(a,b,c,d,f,g){for(var h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:c,y:d,z2:b,transformed:!1,min:[2,1],max:[-1,0]},i=0;i<a.length;i++){h.numFeatures++,e(h,a[i],f,g);var j=a[i].min,k=a[i].max;j[0]<h.min[0]&&(h.min[0]=j[0]),j[1]<h.min[1]&&(h.min[1]=j[1]),k[0]>h.max[0]&&(h.max[0]=k[0]),k[1]>h.max[1]&&(h.max[1]=k[1])}return h}function e(a,b,c,d){var e,f,g,h,i=b.geometry,j=b.type,k=[],l=c*c;if(1===j)for(e=0;e<i.length;e++)k.push(i[e]),a.numPoints++,a.numSimplified++;else for(e=0;e<i.length;e++)if(g=i[e],d||!(2===j&&g.dist<c||3===j&&g.area<l)){var m=[];for(f=0;f<g.length;f++)h=g[f],(d||h[2]>l)&&(m.push(h),a.numSimplified++),a.numPoints++;k.push(m)}else a.numPoints+=g.length;k.length&&a.features.push({geometry:k,type:j,tags:b.tags||null})}b.exports=d},{}],118:[function(a,b,c){"use strict";function d(a,b,c){var d=a,f=g(a,1,-1-b,b,0,c,-1,2),h=g(a,1,1-b,2+b,0,c,-1,2);return(f||h)&&(d=g(a,1,-b,1+b,0,c,-1,2),f&&(d=e(f,1).concat(d)),h&&(d=d.concat(e(h,-1)))),d}function e(a,b){for(var c=[],d=0;d<a.length;d++){var e,g=a[d],h=g.type;if(1===h)e=f(g.geometry,b);else{e=[];for(var i=0;i<g.geometry.length;i++)e.push(f(g.geometry[i],b))}c.push({geometry:e,type:h,tags:g.tags,min:[g.min[0]+b,g.min[1]],max:[g.max[0]+b,g.max[1]]})}return c}function f(a,b){var c=[];c.area=a.area,c.dist=a.dist;for(var d=0;d<a.length;d++)c.push([a[d][0]+b,a[d][1],a[d][2]]);return c}var g=a("./clip");b.exports=d},{"./clip":113}],119:[function(a,b,c){c.glMatrix=a("./gl-matrix/common.js"),c.mat2=a("./gl-matrix/mat2.js"),c.mat2d=a("./gl-matrix/mat2d.js"),c.mat3=a("./gl-matrix/mat3.js"),c.mat4=a("./gl-matrix/mat4.js"),c.quat=a("./gl-matrix/quat.js"),c.vec2=a("./gl-matrix/vec2.js"),c.vec3=a("./gl-matrix/vec3.js"),c.vec4=a("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":120,"./gl-matrix/mat2.js":121,"./gl-matrix/mat2d.js":122,"./gl-matrix/mat3.js":123,"./gl-matrix/mat4.js":124,"./gl-matrix/quat.js":125,"./gl-matrix/vec2.js":126,"./gl-matrix/vec3.js":127,"./gl-matrix/vec4.js":128}],120:[function(a,b,c){var d={};d.EPSILON=1e-6,d.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,d.RANDOM=Math.random,d.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a};var e=Math.PI/180;d.toRadian=function(a){return a*e},b.exports=d},{}],121:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},b.exports=e},{"./common.js":120}],122:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},b.exports=e},{"./common.js":120}],123:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},b.exports=e},{"./common.js":120}],124:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,
a[15]=(k*v-l*t+m*s)*E,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.mul=e.multiply,e.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},b.exports=e},{"./common.js":120}],125:[function(a,b,c){var d=a("./common.js"),e=a("./mat3.js"),f=a("./vec3.js"),g=a("./vec4.js"),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return-.999999>i?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=h},{"./common.js":120,"./mat3.js":123,"./vec3.js":127,"./vec4.js":128}],126:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},b.exports=e},{"./common.js":120}],127:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},b.exports=e},{"./common.js":120}],128:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=e},{"./common.js":120}],129:[function(a,b,c){"use strict";function d(a){return function(){return a}}function e(a,b,c){return a*(1-c)+b*c}function f(a,b,c){for(var d=[],f=0;f<a.length;f++)d[f]=e(a[f],b[f],c);return d}c.interpolated=function(a){if(!a.stops)return d(a);var b=a.stops,c=a.base||1,g=Array.isArray(b[0][1])?f:e;return function(a){for(var d,e,f=0;f<b.length;f++){var h=b[f];if(h[0]<=a&&(d=h),h[0]>a){e=h;break}}if(d&&e){var i=e[0]-d[0],j=a-d[0],k=1===c?j/i:(Math.pow(c,j)-1)/(Math.pow(c,i)-1);return g(d[1],e[1],k)}return d?d[1]:e?e[1]:void 0}},c["piecewise-constant"]=function(a){if(!a.stops)return d(a);var b=a.stops;return function(a){for(var c=0;c<b.length;c++)if(b[c][0]>a)return b[0===c?0:c-1][1];return b[b.length-1][1]}}},{}],130:[function(a,b,c){"use strict";var d=a("../../reference/latest.js"),e=a("./parsed");b.exports=function(a){return e(a,d)}},{"../../reference/latest.js":132,"./parsed":131}],131:[function(a,b,c){"use strict";function d(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function e(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}var f=a("csscolorparser").parseCSSColor,g=a("util").format;b.exports=function(a,b){function c(a,b){var c={message:(a?a+": ":"")+g.apply(g,Array.prototype.slice.call(arguments,2))};null!==b&&void 0!==b&&b.__line__&&(c.line=b.__line__),l.push(c)}function h(a,e,f){var g=d(e);if("string"===g&&"@"===e[0]){if(b.$version>7)return c(a,e,"constants have been deprecated as of v8");if(!(e in j))return c(a,e,'constant "%s" not found',e);e=j[e],g=d(e)}if(f["function"]&&"object"===g)return h["function"](a,e,f);if(f.type){var i=h[f.type];if(i)return i(a,e,f);f=b[f.type]}h.object(a,e,f)}function i(a){return function(b,e,f){var g=d(e);g!==a&&c(b,e,"%s expected, %s found",a,g),"minimum"in f&&e<f.minimum&&c(b,e,"%s is less than the minimum value %s",e,f.minimum),"maximum"in f&&e>f.maximum&&c(b,e,"%s is greater than the maximum value %s",e,f.maximum)}}var j=a.constants||{},k={},l=[];return h.constants=function(a,e){if(b.$version>7){if(e)return c(a,e,"constants have been deprecated as of v8")}else{var f=d(e);if("object"!==f)return c(a,e,"object expected, %s found",f);for(var g in e)"@"!==g[0]&&c(a+"."+g,e[g],'constants must start with "@"')}},h.source=function(a,d){if(!d.type)return void c(a,d,'"type" is required');var f=e(d.type);switch(f){case"vector":case"raster":if(h.object(a,d,b.source_tile),"url"in d)for(var g in d)["type","url","tileSize"].indexOf(g)<0&&c(a+"."+g,d[g],'a source with a "url" property may not include a "%s" property',g);break;case"geojson":h.object(a,d,b.source_geojson);break;case"video":h.object(a,d,b.source_video);break;case"image":h.object(a,d,b.source_image);break;default:h["enum"](a+".type",d.type,{values:["vector","raster","geojson","video","image"]})}},h.layer=function(d,f){f.type||f.ref||c(d,f,'either "type" or "ref" is required');var g=e(f.type),i=e(f.ref);if(f.id&&(k[f.id]?c(d,f.id,'duplicate layer id "%s", previously used at line %d',f.id,k[f.id]):k[f.id]=f.id.__line__),"ref"in f){["type","source","source-layer","filter","layout"].forEach(function(a){a in f&&c(d,f[a],'"%s" is prohibited for ref layers',a)});var j;a.layers.forEach(function(a){a.id==i&&(j=a)}),j?j.ref?c(d,f.ref,"ref cannot reference another ref layer"):g=j.type:c(d,f.ref,'ref layer "%s" not found',i)}else if("background"!==g)if(f.source){var l=a.sources[f.source];l?"vector"==l.type&&"raster"==g?c(d,f.source,'layer "%s" requires a raster source',f.id):"raster"==l.type&&"raster"!=g&&c(d,f.source,'layer "%s" requires a vector source',f.id):c(d,f.source,'source "%s" not found',f.source)}else c(d,f,'missing required property "source"');h.object(d,f,b.layer,{filter:h.filter,layout:function(a,c){var d=b["layout_"+g];return g&&d&&h(a,c,d)},paint:function(a,c){var d=b["paint_"+g];return g&&d&&h(a,c,d)}})},h.object=function(a,e,f,g){g=g||{};var i=d(e);if("object"!==i)return c(a,e,"object expected, %s found",i);for(var j in e){var k=j.split(".")[0],l=f[k]||f["*"],m=k.match(/^(.*)-transition$/);l?(g[k]||h)((a?a+".":a)+j,e[j],l):m&&f[m[1]]&&f[m[1]].transition?h((a?a+".":a)+j,e[j],b.transition):""!==a&&1!==a.split(".").length&&c(a,e[j],'unknown property "%s"',j)}for(var n in f)f[n].required&&void 0===f[n]["default"]&&void 0===e[n]&&c(a,e,'missing required property "%s"',n)},h.array=function(b,e,f,g){if("array"!==d(e))return c(b,e,"array expected, %s found",d(e));if(f.length&&e.length!==f.length)return c(b,e,"array length %d expected, length %d found",f.length,e.length);if(f["min-length"]&&e.length<f["min-length"])return c(b,e,"array length at least %d expected, length %d found",f["min-length"],e.length);var i={type:f.value};a.version<7&&(i["function"]=f["function"]),"object"===d(f.value)&&(i=f.value);for(var j=0;j<e.length;j++)(g||h)(b+"["+j+"]",e[j],i)},h.filter=function(a,f){var g;if("array"!==d(f))return c(a,f,"array expected, %s found",d(f));if(f.length<1)return c(a,f,"filter array must have at least 1 element");switch(h["enum"](a+"[0]",f[0],b.filter_operator),e(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&"$type"==f[1]&&c(a,f,'"$type" cannot be use with operator "%s"',f[0]);case"==":case"!=":3!=f.length&&c(a,f,'filter array for operator "%s" must have 3 elements',f[0]);case"in":case"!in":f.length>=2&&(g=d(f[1]),"string"!==g?c(a+"[1]",f[1],"string expected, %s found",g):"@"===f[1][0]&&c(a+"[1]",f[1],"filter key cannot be a constant"));for(var i=2;i<f.length;i++)g=d(f[i]),"$type"==f[1]?h["enum"](a+"["+i+"]",f[i],b.geometry_type):"string"===g&&"@"===f[i][0]?c(a+"["+i+"]",f[i],"filter value cannot be a constant"):"string"!==g&&"number"!==g&&"boolean"!==g&&c(a+"["+i+"]",f[i],"string, number, or boolean expected, %s found",g);break;case"any":case"all":case"none":for(i=1;i<f.length;i++)h.filter(a+"["+i+"]",f[i])}},h["function"]=function(a,e,f){h.object(a,e,b["function"],{stops:function(a,b,e){var g=-(1/0);h.array(a,b,e,function(a,b){return"array"!==d(b)?c(a,b,"array expected, %s found",d(b)):2!==b.length?c(a,b,"array length %d expected, length %d found",2,b.length):(h(a+"[0]",b[0],{type:"number"}),h(a+"[1]",b[1],f),void("number"===d(b[0])&&("piecewise-constant"===f["function"]&&b[0]%1!==0&&c(a+"[0]",b[0],"zoom level for piecewise-constant functions must be an integer"),b[0]<g&&c(a+"[0]",b[0],"array stops must appear in ascending order"),g=b[0])))}),"array"===d(b)&&0===b.length&&c(a,b,"array must have at least one stop")}})},h["enum"]=function(a,b,d){-1===d.values.indexOf(e(b))&&c(a,b,"expected one of [%s], %s found",d.values.join(", "),b)},h.color=function(a,b){var e=d(b);return"string"!==e?c(a,b,"color expected, %s found",e):null===f(b)?c(a,b,'color expected, "%s" found',b):void 0},h.number=i("number"),h.string=i("string"),h["boolean"]=i("boolean"),h["*"]=function(){},h("",a,b.$root),b.$version>7&&a.constants&&h.constants("constants",a.constants),l.sort(function(a,b){return a.line-b.line}),l}},{csscolorparser:111,util:110}],132:[function(a,b,c){b.exports=a("./v8.json")},{"./v8.json":133}],133:[function(a,b,c){b.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Stylesheet version number. Must be 8."},name:{type:"string",doc:"A human-readable name for the style."},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default centerpoint in longitude and latitude."},zoom:{type:"number",doc:"Default zoom level."},bearing:{type:"number","default":0,period:360,units:"degrees",doc:"Default bearing, in degrees."},pitch:{type:"number","default":0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface"},sources:{required:!0,type:"sources",doc:"Data source specifications."},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended."},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. Valid tokens are {fontstack} and {range}."},transition:{type:"transition",doc:"A global transition definition to use as a default across properties."},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array."}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For GeoJSON and video sources, a URL must be provided."}},source:["source_tile","source_geojson","source_video","source_image"],source_tile:{type:{required:!0,type:"enum",values:["vector","raster"],doc:"The data type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},minzoom:{type:"number","default":0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number","default":22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",
"default":512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:["geojson"]},data:{type:"*"},maxzoom:{type:"number","default":14,doc:"Maximum zoom to preserve detail at."},buffer:{type:"number","default":64,doc:"Tile buffer on each side."},tolerance:{type:"number","default":3,doc:"Simplification tolerance (higher means simpler)."}},source_video:{type:{required:!0,type:"enum",values:["video"]},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:["image"]},url:{required:!0,type:"string",doc:"URL that points to an image"},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",doc:"Unique layer name."},type:{type:"enum",values:["fill","line","symbol","circle","raster","background"],doc:"Rendering type of this layer."},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},ref:{type:"string",doc:"References another layer to copy `type`, `source`, `source-layer`, `minzoom`, `maxzoom`, `filter`, and `layout` properties from. This allows the layers to share processing and be more efficient."},source:{type:"string",doc:"Name of a source description to be used for this layer."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required if the source supports multiple layers."},minzoom:{type:"number",minimum:0,maximum:22,doc:"The minimum zoom level on which the layer gets parsed and appears on."},maxzoom:{type:"number",minimum:0,maximum:22,doc:"The maximum zoom level on which the layer gets parsed and appears on."},interactive:{type:"boolean",doc:"Enable querying of feature data from this layer for interactivity.","default":!1},filter:{type:"filter",doc:"A expression specifying conditions on source features. Only features that match the filter are displayed."},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."},"paint.*":{type:"paint",doc:"Class-specific paint properties for this layer. The class name is the part after the first dot."}},layout:["layout_fill","layout_line","layout_circle","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},layout_fill:{visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},layout_circle:{visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},layout_line:{"line-cap":{type:"enum","function":"piecewise-constant",values:["butt","round","square"],"default":"butt",doc:"The display of line endings."},"line-join":{type:"enum","function":"piecewise-constant",values:["bevel","round","miter"],"default":"miter",doc:"The display of lines when joining."},"line-miter-limit":{type:"number","default":2,"function":"interpolated",doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number","default":1.05,"function":"interpolated",doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}]},visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},layout_symbol:{"symbol-placement":{type:"enum","function":"piecewise-constant",values:["point","line"],"default":"point",doc:"Label placement relative to its geometry. `line` can only be used on LineStrings and Polygons."},"symbol-spacing":{type:"number","default":250,minimum:1,"function":"interpolated",units:"pixels",doc:"Minimum distance between two symbol anchors.",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer."},"icon-allow-overlap":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the icon will be visible even if it collides with other icons and text.",requires:["icon-image"]},"icon-ignore-placement":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the icon won't affect placement of other icons and text.",requires:["icon-image"]},"icon-optional":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the symbol will appear without its icon, in spaces where the icon would make it too large to fit.",requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum","function":"piecewise-constant",values:["map","viewport"],"default":"viewport",doc:"Orientation of icon when map is rotated.",requires:["icon-image"]},"icon-size":{type:"number","default":1,minimum:0,"function":"interpolated",doc:"Scale factor for icon. 1 is original size, 3 triples the size.",requires:["icon-image"]},"icon-image":{type:"string","function":"piecewise-constant",doc:"A string with {tokens} replaced, referencing the data property to pull from.",tokens:!0},"icon-rotate":{type:"number","default":0,period:360,"function":"interpolated",units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"]},"icon-padding":{type:"number","default":2,minimum:0,"function":"interpolated",units:"pixels",doc:"Padding value around icon bounding box to avoid icon collisions.",requires:["icon-image"]},"icon-keep-upright":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",doc:"Icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.",requires:["icon-image"]},"text-rotation-alignment":{type:"enum","function":"piecewise-constant",values:["map","viewport"],"default":"viewport",doc:"Orientation of icon or text when map is rotated.",requires:["text-field"]},"text-field":{type:"string","function":"piecewise-constant","default":"",tokens:!0,doc:"Value to use for a text label. Feature properties are specified using tokens like {field_name}."},"text-font":{type:"array",value:"string","function":"piecewise-constant","default":["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"]},"text-size":{type:"number","default":16,minimum:0,units:"pixels","function":"interpolated",doc:"Font size. If unspecified, the text will be as big as allowed by the layer definition.",requires:["text-field"]},"text-max-width":{type:"number","default":10,minimum:0,units:"em","function":"interpolated",doc:"The maximum line width for text wrapping.",requires:["text-field"]},"text-line-height":{type:"number","default":1.2,units:"em","function":"interpolated",doc:"Text leading value for multi-line text.",requires:["text-field"]},"text-letter-spacing":{type:"number","default":0,units:"em","function":"interpolated",doc:"Text kerning value.",requires:["text-field"]},"text-justify":{type:"enum","function":"piecewise-constant",values:["left","center","right"],"default":"center",doc:"Text justification options.",requires:["text-field"]},"text-anchor":{type:"enum","function":"piecewise-constant",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],"default":"center",doc:"Which part of the text to place closest to the anchor.",requires:["text-field"]},"text-max-angle":{type:"number","default":45,units:"degrees","function":"interpolated",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number","default":0,period:360,units:"degrees","function":"interpolated",doc:"Rotates the text clockwise.",requires:["text-field"]},"text-padding":{type:"number","default":2,minimum:0,units:"pixels","function":"interpolated",doc:"Padding value around text bounding box to avoid label collisions.",requires:["text-field"]},"text-keep-upright":{type:"boolean","function":"piecewise-constant","default":!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum","function":"piecewise-constant",values:["none","uppercase","lowercase"],"default":"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"]},"text-offset":{type:"array",doc:"Specifies the distance that text is offset from its anchor horizontally and vertically.",value:"number",units:"ems","function":"interpolated",length:2,"default":[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the text will be visible even if it collides with other icons and labels.",requires:["text-field"]},"text-ignore-placement":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, the text won't affect placement of other icons and labels.",requires:["text-field"]},"text-optional":{type:"boolean","function":"piecewise-constant","default":!1,doc:"If true, icons can be shown without their corresponding text.",requires:["text-field","icon-image"]},visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},layout_raster:{visibility:{type:"enum","function":"piecewise-constant",values:["visible","none"],"default":"visible",doc:"The display of this layer. `none` hides this layer."}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:["==","!=",">",">=","<","<=","in","!in","all","any","none"]},geometry_type:{type:"enum",values:["Point","LineString","Polygon"]},color_operation:{type:"enum",values:["lighten","saturate","spin","fade","mix"]},"function":{stops:{type:"array",required:!0,doc:"An array of stops.",value:"function_stop"},base:{type:"number","default":1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,doc:"Zoom level and value pair."},paint:["paint_fill","paint_line","paint_circle","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean","function":"piecewise-constant","default":!0,doc:"Whether or not the fill should be antialiased."},"fill-opacity":{type:"number","function":"interpolated","default":1,minimum:0,maximum:1,doc:"The opacity given to the fill color.",transition:!0},"fill-color":{type:"color","default":"#000000",doc:"The color of the fill.","function":"interpolated",transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.","function":"interpolated",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"fill-translate-anchor":{type:"enum","function":"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map",requires:["fill-translate"]},"fill-pattern":{type:"string","function":"piecewise-constant",transition:!0,doc:"Name of image in sprite to use for drawing image fills."}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.","function":"interpolated","default":1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",doc:"The color with which the line will be drawn.","default":"#000000","function":"interpolated",transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"line-translate-anchor":{type:"enum","function":"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map",requires:["line-translate"]},"line-width":{type:"number","default":1,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Stroke thickness."},"line-gap-width":{type:"number","default":0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.","function":"interpolated",transition:!0,units:"pixels"},"line-blur":{type:"number","default":0,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels."},"line-dasharray":{type:"array",value:"number","function":"piecewise-constant",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string","function":"piecewise-constant",transition:!0,doc:"Name of image in sprite to use for drawing image lines."}},paint_circle:{"circle-radius":{type:"number","default":5,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Circle radius."},"circle-color":{type:"color","default":"#000000",doc:"The color of the circle.","function":"interpolated",transition:!0},"circle-blur":{type:"number","default":0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.","function":"interpolated",transition:!0},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.","default":1,minimum:0,maximum:1,"function":"interpolated",transition:!0},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"circle-translate-anchor":{type:"enum","function":"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map",requires:["circle-translate"]}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number","default":1,minimum:0,maximum:1,"function":"interpolated",transition:!0,requires:["icon-image"]},"icon-color":{type:"color","default":"#000000","function":"interpolated",transition:!0,doc:"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"]},"icon-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with sdf icons.",requires:["icon-image"]},"icon-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"]},"icon-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",transition:!0,units:"pixels",doc:"An icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.",requires:["icon-image"]},"icon-translate-anchor":{type:"enum","function":"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.","default":1,minimum:0,maximum:1,"function":"interpolated",transition:!0,requires:["text-field"]},"text-color":{type:"color",doc:"The color with which the text will be drawn.","default":"#000000","function":"interpolated",transition:!0,requires:["text-field"]},"text-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"]},"text-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"]},"text-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated",transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated",transition:!0,units:"pixels",doc:"Label offset. Values are [x, y] where negatives indicate left and up, respectively.",requires:["text-field"]},"text-translate-anchor":{type:"enum","function":"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.","default":1,minimum:0,maximum:1,"function":"interpolated",transition:!0},"raster-hue-rotate":{type:"number","default":0,period:360,"function":"interpolated",transition:!0,units:"degrees",doc:"Rotates hues around the color wheel."},"raster-brightness-min":{type:"number","function":"interpolated",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.","default":0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number","function":"interpolated",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.","default":1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.","default":0,minimum:-1,maximum:1,"function":"interpolated",transition:!0},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.","default":0,minimum:-1,maximum:1,"function":"interpolated",transition:!0},"raster-fade-duration":{type:"number","default":300,minimum:0,"function":"interpolated",transition:!0,units:"milliseconds",doc:"Fade duration when a new tile is added."}},paint_background:{"background-color":{type:"color","default":"#000000",doc:"The color with which the background will be drawn.","function":"interpolated",transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string","function":"piecewise-constant",transition:!0,doc:"Optionally an image which is drawn as the background."},"background-opacity":{type:"number","default":1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.","function":"interpolated",transition:!0}},transition:{duration:{type:"number","default":300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number","default":0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}}}},{}],134:[function(a,b,c){"use strict";function d(a){var b;a&&a.length&&(b=a,a=b.length);var c=new Uint8Array(a||0);return b&&c.set(b),c.readUInt32LE=f.readUInt32LE,c.writeUInt32LE=f.writeUInt32LE,c.readInt32LE=f.readInt32LE,c.writeInt32LE=f.writeInt32LE,c.readFloatLE=f.readFloatLE,c.writeFloatLE=f.writeFloatLE,c.readDoubleLE=f.readDoubleLE,c.writeDoubleLE=f.writeDoubleLE,c.toString=f.toString,c.write=f.write,c.slice=f.slice,c.copy=f.copy,c._isBuffer=!0,c}function e(a){for(var b,c,d=a.length,e=[],f=0;d>f;f++){if(b=a.charCodeAt(f),b>55295&&57344>b){if(!c){b>56319||f+1===d?e.push(239,191,189):c=b;continue}if(56320>b){e.push(239,191,189),c=b;continue}b=c-55296<<10|b-56320|65536,c=null}else c&&(e.push(239,191,189),c=null);128>b?e.push(b):2048>b?e.push(b>>6|192,63&b|128):65536>b?e.push(b>>12|224,b>>6&63|128,63&b|128):e.push(b>>18|240,b>>12&63|128,b>>6&63|128,63&b|128)}return e}b.exports=d;var f,g,h,i=a("ieee754");f={readUInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},writeUInt32LE:function(a,b){this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24},readInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+(this[a+3]<<24)},readFloatLE:function(a){return i.read(this,a,!0,23,4)},readDoubleLE:function(a){return i.read(this,a,!0,52,8)},writeFloatLE:function(a,b){return i.write(this,a,b,!0,23,4)},writeDoubleLE:function(a,b){return i.write(this,a,b,!0,52,8)},toString:function(a,b,c){var d="",e="";b=b||0,c=Math.min(this.length,c||this.length);for(var f=b;c>f;f++){var g=this[f];127>=g?(d+=decodeURIComponent(e)+String.fromCharCode(g),e=""):e+="%"+g.toString(16)}return d+=decodeURIComponent(e)},write:function(a,b){for(var c=a===g?h:e(a),d=0;d<c.length;d++)this[b+d]=c[d]},slice:function(a,b){return this.subarray(a,b)},copy:function(a,b){b=b||0;for(var c=0;c<this.length;c++)a[b+c]=this[c]}},f.writeInt32LE=f.writeUInt32LE,d.byteLength=function(a){return g=a,h=e(a),h.length},d.isBuffer=function(a){return!(!a||!a._isBuffer)}},{ieee754:136}],135:[function(a,b,c){(function(c){"use strict";function d(a){this.buf=n.isBuffer(a)?a:new n(a||0),this.pos=0,this.length=this.buf.length}function e(a,b){for(var c=0;c<a.length;c++)b.writeVarint(a[c])}function f(a,b){for(var c=0;c<a.length;c++)b.writeSVarint(a[c])}function g(a,b){for(var c=0;c<a.length;c++)b.writeFloat(a[c])}function h(a,b){for(var c=0;c<a.length;c++)b.writeDouble(a[c])}function i(a,b){for(var c=0;c<a.length;c++)b.writeBoolean(a[c])}function j(a,b){for(var c=0;c<a.length;c++)b.writeFixed32(a[c])}function k(a,b){for(var c=0;c<a.length;c++)b.writeSFixed32(a[c])}function l(a,b){for(var c=0;c<a.length;c++)b.writeFixed64(a[c])}function m(a,b){for(var c=0;c<a.length;c++)b.writeSFixed64(a[c])}b.exports=d;var n=c.Buffer||a("./buffer");d.Varint=0,d.Fixed64=1,d.Bytes=2,d.Fixed32=5;var o=4294967296,p=1/o,q=Math.pow(2,63);d.prototype={destroy:function(){this.buf=null},readFields:function(a,b,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),e=d>>3,f=this.pos;a(e,b,this),this.pos===f&&this.skip(d)}return b},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this.pos)},readFixed32:function(){var a=this.buf.readUInt32LE(this.pos);return this.pos+=4,a},readSFixed32:function(){var a=this.buf.readInt32LE(this.pos);return this.pos+=4,a},readFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*o;return this.pos+=8,a},readSFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*o;return this.pos+=8,a},readFloat:function(){var a=this.buf.readFloatLE(this.pos);return this.pos+=4,a},readDouble:function(){var a=this.buf.readDoubleLE(this.pos);return this.pos+=8,a},readVarint:function(){var a,b,c,d,e,f,g=this.buf;if(c=g[this.pos++],128>c)return c;if(c=127&c,d=g[this.pos++],128>d)return c|d<<7;if(d=(127&d)<<7,e=g[this.pos++],128>e)return c|d|e<<14;if(e=(127&e)<<14,f=g[this.pos++],128>f)return c|d|e|f<<21;if(a=c|d|e|(127&f)<<21,b=g[this.pos++],a+=268435456*(127&b),128>b)return a;if(b=g[this.pos++],a+=34359738368*(127&b),128>b)return a;if(b=g[this.pos++],a+=4398046511104*(127&b),128>b)return a;if(b=g[this.pos++],a+=562949953421312*(127&b),128>b)return a;if(b=g[this.pos++],a+=72057594037927940*(127&b),128>b)return a;if(b=g[this.pos++],a+=0x8000000000000000*(127&b),128>b)return a;throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){var a=this.pos,b=this.readVarint();if(q>b)return b;for(var c=this.pos-2;255===this.buf[c];)c--;a>c&&(c=a),b=0;for(var d=0;c-a+1>d;d++){var e=127&~this.buf[a+d];b+=4>d?e<<7*d:e*Math.pow(2,7*d)}return-b-1},readSVarint:function(){var a=this.readVarint();return a%2===1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,b=this.buf.toString("utf8",this.pos,a);return this.pos=a,b},readBytes:function(){var a=this.readVarint()+this.pos,b=this.buf.slice(this.pos,a);return this.pos=a,b},readPackedVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readVarint());return b},readPackedSVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSVarint());return b},readPackedBoolean:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readBoolean());return b},readPackedFloat:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFloat());return b},readPackedDouble:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readDouble());return b},readPackedFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed32());return b},readPackedSFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed32());return b},readPackedFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed64());return b},readPackedSFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed64());return b},skip:function(a){var b=7&a;if(b===d.Varint)for(;this.buf[this.pos++]>127;);else if(b===d.Bytes)this.pos=this.readVarint()+this.pos;else if(b===d.Fixed32)this.pos+=4;else{if(b!==d.Fixed64)throw new Error("Unimplemented type: "+b);this.pos+=8}},writeTag:function(a,b){this.writeVarint(a<<3|b)},realloc:function(a){for(var b=this.length||16;b<this.pos+a;)b*=2;if(b!==this.length){var c=new n(b);this.buf.copy(c),this.buf=c,this.length=b}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(a){this.realloc(4),this.buf.writeUInt32LE(a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),this.buf.writeInt32LE(a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeUInt32LE(Math.floor(a*p),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeInt32LE(Math.floor(a*p),this.pos+4),this.pos+=8},writeVarint:function(a){if(a=+a,127>=a)this.realloc(1),this.buf[this.pos++]=a;else if(16383>=a)this.realloc(2),this.buf[this.pos++]=a>>>0&127|128,this.buf[this.pos++]=a>>>7&127;else if(2097151>=a)this.realloc(3),this.buf[this.pos++]=a>>>0&127|128,this.buf[this.pos++]=a>>>7&127|128,this.buf[this.pos++]=a>>>14&127;else if(268435455>=a)this.realloc(4),this.buf[this.pos++]=a>>>0&127|128,this.buf[this.pos++]=a>>>7&127|128,this.buf[this.pos++]=a>>>14&127|128,this.buf[this.pos++]=a>>>21&127;else{for(var b=this.pos;a>=128;)this.realloc(1),this.buf[this.pos++]=255&a|128,a/=128;if(this.realloc(1),this.buf[this.pos++]=0|a,this.pos-b>10)throw new Error("Given varint doesn't fit into 10 bytes")}},writeSVarint:function(a){this.writeVarint(0>a?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a);var b=n.byteLength(a);this.writeVarint(b),this.realloc(b),this.buf.write(a,this.pos),this.pos+=b},writeFloat:function(a){this.realloc(4),this.buf.writeFloatLE(a,this.pos),this.pos+=4},writeDouble:function(a){this.realloc(8),this.buf.writeDoubleLE(a,this.pos),this.pos+=8},writeBytes:function(a){var b=a.length;this.writeVarint(b),this.realloc(b);for(var c=0;b>c;c++)this.buf[this.pos++]=a[c]},writeMessage:function(a,b,c){this.writeTag(a,d.Bytes),this.pos++;var e=this.pos;b(c,this);var f=this.pos-e,g=127>=f?1:16383>=f?2:2097151>=f?3:268435455>=f?4:Math.ceil(Math.log(f)/(7*Math.LN2));if(g>1){this.realloc(g-1);for(var h=this.pos-1;h>=e;h--)this.buf[h+g-1]=this.buf[h]}this.pos=e-1,this.writeVarint(f),this.pos+=f},writePackedVarint:function(a,b){this.writeMessage(a,e,b)},writePackedSVarint:function(a,b){this.writeMessage(a,f,b)},writePackedBoolean:function(a,b){this.writeMessage(a,i,b)},writePackedFloat:function(a,b){this.writeMessage(a,g,b)},writePackedDouble:function(a,b){this.writeMessage(a,h,b)},writePackedFixed32:function(a,b){this.writeMessage(a,j,b)},writePackedSFixed32:function(a,b){this.writeMessage(a,k,b)},writePackedFixed64:function(a,b){this.writeMessage(a,l,b)},writePackedSFixed64:function(a,b){this.writeMessage(a,m,b)},writeBytesField:function(a,b){this.writeTag(a,d.Bytes),this.writeBytes(b)},writeFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeFixed32(b)},writeSFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeSFixed32(b)},writeFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeFixed64(b)},writeSFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeSFixed64(b)},writeVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeVarint(b)},writeSVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeSVarint(b)},writeStringField:function(a,b){this.writeTag(a,d.Bytes),this.writeString(b)},writeFloatField:function(a,b){this.writeTag(a,d.Fixed32),this.writeFloat(b)},writeDoubleField:function(a,b){this.writeTag(a,d.Fixed64),this.writeDouble(b)},writeBooleanField:function(a,b){this.writeVarintField(a,Boolean(b))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":134}],136:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],137:[function(a,b,c){"use strict";function d(a,b){this.x=a,this.y=b}b.exports=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp();
},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var b=a.x-this.x,c=a.y-this.y;return b*b+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,b){return Math.atan2(this.x*b-this.y*a,this.x*a+this.y*b)},_matMult:function(a){var b=a[0]*this.x+a[1]*this.y,c=a[2]*this.x+a[3]*this.y;return this.x=b,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=b*this.x-c*this.y,e=c*this.x+b*this.y;return this.x=d,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(a){return a instanceof d?a:Array.isArray(a)?new d(a[0],a[1]):a}},{}],138:[function(b,c,d){!function(){"use strict";function b(a,c){return this instanceof b?(this._maxEntries=Math.max(4,a||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),c&&this._initFormat(c),void this.clear()):new b(a,c)}function d(a,b){a.bbox=e(a,0,a.children.length,b)}function e(a,b,c,d){for(var e,h=f(),i=b;c>i;i++)e=a.children[i],g(h,a.leaf?d(e):e.bbox);return h}function f(){return[1/0,1/0,-(1/0),-(1/0)]}function g(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a}function h(a,b){return a.bbox[0]-b.bbox[0]}function i(a,b){return a.bbox[1]-b.bbox[1]}function j(a){return(a[2]-a[0])*(a[3]-a[1])}function k(a){return a[2]-a[0]+(a[3]-a[1])}function l(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))}function m(a,b){var c=Math.max(a[0],b[0]),d=Math.max(a[1],b[1]),e=Math.min(a[2],b[2]),f=Math.min(a[3],b[3]);return Math.max(0,e-c)*Math.max(0,f-d)}function n(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function o(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function p(a,b,c,d,e){for(var f,g=[b,c];g.length;)c=g.pop(),b=g.pop(),d>=c-b||(f=b+Math.ceil((c-b)/d/2)*d,q(a,b,c,f,e),g.push(b,f,f,c))}function q(a,b,c,d,e){for(var f,g,h,i,j,k,l,m,n;c>b;){for(c-b>600&&(f=c-b+1,g=d-b+1,h=Math.log(f),i=.5*Math.exp(2*h/3),j=.5*Math.sqrt(h*i*(f-i)/f)*(0>g-f/2?-1:1),k=Math.max(b,Math.floor(d-g*i/f+j)),l=Math.min(c,Math.floor(d+(f-g)*i/f+j)),q(a,k,l,d,e)),m=a[d],g=b,n=c,r(a,b,d),e(a[c],m)>0&&r(a,b,c);n>g;){for(r(a,g,n),g++,n--;e(a[g],m)<0;)g++;for(;e(a[n],m)>0;)n--}0===e(a[b],m)?r(a,b,n):(n++,r(a,n,c)),d>=n&&(b=n+1),n>=d&&(c=n-1)}}function r(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}b.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!o(a,b.bbox))return c;for(var e,f,g,h,i=[];b;){for(e=0,f=b.children.length;f>e;e++)g=b.children[e],h=b.leaf?d(g):g.bbox,o(a,h)&&(b.leaf?c.push(g):n(a,h)?this._all(g,c):i.push(g));b=i.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!o(a,b.bbox))return!1;for(var d,e,f,g,h=[];b;){for(d=0,e=b.children.length;e>d;d++)if(f=b.children[d],g=b.leaf?c(f):f.bbox,o(a,g)){if(b.leaf||n(a,g))return!0;h.push(f)}b=h.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;c>b;b++)this.insert(a[b]);return this}var d=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var e=this.data;this.data=d,d=e}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},insert:function(a){return a&&this._insert(a,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:f(),leaf:!0},this},remove:function(a){if(!a)return this;for(var b,c,d,e,f=this.data,g=this.toBBox(a),h=[],i=[];f||h.length;){if(f||(f=h.pop(),c=h[h.length-1],b=i.pop(),e=!0),f.leaf&&(d=f.children.indexOf(a),-1!==d))return f.children.splice(d,1),h.push(f),this._condense(h),this;e||f.leaf||!n(f.bbox,g)?c?(b++,f=c.children[b],e=!1):f=null:(h.push(f),i.push(b),b=0,c=f,f=f.children[0])}return this},toBBox:function(a){return a},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(a){return this.data=a,this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,e){var f,g=c-b+1,h=this._maxEntries;if(h>=g)return f={children:a.slice(b,c+1),height:1,bbox:null,leaf:!0},d(f,this.toBBox),f;e||(e=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,e-1))),f={children:[],height:e,bbox:null};var i,j,k,l,m=Math.ceil(g/h),n=m*Math.ceil(Math.sqrt(h));for(p(a,b,c,n,this.compareMinX),i=b;c>=i;i+=n)for(k=Math.min(i+n-1,c),p(a,i,k,m,this.compareMinY),j=i;k>=j;j+=m)l=Math.min(j+m-1,k),f.children.push(this._build(a,j,l,e-1));return d(f,this.toBBox),f},_chooseSubtree:function(a,b,c,d){for(var e,f,g,h,i,k,m,n;d.push(b),!b.leaf&&d.length-1!==c;){for(m=n=1/0,e=0,f=b.children.length;f>e;e++)g=b.children[e],i=j(g.bbox),k=l(a,g.bbox)-i,n>k?(n=k,m=m>i?i:m,h=g):k===n&&m>i&&(m=i,h=g);b=h}return b},_insert:function(a,b,c){var d=this.toBBox,e=c?a.bbox:d(a),f=[],h=this._chooseSubtree(e,this.data,b,f);for(h.children.push(a),g(h.bbox,e);b>=0&&f[b].children.length>this._maxEntries;)this._split(f,b),b--;this._adjustParentBBoxes(e,f,b)},_split:function(a,b){var c=a[b],e=c.children.length,f=this._minEntries;this._chooseSplitAxis(c,f,e);var g={children:c.children.splice(this._chooseSplitIndex(c,f,e)),height:c.height};c.leaf&&(g.leaf=!0),d(c,this.toBBox),d(g,this.toBBox),b?a[b-1].children.push(g):this._splitRoot(c,g)},_splitRoot:function(a,b){this.data={children:[a,b],height:a.height+1},d(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,f,g,h,i,k,l,n;for(k=l=1/0,d=b;c-b>=d;d++)f=e(a,0,d,this.toBBox),g=e(a,d,c,this.toBBox),h=m(f,g),i=j(f)+j(g),k>h?(k=h,n=d,l=l>i?i:l):h===k&&l>i&&(l=i,n=d);return n},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:h,e=a.leaf?this.compareMinY:i,f=this._allDistMargin(a,b,c,d),g=this._allDistMargin(a,b,c,e);g>f&&a.children.sort(d)},_allDistMargin:function(a,b,c,d){a.children.sort(d);var f,h,i=this.toBBox,j=e(a,0,b,i),l=e(a,c-b,c,i),m=k(j)+k(l);for(f=b;c-b>f;f++)h=a.children[f],g(j,a.leaf?i(h):h.bbox),m+=k(j);for(f=c-b-1;f>=b;f--)h=a.children[f],g(l,a.leaf?i(h):h.bbox),m+=k(l);return m},_adjustParentBBoxes:function(a,b,c){for(var d=c;d>=0;d--)g(b[d].bbox,a)},_condense:function(a){for(var b,c=a.length-1;c>=0;c--)0===a[c].children.length?c>0?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():d(a[c],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0])),this.compareMinY=new Function("a","b",b.join(a[1])),this.toBBox=new Function("a","return [a"+a.join(", a")+"];")}},"function"==typeof a&&a.amd?a("rbush",function(){return b}):"undefined"!=typeof c?c.exports=b:"undefined"!=typeof self?self.rbush=b:window.rbush=b}()},{}],139:[function(b,c,d){void function(b,e){"function"==typeof a&&a.amd?a(e):"object"==typeof d?c.exports=e():b.resolveUrl=e()}(this,function(){function a(){var a=arguments.length;if(0===a)throw new Error("resolveUrl requires at least one argument; got none.");var b=document.createElement("base");if(b.href=arguments[0],1===a)return b.href;var c=document.getElementsByTagName("head")[0];c.insertBefore(b,c.firstChild);for(var d,e=document.createElement("a"),f=1;a>f;f++)e.href=arguments[f],d=e.href,b.href=d;return c.removeChild(b),d}return a})},{}],140:[function(a,b,c){function d(a,b,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*b,this.by=3*(d-b)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=d,this.p2x=c,this.p2y=d}b.exports=d,d.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},d.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},d.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},d.prototype.solveCurveX=function(a,b){"undefined"==typeof b&&(b=1e-6);var c,d,e,f,g;for(e=a,g=0;8>g;g++){if(f=this.sampleCurveX(e)-a,Math.abs(f)<b)return e;var h=this.sampleCurveDerivativeX(e);if(Math.abs(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=this.sampleCurveX(e),Math.abs(f-a)<b)return e;a>f?c=e:d=e,e=.5*(d-c)+c}return e},d.prototype.solve=function(a,b){return this.sampleCurveY(this.solveCurveX(a,b))}},{}],141:[function(a,b,c){b.exports.VectorTile=a("./lib/vectortile.js"),b.exports.VectorTileFeature=a("./lib/vectortilefeature.js"),b.exports.VectorTileLayer=a("./lib/vectortilelayer.js")},{"./lib/vectortile.js":142,"./lib/vectortilefeature.js":143,"./lib/vectortilelayer.js":144}],142:[function(a,b,c){"use strict";function d(a,b){this.layers=a.readFields(e,{},b)}function e(a,b,c){if(3===a){var d=new f(c,c.readVarint()+c.pos);d.length&&(b[d.name]=d)}}var f=a("./vectortilelayer");b.exports=d},{"./vectortilelayer":144}],143:[function(a,b,c){"use strict";function d(a,b,c,d,f){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=f,a.readFields(e,this,b)}function e(a,b,c){1==a?b._id=c.readVarint():2==a?f(c,b):3==a?b.type=c.readVarint():4==a&&(b._geometry=c.pos)}function f(a,b){for(var c=a.readVarint()+a.pos;a.pos<c;){var d=b._keys[a.readVarint()],e=b._values[a.readVarint()];b.properties[d]=e}}var g=a("point-geometry");b.exports=d,d.types=["Unknown","Point","LineString","Polygon"],d.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var b,c=a.readVarint()+a.pos,d=1,e=0,f=0,h=0,i=[];a.pos<c;){if(!e){var j=a.readVarint();d=7&j,e=j>>3}if(e--,1===d||2===d)f+=a.readSVarint(),h+=a.readSVarint(),1===d&&(b&&i.push(b),b=[]),b.push(new g(f,h));else{if(7!==d)throw new Error("unknown command "+d);b&&b.push(b[0].clone())}}return b&&i.push(b),i},d.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var b=a.readVarint()+a.pos,c=1,d=0,e=0,f=0,g=1/0,h=-(1/0),i=1/0,j=-(1/0);a.pos<b;){if(!d){var k=a.readVarint();c=7&k,d=k>>3}if(d--,1===c||2===c)e+=a.readSVarint(),f+=a.readSVarint(),g>e&&(g=e),e>h&&(h=e),i>f&&(i=f),f>j&&(j=f);else if(7!==c)throw new Error("unknown command "+c)}return[g,i,h,j]},d.prototype.toGeoJSON=function(a,b,c){for(var e=this.extent*Math.pow(2,c),f=this.extent*a,g=this.extent*b,h=this.loadGeometry(),i=d.types[this.type],j=0;j<h.length;j++)for(var k=h[j],l=0;l<k.length;l++){var m=k[l],n=180-360*(m.y+g)/e;k[l]=[360*(m.x+f)/e-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}return"Point"===i&&1===h.length?h=h[0][0]:"Point"===i?(h=h[0],i="MultiPoint"):"LineString"===i&&1===h.length?h=h[0]:"LineString"===i&&(i="MultiLineString"),{type:"Feature",geometry:{type:i,coordinates:h},properties:this.properties}}},{"point-geometry":137}],144:[function(a,b,c){"use strict";function d(a,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(e,this,b),this.length=this._features.length}function e(a,b,c){15===a?b.version=c.readVarint():1===a?b.name=c.readString():5===a?b.extent=c.readVarint():2===a?b._features.push(c.pos):3===a?b._keys.push(c.readString()):4===a&&b._values.push(f(c))}function f(a){for(var b=null,c=a.readVarint()+a.pos;a.pos<c;){var d=a.readVarint()>>3;b=1===d?a.readString():2===d?a.readFloat():3===d?a.readDouble():4===d?a.readVarint64():5===d?a.readVarint():6===d?a.readSVarint():7===d?a.readBoolean():null}return b}var g=a("./vectortilefeature.js");b.exports=d,d.prototype.feature=function(a){if(0>a||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var b=this._pbf.readVarint()+this._pbf.pos;return new g(this._pbf,b,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":143}],145:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a){for(var b,c=Object.keys(f),h=0,i=c.length;i>h;h++){var j=c[h];if(f[j].exports===a){b=j;break}}if(!b){b=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var k={},h=0,i=c.length;i>h;h++){var j=c[h];k[j]=j}e[b]=[Function(["require","module","exports"],"("+a+")(self)"),k]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[b]=b,e[l]=[Function(["require"],"require("+g(b)+")(self)"),m];var n="("+d+")({"+Object.keys(e).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(l)+"])",o=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(o.createObjectURL(new Blob([n],{type:"text/javascript"})))}},{}]},{},[24])(24)});