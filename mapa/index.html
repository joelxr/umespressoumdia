---
layout: default
---
<div class="video-container">
    <div id='map' style="position:absolute; top:0; bottom:0; width:100%;"></div>
    <script>

L.mapbox.accessToken = 'pk.eyJ1Ijoiam9lbHhyIiwiYSI6ImNpcTI3b3l5MzAxM3ZmaW5uMDBnMjYxd2IifQ.8HAKtUOggFVWSy1OlDvx2Q';
var map = L.mapbox.map('map', 'mapbox.streets').setView([-3.742394, -38.511909], 13) ;
var myLayer = L.mapbox.featureLayer().addTo(map);

var geojson = {
    type: 'FeatureCollection',
    features: [
    {% for post in site.posts %}
    {
        type: 'Feature',
        geometry: {
            type: 'Point',
            coordinates: [
            {{ post.location-long }},
            {{ post.location-lat }}
            ]
        },
        properties: {
            title: '{{ post.place }}',
            description: '{{ post.location }}',
            url: '{{ post.url }}',
            date: '{{ post.date | date: "%Y-%m-%d" }}',
            location: '{{ post.location }}',
            city: '{{ post.city }}',
            state: '{{ post.state }}',
            coffee: '{{ post.coffee }}',
            price: '{{ post.price }}',
            {% if post.rate == 0.5 %}
            rate:  '<i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 1 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 1.5 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 2 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 2.5 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 3 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 3.5 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-half-o"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 4 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-o"></i>',
            {% elsif post.rate == 4.5 %}
            rate:  '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star-half-o"></i>',
            {% elsif post.rate == 5 %}
            rate:  '<div class="yellow-text text-darken-3"><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i></div>',
            {% endif %}
            'marker-size': 'large',
            'marker-color': '#BE9A6B',
            'marker-symbol': 'cafe'
        }
    },
    {% endfor %}
    ]
};

myLayer.on('mouseover', function(e) {
    e.layer.openPopup();
});

myLayer.on('ready', function(e) {
    map.fitBounds(myLayer.getBounds());
    var clusterGroup = new L.MarkerClusterGroup();
    e.target.eachLayer(function(layer) {
        clusterGroup.addLayer(layer);
    });
    map.addLayer(clusterGroup);
});

myLayer.on('layeradd', function(e) {
    var marker = e.layer;
    var feature = marker.feature;
    var popupContent =
        '<ul style="margin-left: 2px;">' +
        '<li><a target="_blank" style="max-width:100%" href="' + feature.properties.url + '">' + feature.properties.title +  '</a></li>' +
        '<li>' + feature.properties.rate + '</li>' +
        '<li><i class="fa fa-calendar"></i> ' + feature.properties.date + '</li>' +
        '<li><i class="fa fa-map"></i> ' + feature.properties.location + ' ' + feature.properties.city + ' ' + feature.properties.state +'</a></li>' +
        '<li><i class="fa fa-envira"></i> Caf√© ' + feature.properties.coffee + '</li>' +
        '<li><i class="fa fa-credit-card"></i> ' + feature.properties.price + '</li>' +
        '</ul>';
    marker.bindPopup(popupContent, {closeButton: true, minWidth: 320});
});

myLayer.setGeoJSON(geojson);
    </script>


